(function(p,t){typeof exports=="object"&&typeof module<"u"?t(exports):typeof define=="function"&&define.amd?define(["exports"],t):(p=typeof globalThis<"u"?globalThis:p||self,t(p.ambisonics={}))})(this,function(exports){"use strict";function getAmbisonicChannelCount(p){return(p+1)*(p+1)}function getAmbisonicChannelCount2D(p){return 2*p+1}function degreesToRadians(p){return p*Math.PI/180}function radiansToDegrees(p){return p*180/Math.PI}var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},numeric1_2_6={};(function(exports$1){var numeric=exports$1;typeof commonjsGlobal<"u"&&(commonjsGlobal.numeric=numeric),numeric.version="1.2.6",numeric.bench=function(t,n){var r,i,a,e;for(typeof n>"u"&&(n=15),a=.5,r=new Date;;){for(a*=2,e=a;e>3;e-=4)t(),t(),t(),t();for(;e>0;)t(),e--;if(i=new Date,i-r>n)break}for(e=a;e>3;e-=4)t(),t(),t(),t();for(;e>0;)t(),e--;return i=new Date,1e3*(3*a-1)/(i-r)},numeric._myIndexOf=function(t){var n=this.length,r;for(r=0;r<n;++r)if(this[r]===t)return r;return-1},numeric.myIndexOf=Array.prototype.indexOf?Array.prototype.indexOf:numeric._myIndexOf,numeric.Function=Function,numeric.precision=4,numeric.largeArray=50,numeric.prettyPrint=function(t){function n(a){if(a===0)return"0";if(isNaN(a))return"NaN";if(a<0)return"-"+n(-a);if(isFinite(a)){var e=Math.floor(Math.log(a)/Math.log(10)),c=a/Math.pow(10,e),o=c.toPrecision(numeric.precision);return parseFloat(o)===10&&(e++,c=1,o=c.toPrecision(numeric.precision)),parseFloat(o).toString()+"e"+e.toString()}return"Infinity"}var r=[];function i(a){var e;if(typeof a>"u")return r.push(Array(numeric.precision+8).join(" ")),!1;if(typeof a=="string")return r.push('"'+a+'"'),!1;if(typeof a=="boolean")return r.push(a.toString()),!1;if(typeof a=="number"){var c=n(a),o=a.toPrecision(numeric.precision),f=parseFloat(a.toString()).toString(),h=[c,o,f,parseFloat(o).toString(),parseFloat(f).toString()];for(e=1;e<h.length;e++)h[e].length<c.length&&(c=h[e]);return r.push(Array(numeric.precision+8-c.length).join(" ")+c),!1}if(a===null)return r.push("null"),!1;if(typeof a=="function"){r.push(a.toString());var u=!1;for(e in a)a.hasOwnProperty(e)&&(u?r.push(`,
`):r.push(`
{`),u=!0,r.push(e),r.push(`: 
`),i(a[e]));return u&&r.push(`}
`),!0}if(a instanceof Array){if(a.length>numeric.largeArray)return r.push("...Large Array..."),!0;var u=!1;for(r.push("["),e=0;e<a.length;e++)e>0&&(r.push(","),u&&r.push(`
 `)),u=i(a[e]);return r.push("]"),!0}r.push("{");var u=!1;for(e in a)a.hasOwnProperty(e)&&(u&&r.push(`,
`),u=!0,r.push(e),r.push(`: 
`),i(a[e]));return r.push("}"),!0}return i(t),r.join("")},numeric.parseDate=function(t){function n(r){if(typeof r=="string")return Date.parse(r.replace(/-/g,"/"));if(!(r instanceof Array))throw new Error("parseDate: parameter must be arrays of strings");var i=[],a;for(a=0;a<r.length;a++)i[a]=n(r[a]);return i}return n(t)},numeric.parseFloat=function(t){function n(r){if(typeof r=="string")return parseFloat(r);if(!(r instanceof Array))throw new Error("parseFloat: parameter must be arrays of strings");var i=[],a;for(a=0;a<r.length;a++)i[a]=n(r[a]);return i}return n(t)},numeric.parseCSV=function(t){var n=t.split(`
`),r,i,a=[],e=/(([^'",]*)|('[^']*')|("[^"]*")),/g,c=/^\s*(([+-]?[0-9]+(\.[0-9]*)?(e[+-]?[0-9]+)?)|([+-]?[0-9]*(\.[0-9]+)?(e[+-]?[0-9]+)?))\s*$/,o=function(M){return M.substr(0,M.length-1)},f=0;for(i=0;i<n.length;i++){var h=(n[i]+",").match(e),u;if(h.length>0){for(a[f]=[],r=0;r<h.length;r++)u=o(h[r]),c.test(u)?a[f][r]=parseFloat(u):a[f][r]=u;f++}}return a},numeric.toCSV=function(t){var n=numeric.dim(t),r,i,a,e,c;for(a=n[0],n[1],c=[],r=0;r<a;r++){for(e=[],i=0;i<a;i++)e[i]=t[r][i].toString();c[r]=e.join(", ")}return c.join(`
`)+`
`},numeric.getURL=function(t){var n=new XMLHttpRequest;return n.open("GET",t,!1),n.send(),n},numeric.imageURL=function(t){function n(_){var L=_.length,F,x,O,R,I,l,b,Z,G="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",J="";for(F=0;F<L;F+=3)x=_[F],O=_[F+1],R=_[F+2],I=x>>2,l=((x&3)<<4)+(O>>4),b=((O&15)<<2)+(R>>6),Z=R&63,F+1>=L?b=Z=64:F+2>=L&&(Z=64),J+=G.charAt(I)+G.charAt(l)+G.charAt(b)+G.charAt(Z);return J}function r(_,L,F){typeof L>"u"&&(L=0),typeof F>"u"&&(F=_.length);var x=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],O=-1,R=0;_.length;var I;for(I=L;I<F;I++)R=(O^_[I])&255,O=O>>>8^x[R];return O^-1}var i=t[0].length,a=t[0][0].length,e,c,o,f,h,u,M,m,v,y,S=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,a>>24&255,a>>16&255,a>>8&255,a&255,i>>24&255,i>>16&255,i>>8&255,i&255,8,2,0,0,0,-1,-2,-3,-4,-5,-6,-7,-8,73,68,65,84,8,29];for(y=r(S,12,29),S[29]=y>>24&255,S[30]=y>>16&255,S[31]=y>>8&255,S[32]=y&255,e=1,c=0,M=0;M<i;M++){for(M<i-1?S.push(0):S.push(1),h=3*a+1+(M===0)&255,u=3*a+1+(M===0)>>8&255,S.push(h),S.push(u),S.push(~h&255),S.push(~u&255),M===0&&S.push(0),m=0;m<a;m++)for(o=0;o<3;o++)h=t[o][M][m],h>255?h=255:h<0?h=0:h=Math.round(h),e=(e+h)%65521,c=(c+e)%65521,S.push(h);S.push(0)}return v=(c<<16)+e,S.push(v>>24&255),S.push(v>>16&255),S.push(v>>8&255),S.push(v&255),f=S.length-41,S[33]=f>>24&255,S[34]=f>>16&255,S[35]=f>>8&255,S[36]=f&255,y=r(S,37),S.push(y>>24&255),S.push(y>>16&255),S.push(y>>8&255),S.push(y&255),S.push(0),S.push(0),S.push(0),S.push(0),S.push(73),S.push(69),S.push(78),S.push(68),S.push(174),S.push(66),S.push(96),S.push(130),"data:image/png;base64,"+n(S)},numeric._dim=function(t){for(var n=[];typeof t=="object";)n.push(t.length),t=t[0];return n},numeric.dim=function(t){var n,r;return typeof t=="object"?(n=t[0],typeof n=="object"?(r=n[0],typeof r=="object"?numeric._dim(t):[t.length,n.length]):[t.length]):[]},numeric.mapreduce=function(t,n){return Function("x","accum","_s","_k",'if(typeof accum === "undefined") accum = '+n+`;
if(typeof x === "number") { var xi = x; `+t+`; return accum; }
if(typeof _s === "undefined") _s = numeric.dim(x);
if(typeof _k === "undefined") _k = 0;
var _n = _s[_k];
var i,xi;
if(_k < _s.length-1) {
    for(i=_n-1;i>=0;i--) {
        accum = arguments.callee(x[i],accum,_s,_k+1);
    }    return accum;
}
for(i=_n-1;i>=1;i-=2) { 
    xi = x[i];
    `+t+`;
    xi = x[i-1];
    `+t+`;
}
if(i === 0) {
    xi = x[i];
    `+t+`
}
return accum;`)},numeric.mapreduce2=function(t,n){return Function("x",`var n = x.length;
var i,xi;
`+n+`;
for(i=n-1;i!==-1;--i) { 
    xi = x[i];
    `+t+`;
}
return accum;`)},numeric.same=function p(t,n){var r,i;if(!(t instanceof Array)||!(n instanceof Array)||(i=t.length,i!==n.length))return!1;for(r=0;r<i;r++)if(t[r]!==n[r])if(typeof t[r]=="object"){if(!p(t[r],n[r]))return!1}else return!1;return!0},numeric.rep=function(t,n,r){typeof r>"u"&&(r=0);var i=t[r],a=Array(i),e;if(r===t.length-1){for(e=i-2;e>=0;e-=2)a[e+1]=n,a[e]=n;return e===-1&&(a[0]=n),a}for(e=i-1;e>=0;e--)a[e]=numeric.rep(t,n,r+1);return a},numeric.dotMMsmall=function(t,n){var r,i,a,e,c,o,f,h,u,M,m;for(e=t.length,c=n.length,o=n[0].length,f=Array(e),r=e-1;r>=0;r--){for(h=Array(o),u=t[r],a=o-1;a>=0;a--){for(M=u[c-1]*n[c-1][a],i=c-2;i>=1;i-=2)m=i-1,M+=u[i]*n[i][a]+u[m]*n[m][a];i===0&&(M+=u[0]*n[0][a]),h[a]=M}f[r]=h}return f},numeric._getCol=function(t,n,r){var i=t.length,a;for(a=i-1;a>0;--a)r[a]=t[a][n],--a,r[a]=t[a][n];a===0&&(r[0]=t[0][n])},numeric.dotMMbig=function(t,n){var r=numeric._getCol,i=n.length,a=Array(i),e=t.length,c=n[0].length,o=new Array(e),f,h=numeric.dotVV,u,M;for(--i,--e,u=e;u!==-1;--u)o[u]=Array(c);for(--c,u=c;u!==-1;--u)for(r(n,u,a),M=e;M!==-1;--M)f=t[M],o[M][u]=h(f,a);return o},numeric.dotMV=function(t,n){var r=t.length;n.length;var i,a=Array(r),e=numeric.dotVV;for(i=r-1;i>=0;i--)a[i]=e(t[i],n);return a},numeric.dotVM=function(t,n){var r,i,a,e,c,o,f;for(a=t.length,e=n[0].length,c=Array(e),i=e-1;i>=0;i--){for(o=t[a-1]*n[a-1][i],r=a-2;r>=1;r-=2)f=r-1,o+=t[r]*n[r][i]+t[f]*n[f][i];r===0&&(o+=t[0]*n[0][i]),c[i]=o}return c},numeric.dotVV=function(t,n){var r,i=t.length,a,e=t[i-1]*n[i-1];for(r=i-2;r>=1;r-=2)a=r-1,e+=t[r]*n[r]+t[a]*n[a];return r===0&&(e+=t[0]*n[0]),e},numeric.dot=function(t,n){var r=numeric.dim;switch(r(t).length*1e3+r(n).length){case 2002:return n.length<10?numeric.dotMMsmall(t,n):numeric.dotMMbig(t,n);case 2001:return numeric.dotMV(t,n);case 1002:return numeric.dotVM(t,n);case 1001:return numeric.dotVV(t,n);case 1e3:return numeric.mulVS(t,n);case 1:return numeric.mulSV(t,n);case 0:return t*n;default:throw new Error("numeric.dot only works on vectors and matrices")}},numeric.diag=function(t){var n,r,i,a=t.length,e=Array(a),c;for(n=a-1;n>=0;n--){for(c=Array(a),r=n+2,i=a-1;i>=r;i-=2)c[i]=0,c[i-1]=0;for(i>n&&(c[i]=0),c[n]=t[n],i=n-1;i>=1;i-=2)c[i]=0,c[i-1]=0;i===0&&(c[0]=0),e[n]=c}return e},numeric.getDiag=function(p){var t=Math.min(p.length,p[0].length),n,r=Array(t);for(n=t-1;n>=1;--n)r[n]=p[n][n],--n,r[n]=p[n][n];return n===0&&(r[0]=p[0][0]),r},numeric.identity=function(t){return numeric.diag(numeric.rep([t],1))},numeric.pointwise=function(t,n,r){typeof r>"u"&&(r="");var i=[],a,e=/\[i\]$/,c,o="",f=!1;for(a=0;a<t.length;a++)e.test(t[a])?(c=t[a].substring(0,t[a].length-3),o=c):c=t[a],c==="ret"&&(f=!0),i.push(c);return i[t.length]="_s",i[t.length+1]="_k",i[t.length+2]='if(typeof _s === "undefined") _s = numeric.dim('+o+`);
if(typeof _k === "undefined") _k = 0;
var _n = _s[_k];
var i`+(f?"":", ret = Array(_n)")+`;
if(_k < _s.length-1) {
    for(i=_n-1;i>=0;i--) ret[i] = arguments.callee(`+t.join(",")+`,_s,_k+1);
    return ret;
}
`+r+`
for(i=_n-1;i!==-1;--i) {
    `+n+`
}
return ret;`,Function.apply(null,i)},numeric.pointwise2=function(t,n,r){typeof r>"u"&&(r="");var i=[],a,e=/\[i\]$/,c,o="",f=!1;for(a=0;a<t.length;a++)e.test(t[a])?(c=t[a].substring(0,t[a].length-3),o=c):c=t[a],c==="ret"&&(f=!0),i.push(c);return i[t.length]="var _n = "+o+`.length;
var i`+(f?"":", ret = Array(_n)")+`;
`+r+`
for(i=_n-1;i!==-1;--i) {
`+n+`
}
return ret;`,Function.apply(null,i)},numeric._biforeach=function p(t,n,r,i,a){if(i===r.length-1){a(t,n);return}var e,c=r[i];for(e=c-1;e>=0;e--)p(typeof t=="object"?t[e]:t,typeof n=="object"?n[e]:n,r,i+1,a)},numeric._biforeach2=function p(t,n,r,i,a){if(i===r.length-1)return a(t,n);var e,c=r[i],o=Array(c);for(e=c-1;e>=0;--e)o[e]=p(typeof t=="object"?t[e]:t,typeof n=="object"?n[e]:n,r,i+1,a);return o},numeric._foreach=function p(t,n,r,i){if(r===n.length-1){i(t);return}var a,e=n[r];for(a=e-1;a>=0;a--)p(t[a],n,r+1,i)},numeric._foreach2=function p(t,n,r,i){if(r===n.length-1)return i(t);var a,e=n[r],c=Array(e);for(a=e-1;a>=0;a--)c[a]=p(t[a],n,r+1,i);return c},numeric.ops2={add:"+",sub:"-",mul:"*",div:"/",mod:"%",and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">=",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"},numeric.opseq={addeq:"+=",subeq:"-=",muleq:"*=",diveq:"/=",modeq:"%=",lshifteq:"<<=",rshifteq:">>=",rrshifteq:">>>=",bandeq:"&=",boreq:"|=",bxoreq:"^="},numeric.mathfuns=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan","isNaN","isFinite"],numeric.mathfuns2=["atan2","pow","max","min"],numeric.ops1={neg:"-",not:"!",bnot:"~",clone:""},numeric.mapreducers={any:["if(xi) return true;","var accum = false;"],all:["if(!xi) return false;","var accum = true;"],sum:["accum += xi;","var accum = 0;"],prod:["accum *= xi;","var accum = 1;"],norm2Squared:["accum += xi*xi;","var accum = 0;"],norminf:["accum = max(accum,abs(xi));","var accum = 0, max = Math.max, abs = Math.abs;"],norm1:["accum += abs(xi)","var accum = 0, abs = Math.abs;"],sup:["accum = max(accum,xi);","var accum = -Infinity, max = Math.max;"],inf:["accum = min(accum,xi);","var accum = Infinity, min = Math.min;"]},function(){var p,t;for(p=0;p<numeric.mathfuns2.length;++p)t=numeric.mathfuns2[p],numeric.ops2[t]=t;for(p in numeric.ops2)if(numeric.ops2.hasOwnProperty(p)){t=numeric.ops2[p];var n,r,i="";numeric.myIndexOf.call(numeric.mathfuns2,p)!==-1?(i="var "+t+" = Math."+t+`;
`,n=function(a,e,c){return a+" = "+t+"("+e+","+c+")"},r=function(a,e){return a+" = "+t+"("+a+","+e+")"}):(n=function(a,e,c){return a+" = "+e+" "+t+" "+c},numeric.opseq.hasOwnProperty(p+"eq")?r=function(a,e){return a+" "+t+"= "+e}:r=function(a,e){return a+" = "+a+" "+t+" "+e}),numeric[p+"VV"]=numeric.pointwise2(["x[i]","y[i]"],n("ret[i]","x[i]","y[i]"),i),numeric[p+"SV"]=numeric.pointwise2(["x","y[i]"],n("ret[i]","x","y[i]"),i),numeric[p+"VS"]=numeric.pointwise2(["x[i]","y"],n("ret[i]","x[i]","y"),i),numeric[p]=Function(`var n = arguments.length, i, x = arguments[0], y;
var VV = numeric.`+p+"VV, VS = numeric."+p+"VS, SV = numeric."+p+`SV;
var dim = numeric.dim;
for(i=1;i!==n;++i) { 
  y = arguments[i];
  if(typeof x === "object") {
      if(typeof y === "object") x = numeric._biforeach2(x,y,dim(x),0,VV);
      else x = numeric._biforeach2(x,y,dim(x),0,VS);
  } else if(typeof y === "object") x = numeric._biforeach2(x,y,dim(y),0,SV);
  else `+r("x","y")+`
}
return x;
`),numeric[t]=numeric[p],numeric[p+"eqV"]=numeric.pointwise2(["ret[i]","x[i]"],r("ret[i]","x[i]"),i),numeric[p+"eqS"]=numeric.pointwise2(["ret[i]","x"],r("ret[i]","x"),i),numeric[p+"eq"]=Function(`var n = arguments.length, i, x = arguments[0], y;
var V = numeric.`+p+"eqV, S = numeric."+p+`eqS
var s = numeric.dim(x);
for(i=1;i!==n;++i) { 
  y = arguments[i];
  if(typeof y === "object") numeric._biforeach(x,y,s,0,V);
  else numeric._biforeach(x,y,s,0,S);
}
return x;
`)}for(p=0;p<numeric.mathfuns2.length;++p)t=numeric.mathfuns2[p],delete numeric.ops2[t];for(p=0;p<numeric.mathfuns.length;++p)t=numeric.mathfuns[p],numeric.ops1[t]=t;for(p in numeric.ops1)numeric.ops1.hasOwnProperty(p)&&(i="",t=numeric.ops1[p],numeric.myIndexOf.call(numeric.mathfuns,p)!==-1&&Math.hasOwnProperty(t)&&(i="var "+t+" = Math."+t+`;
`),numeric[p+"eqV"]=numeric.pointwise2(["ret[i]"],"ret[i] = "+t+"(ret[i]);",i),numeric[p+"eq"]=Function("x",'if(typeof x !== "object") return '+t+`x
var i;
var V = numeric.`+p+`eqV;
var s = numeric.dim(x);
numeric._foreach(x,s,0,V);
return x;
`),numeric[p+"V"]=numeric.pointwise2(["x[i]"],"ret[i] = "+t+"(x[i]);",i),numeric[p]=Function("x",'if(typeof x !== "object") return '+t+`(x)
var i;
var V = numeric.`+p+`V;
var s = numeric.dim(x);
return numeric._foreach2(x,s,0,V);
`));for(p=0;p<numeric.mathfuns.length;++p)t=numeric.mathfuns[p],delete numeric.ops1[t];for(p in numeric.mapreducers)numeric.mapreducers.hasOwnProperty(p)&&(t=numeric.mapreducers[p],numeric[p+"V"]=numeric.mapreduce2(t[0],t[1]),numeric[p]=Function("x","s","k",t[1]+`if(typeof x !== "object") {    xi = x;
`+t[0]+`;
    return accum;
}if(typeof s === "undefined") s = numeric.dim(x);
if(typeof k === "undefined") k = 0;
if(k === s.length-1) return numeric.`+p+`V(x);
var xi;
var n = x.length, i;
for(i=n-1;i!==-1;--i) {
   xi = arguments.callee(x[i]);
`+t[0]+`;
}
return accum;
`))}(),numeric.truncVV=numeric.pointwise(["x[i]","y[i]"],"ret[i] = round(x[i]/y[i])*y[i];","var round = Math.round;"),numeric.truncVS=numeric.pointwise(["x[i]","y"],"ret[i] = round(x[i]/y)*y;","var round = Math.round;"),numeric.truncSV=numeric.pointwise(["x","y[i]"],"ret[i] = round(x/y[i])*y[i];","var round = Math.round;"),numeric.trunc=function(t,n){return typeof t=="object"?typeof n=="object"?numeric.truncVV(t,n):numeric.truncVS(t,n):typeof n=="object"?numeric.truncSV(t,n):Math.round(t/n)*n},numeric.inv=function(y){var n=numeric.dim(y),r=Math.abs,i=n[0],a=n[1],e=numeric.clone(y),c,o,f=numeric.identity(i),h,u,M,m,v,y;for(m=0;m<a;++m){var S=-1,_=-1;for(M=m;M!==i;++M)v=r(e[M][m]),v>_&&(S=M,_=v);for(o=e[S],e[S]=e[m],e[m]=o,u=f[S],f[S]=f[m],f[m]=u,y=o[m],v=m;v!==a;++v)o[v]/=y;for(v=a-1;v!==-1;--v)u[v]/=y;for(M=i-1;M!==-1;--M)if(M!==m){for(c=e[M],h=f[M],y=c[m],v=m+1;v!==a;++v)c[v]-=o[v]*y;for(v=a-1;v>0;--v)h[v]-=u[v]*y,--v,h[v]-=u[v]*y;v===0&&(h[0]-=u[0]*y)}}return f},numeric.det=function(t){var n=numeric.dim(t);if(n.length!==2||n[0]!==n[1])throw new Error("numeric: det() only works on square matrices");var r=n[0],i=1,a,e,c,o=numeric.clone(t),f,h,u,M,m;for(e=0;e<r-1;e++){for(c=e,a=e+1;a<r;a++)Math.abs(o[a][e])>Math.abs(o[c][e])&&(c=a);for(c!==e&&(M=o[c],o[c]=o[e],o[e]=M,i*=-1),f=o[e],a=e+1;a<r;a++){for(h=o[a],u=h[e]/f[e],c=e+1;c<r-1;c+=2)m=c+1,h[c]-=f[c]*u,h[m]-=f[m]*u;c!==r&&(h[c]-=f[c]*u)}if(f[e]===0)return 0;i*=f[e]}return i*o[e][e]},numeric.transpose=function(t){var n,r,i=t.length,a=t[0].length,e=Array(a),c,o,f;for(r=0;r<a;r++)e[r]=Array(i);for(n=i-1;n>=1;n-=2){for(o=t[n],c=t[n-1],r=a-1;r>=1;--r)f=e[r],f[n]=o[r],f[n-1]=c[r],--r,f=e[r],f[n]=o[r],f[n-1]=c[r];r===0&&(f=e[0],f[n]=o[0],f[n-1]=c[0])}if(n===0){for(c=t[0],r=a-1;r>=1;--r)e[r][0]=c[r],--r,e[r][0]=c[r];r===0&&(e[0][0]=c[0])}return e},numeric.negtranspose=function(t){var n,r,i=t.length,a=t[0].length,e=Array(a),c,o,f;for(r=0;r<a;r++)e[r]=Array(i);for(n=i-1;n>=1;n-=2){for(o=t[n],c=t[n-1],r=a-1;r>=1;--r)f=e[r],f[n]=-o[r],f[n-1]=-c[r],--r,f=e[r],f[n]=-o[r],f[n-1]=-c[r];r===0&&(f=e[0],f[n]=-o[0],f[n-1]=-c[0])}if(n===0){for(c=t[0],r=a-1;r>=1;--r)e[r][0]=-c[r],--r,e[r][0]=-c[r];r===0&&(e[0][0]=-c[0])}return e},numeric._random=function p(t,n){var r,i=t[n],a=Array(i),e;if(n===t.length-1){for(e=Math.random,r=i-1;r>=1;r-=2)a[r]=e(),a[r-1]=e();return r===0&&(a[0]=e()),a}for(r=i-1;r>=0;r--)a[r]=p(t,n+1);return a},numeric.random=function(t){return numeric._random(t,0)},numeric.norm2=function(t){return Math.sqrt(numeric.norm2Squared(t))},numeric.linspace=function(t,n,r){if(typeof r>"u"&&(r=Math.max(Math.round(n-t)+1,1)),r<2)return r===1?[t]:[];var i,a=Array(r);for(r--,i=r;i>=0;i--)a[i]=(i*n+(r-i)*t)/r;return a},numeric.getBlock=function(t,n,r){var i=numeric.dim(t);function a(e,c){var o,f=n[c],h=r[c]-f,u=Array(h);if(c===i.length-1){for(o=h;o>=0;o--)u[o]=e[o+f];return u}for(o=h;o>=0;o--)u[o]=a(e[o+f],c+1);return u}return a(t,0)},numeric.setBlock=function(t,n,r,i){var a=numeric.dim(t);function e(c,o,f){var h,u=n[f],M=r[f]-u;if(f===a.length-1)for(h=M;h>=0;h--)c[h+u]=o[h];for(h=M;h>=0;h--)e(c[h+u],o[h],f+1)}return e(t,i,0),t},numeric.getRange=function(t,n,r){var i=n.length,a=r.length,e,c,o=Array(i),f,h;for(e=i-1;e!==-1;--e)for(o[e]=Array(a),f=o[e],h=t[n[e]],c=a-1;c!==-1;--c)f[c]=h[r[c]];return o},numeric.blockMatrix=function(t){var n=numeric.dim(t);if(n.length<4)return numeric.blockMatrix([t]);var r=n[0],i=n[1],a,e,c,o,f;for(a=0,e=0,c=0;c<r;++c)a+=t[c][0].length;for(o=0;o<i;++o)e+=t[0][o][0].length;var h=Array(a);for(c=0;c<a;++c)h[c]=Array(e);var u=0,M,m,v,y,S;for(c=0;c<r;++c){for(M=e,o=i-1;o!==-1;--o)for(f=t[c][o],M-=f[0].length,v=f.length-1;v!==-1;--v)for(S=f[v],m=h[u+v],y=S.length-1;y!==-1;--y)m[M+y]=S[y];u+=t[c][0].length}return h},numeric.tensor=function(t,n){if(typeof t=="number"||typeof n=="number")return numeric.mul(t,n);var r=numeric.dim(t),i=numeric.dim(n);if(r.length!==1||i.length!==1)throw new Error("numeric: tensor product is only defined for vectors");var a=r[0],e=i[0],c=Array(a),o,f,h,u;for(f=a-1;f>=0;f--){for(o=Array(e),u=t[f],h=e-1;h>=3;--h)o[h]=u*n[h],--h,o[h]=u*n[h],--h,o[h]=u*n[h],--h,o[h]=u*n[h];for(;h>=0;)o[h]=u*n[h],--h;c[f]=o}return c},numeric.T=function(t,n){this.x=t,this.y=n},numeric.t=function(t,n){return new numeric.T(t,n)},numeric.Tbinop=function(t,n,r,i,a){if(numeric.indexOf,typeof a!="string"){var e;a="";for(e in numeric)numeric.hasOwnProperty(e)&&(t.indexOf(e)>=0||n.indexOf(e)>=0||r.indexOf(e)>=0||i.indexOf(e)>=0)&&e.length>1&&(a+="var "+e+" = numeric."+e+`;
`)}return Function(["y"],`var x = this;
if(!(y instanceof numeric.T)) { y = new numeric.T(y); }
`+a+`
if(x.y) {  if(y.y) {    return new numeric.T(`+i+`);
  }
  return new numeric.T(`+r+`);
}
if(y.y) {
  return new numeric.T(`+n+`);
}
return new numeric.T(`+t+`);
`)},numeric.T.prototype.add=numeric.Tbinop("add(x.x,y.x)","add(x.x,y.x),y.y","add(x.x,y.x),x.y","add(x.x,y.x),add(x.y,y.y)"),numeric.T.prototype.sub=numeric.Tbinop("sub(x.x,y.x)","sub(x.x,y.x),neg(y.y)","sub(x.x,y.x),x.y","sub(x.x,y.x),sub(x.y,y.y)"),numeric.T.prototype.mul=numeric.Tbinop("mul(x.x,y.x)","mul(x.x,y.x),mul(x.x,y.y)","mul(x.x,y.x),mul(x.y,y.x)","sub(mul(x.x,y.x),mul(x.y,y.y)),add(mul(x.x,y.y),mul(x.y,y.x))"),numeric.T.prototype.reciprocal=function(){var t=numeric.mul,n=numeric.div;if(this.y){var r=numeric.add(t(this.x,this.x),t(this.y,this.y));return new numeric.T(n(this.x,r),n(numeric.neg(this.y),r))}return new T(n(1,this.x))},numeric.T.prototype.div=function(t){if(t instanceof numeric.T||(t=new numeric.T(t)),t.y)return this.mul(t.reciprocal());var n=numeric.div;return this.y?new numeric.T(n(this.x,t.x),n(this.y,t.x)):new numeric.T(n(this.x,t.x))},numeric.T.prototype.dot=numeric.Tbinop("dot(x.x,y.x)","dot(x.x,y.x),dot(x.x,y.y)","dot(x.x,y.x),dot(x.y,y.x)","sub(dot(x.x,y.x),dot(x.y,y.y)),add(dot(x.x,y.y),dot(x.y,y.x))"),numeric.T.prototype.transpose=function(){var t=numeric.transpose,n=this.x,r=this.y;return r?new numeric.T(t(n),t(r)):new numeric.T(t(n))},numeric.T.prototype.transjugate=function(){var t=numeric.transpose,n=this.x,r=this.y;return r?new numeric.T(t(n),numeric.negtranspose(r)):new numeric.T(t(n))},numeric.Tunop=function(t,n,r){return typeof r!="string"&&(r=""),Function(`var x = this;
`+r+`
if(x.y) {  `+n+`;
}
`+t+`;
`)},numeric.T.prototype.exp=numeric.Tunop("return new numeric.T(ex)","return new numeric.T(mul(cos(x.y),ex),mul(sin(x.y),ex))","var ex = numeric.exp(x.x), cos = numeric.cos, sin = numeric.sin, mul = numeric.mul;"),numeric.T.prototype.conj=numeric.Tunop("return new numeric.T(x.x);","return new numeric.T(x.x,numeric.neg(x.y));"),numeric.T.prototype.neg=numeric.Tunop("return new numeric.T(neg(x.x));","return new numeric.T(neg(x.x),neg(x.y));","var neg = numeric.neg;"),numeric.T.prototype.sin=numeric.Tunop("return new numeric.T(numeric.sin(x.x))","return x.exp().sub(x.neg().exp()).div(new numeric.T(0,2));"),numeric.T.prototype.cos=numeric.Tunop("return new numeric.T(numeric.cos(x.x))","return x.exp().add(x.neg().exp()).div(2);"),numeric.T.prototype.abs=numeric.Tunop("return new numeric.T(numeric.abs(x.x));","return new numeric.T(numeric.sqrt(numeric.add(mul(x.x,x.x),mul(x.y,x.y))));","var mul = numeric.mul;"),numeric.T.prototype.log=numeric.Tunop("return new numeric.T(numeric.log(x.x));",`var theta = new numeric.T(numeric.atan2(x.y,x.x)), r = x.abs();
return new numeric.T(numeric.log(r.x),theta.x);`),numeric.T.prototype.norm2=numeric.Tunop("return numeric.norm2(x.x);",`var f = numeric.norm2Squared;
return Math.sqrt(f(x.x)+f(x.y));`),numeric.T.prototype.inv=function(){var t=this;if(typeof t.y>"u")return new numeric.T(numeric.inv(t.x));var n=t.x.length,y,S,_,r=numeric.identity(n),i=numeric.rep([n,n],0),a=numeric.clone(t.x),e=numeric.clone(t.y),c,o,f,h,u,M,m,v,y,S,_,L,F,x,O,R,I,l;for(y=0;y<n;y++){for(x=a[y][y],O=e[y][y],L=x*x+O*O,_=y,S=y+1;S<n;S++)x=a[S][y],O=e[S][y],F=x*x+O*O,F>L&&(_=S,L=F);for(_!==y&&(l=a[y],a[y]=a[_],a[_]=l,l=e[y],e[y]=e[_],e[_]=l,l=r[y],r[y]=r[_],r[_]=l,l=i[y],i[y]=i[_],i[_]=l),c=a[y],o=e[y],u=r[y],M=i[y],x=c[y],O=o[y],S=y+1;S<n;S++)R=c[S],I=o[S],c[S]=(R*x+I*O)/L,o[S]=(I*x-R*O)/L;for(S=0;S<n;S++)R=u[S],I=M[S],u[S]=(R*x+I*O)/L,M[S]=(I*x-R*O)/L;for(S=y+1;S<n;S++){for(f=a[S],h=e[S],m=r[S],v=i[S],x=f[y],O=h[y],_=y+1;_<n;_++)R=c[_],I=o[_],f[_]-=R*x-I*O,h[_]-=I*x+R*O;for(_=0;_<n;_++)R=u[_],I=M[_],m[_]-=R*x-I*O,v[_]-=I*x+R*O}}for(y=n-1;y>0;y--)for(u=r[y],M=i[y],S=y-1;S>=0;S--)for(m=r[S],v=i[S],x=a[S][y],O=e[S][y],_=n-1;_>=0;_--)R=u[_],I=M[_],m[_]-=x*R-O*I,v[_]-=x*I+O*R;return new numeric.T(r,i)},numeric.T.prototype.get=function(t){var n=this.x,r=this.y,i=0,a,e=t.length;if(r){for(;i<e;)a=t[i],n=n[a],r=r[a],i++;return new numeric.T(n,r)}for(;i<e;)a=t[i],n=n[a],i++;return new numeric.T(n)},numeric.T.prototype.set=function(t,n){var r=this.x,i=this.y,a=0,e,c=t.length,o=n.x,f=n.y;if(c===0)return f?this.y=f:i&&(this.y=void 0),this.x=r,this;if(f){for(i||(i=numeric.rep(numeric.dim(r),0),this.y=i);a<c-1;)e=t[a],r=r[e],i=i[e],a++;return e=t[a],r[e]=o,i[e]=f,this}if(i){for(;a<c-1;)e=t[a],r=r[e],i=i[e],a++;return e=t[a],r[e]=o,o instanceof Array?i[e]=numeric.rep(numeric.dim(o),0):i[e]=0,this}for(;a<c-1;)e=t[a],r=r[e],a++;return e=t[a],r[e]=o,this},numeric.T.prototype.getRows=function(t,n){var r=n-t+1,i,a=Array(r),e,c=this.x,o=this.y;for(i=t;i<=n;i++)a[i-t]=c[i];if(o){for(e=Array(r),i=t;i<=n;i++)e[i-t]=o[i];return new numeric.T(a,e)}return new numeric.T(a)},numeric.T.prototype.setRows=function(t,n,r){var i,a=this.x,e=this.y,c=r.x,o=r.y;for(i=t;i<=n;i++)a[i]=c[i-t];if(o)for(e||(e=numeric.rep(numeric.dim(a),0),this.y=e),i=t;i<=n;i++)e[i]=o[i-t];else if(e)for(i=t;i<=n;i++)e[i]=numeric.rep([c[i-t].length],0);return this},numeric.T.prototype.getRow=function(t){var n=this.x,r=this.y;return r?new numeric.T(n[t],r[t]):new numeric.T(n[t])},numeric.T.prototype.setRow=function(t,n){var r=this.x,i=this.y,a=n.x,e=n.y;return r[t]=a,e?(i||(i=numeric.rep(numeric.dim(r),0),this.y=i),i[t]=e):i&&(i=numeric.rep([a.length],0)),this},numeric.T.prototype.getBlock=function(t,n){var r=this.x,i=this.y,a=numeric.getBlock;return i?new numeric.T(a(r,t,n),a(i,t,n)):new numeric.T(a(r,t,n))},numeric.T.prototype.setBlock=function(t,n,r){r instanceof numeric.T||(r=new numeric.T(r));var i=this.x,a=this.y,e=numeric.setBlock,c=r.x,o=r.y;if(o)return a||(this.y=numeric.rep(numeric.dim(this),0),a=this.y),e(i,t,n,c),e(a,t,n,o),this;e(i,t,n,c),a&&e(a,t,n,numeric.rep(numeric.dim(c),0))},numeric.T.rep=function(t,n){var r=numeric.T;n instanceof r||(n=new r(n));var i=n.x,a=n.y,e=numeric.rep;return a?new r(e(t,i),e(t,a)):new r(e(t,i))},numeric.T.diag=function(t){t instanceof numeric.T||(t=new numeric.T(t));var n=t.x,r=t.y,i=numeric.diag;return r?new numeric.T(i(n),i(r)):new numeric.T(i(n))},numeric.T.eig=function(){if(this.y)throw new Error("eig: not implemented for complex matrices.");return numeric.eig(this.x)},numeric.T.identity=function(t){return new numeric.T(numeric.identity(t))},numeric.T.prototype.getDiag=function(){var t=numeric,n=this.x,r=this.y;return r?new t.T(t.getDiag(n),t.getDiag(r)):new t.T(t.getDiag(n))},numeric.house=function(t){var n=numeric.clone(t),r=t[0]>=0?1:-1,i=r*numeric.norm2(t);n[0]+=i;var a=numeric.norm2(n);if(a===0)throw new Error("eig: internal error");return numeric.div(n,a)},numeric.toUpperHessenberg=function(t){var n=numeric.dim(t);if(n.length!==2||n[0]!==n[1])throw new Error("numeric: toUpperHessenberg() only works on square matrices");var r=n[0],i,a,e,c,o,f=numeric.clone(t),h,u,M,m,v=numeric.identity(r),y;for(a=0;a<r-2;a++){for(c=Array(r-a-1),i=a+1;i<r;i++)c[i-a-1]=f[i][a];if(numeric.norm2(c)>0){for(o=numeric.house(c),h=numeric.getBlock(f,[a+1,a],[r-1,r-1]),u=numeric.tensor(o,numeric.dot(o,h)),i=a+1;i<r;i++)for(M=f[i],m=u[i-a-1],e=a;e<r;e++)M[e]-=2*m[e-a];for(h=numeric.getBlock(f,[0,a+1],[r-1,r-1]),u=numeric.tensor(numeric.dot(h,o),o),i=0;i<r;i++)for(M=f[i],m=u[i],e=a+1;e<r;e++)M[e]-=2*m[e-a-1];for(h=Array(r-a-1),i=a+1;i<r;i++)h[i-a-1]=v[i];for(u=numeric.tensor(o,numeric.dot(o,h)),i=a+1;i<r;i++)for(y=v[i],m=u[i-a-1],e=0;e<r;e++)y[e]-=2*m[e]}}return{H:f,Q:v}},numeric.epsilon=2220446049250313e-31,numeric.QRFrancis=function(p,t){typeof t>"u"&&(t=1e4),p=numeric.clone(p),numeric.clone(p);var n=numeric.dim(p),r=n[0],i,a,e,c,o,f,h,u,M,m=numeric.identity(r),v,y,S,_,L,F,x,O,R;if(r<3)return{Q:m,B:[[0,r-1]]};var I=numeric.epsilon;for(R=0;R<t;R++){for(x=0;x<r-1;x++)if(Math.abs(p[x+1][x])<I*(Math.abs(p[x][x])+Math.abs(p[x+1][x+1]))){var l=numeric.QRFrancis(numeric.getBlock(p,[0,0],[x,x]),t),b=numeric.QRFrancis(numeric.getBlock(p,[x+1,x+1],[r-1,r-1]),t);for(S=Array(x+1),F=0;F<=x;F++)S[F]=m[F];for(_=numeric.dot(l.Q,S),F=0;F<=x;F++)m[F]=_[F];for(S=Array(r-x-1),F=x+1;F<r;F++)S[F-x-1]=m[F];for(_=numeric.dot(b.Q,S),F=x+1;F<r;F++)m[F]=_[F-x-1];return{Q:m,B:l.B.concat(numeric.add(b.B,x+1))}}if(e=p[r-2][r-2],c=p[r-2][r-1],o=p[r-1][r-2],f=p[r-1][r-1],u=e+f,h=e*f-c*o,M=numeric.getBlock(p,[0,0],[2,2]),u*u>=4*h){var Z,G;Z=.5*(u+Math.sqrt(u*u-4*h)),G=.5*(u-Math.sqrt(u*u-4*h)),M=numeric.add(numeric.sub(numeric.dot(M,M),numeric.mul(M,Z+G)),numeric.diag(numeric.rep([3],Z*G)))}else M=numeric.add(numeric.sub(numeric.dot(M,M),numeric.mul(M,u)),numeric.diag(numeric.rep([3],h)));for(i=[M[0][0],M[1][0],M[2][0]],a=numeric.house(i),S=[p[0],p[1],p[2]],_=numeric.tensor(a,numeric.dot(a,S)),F=0;F<3;F++)for(y=p[F],L=_[F],O=0;O<r;O++)y[O]-=2*L[O];for(S=numeric.getBlock(p,[0,0],[r-1,2]),_=numeric.tensor(numeric.dot(S,a),a),F=0;F<r;F++)for(y=p[F],L=_[F],O=0;O<3;O++)y[O]-=2*L[O];for(S=[m[0],m[1],m[2]],_=numeric.tensor(a,numeric.dot(a,S)),F=0;F<3;F++)for(v=m[F],L=_[F],O=0;O<r;O++)v[O]-=2*L[O];var J;for(x=0;x<r-2;x++){for(O=x;O<=x+1;O++)if(Math.abs(p[O+1][O])<I*(Math.abs(p[O][O])+Math.abs(p[O+1][O+1]))){var l=numeric.QRFrancis(numeric.getBlock(p,[0,0],[O,O]),t),b=numeric.QRFrancis(numeric.getBlock(p,[O+1,O+1],[r-1,r-1]),t);for(S=Array(O+1),F=0;F<=O;F++)S[F]=m[F];for(_=numeric.dot(l.Q,S),F=0;F<=O;F++)m[F]=_[F];for(S=Array(r-O-1),F=O+1;F<r;F++)S[F-O-1]=m[F];for(_=numeric.dot(b.Q,S),F=O+1;F<r;F++)m[F]=_[F-O-1];return{Q:m,B:l.B.concat(numeric.add(b.B,O+1))}}for(J=Math.min(r-1,x+3),i=Array(J-x),F=x+1;F<=J;F++)i[F-x-1]=p[F][x];for(a=numeric.house(i),S=numeric.getBlock(p,[x+1,x],[J,r-1]),_=numeric.tensor(a,numeric.dot(a,S)),F=x+1;F<=J;F++)for(y=p[F],L=_[F-x-1],O=x;O<r;O++)y[O]-=2*L[O-x];for(S=numeric.getBlock(p,[0,x+1],[r-1,J]),_=numeric.tensor(numeric.dot(S,a),a),F=0;F<r;F++)for(y=p[F],L=_[F],O=x+1;O<=J;O++)y[O]-=2*L[O-x-1];for(S=Array(J-x),F=x+1;F<=J;F++)S[F-x-1]=m[F];for(_=numeric.tensor(a,numeric.dot(a,S)),F=x+1;F<=J;F++)for(v=m[F],L=_[F-x-1],O=0;O<r;O++)v[O]-=2*L[O]}}throw new Error("numeric: eigenvalue iteration does not converge -- increase maxiter?")},numeric.eig=function(t,n){var r=numeric.toUpperHessenberg(t),i=numeric.QRFrancis(r.H,n),a=numeric.T,ee=t.length,e,c,o=i.B,f=numeric.dot(i.Q,numeric.dot(r.H,numeric.transpose(i.Q))),h=new a(numeric.dot(i.Q,r.Q)),u,M=o.length,m,v,y,S,_,L,F,x,O,R,I,l,b,Z,G=Math.sqrt;for(c=0;c<M;c++)if(e=o[c][0],e!==o[c][1]){if(m=e+1,v=f[e][e],y=f[e][m],S=f[m][e],_=f[m][m],y===0&&S===0)continue;L=-v-_,F=v*_-y*S,x=L*L-4*F,x>=0?(L<0?O=-.5*(L-G(x)):O=-.5*(L+G(x)),b=(v-O)*(v-O)+y*y,Z=S*S+(_-O)*(_-O),b>Z?(b=G(b),I=(v-O)/b,l=y/b):(Z=G(Z),I=S/Z,l=(_-O)/Z),u=new a([[l,-I],[I,l]]),h.setRows(e,m,u.dot(h.getRows(e,m)))):(O=-.5*L,R=.5*G(-x),b=(v-O)*(v-O)+y*y,Z=S*S+(_-O)*(_-O),b>Z?(b=G(b+R*R),I=(v-O)/b,l=y/b,O=0,R/=b):(Z=G(Z+R*R),I=S/Z,l=(_-O)/Z,O=R/Z,R=0),u=new a([[l,-I],[I,l]],[[O,R],[R,-O]]),h.setRows(e,m,u.dot(h.getRows(e,m))))}var J=h.dot(t).dot(h.transjugate()),ee=t.length,se=numeric.T.identity(ee);for(m=0;m<ee;m++)if(m>0)for(c=m-1;c>=0;c--){var Ae=J.get([c,c]),De=J.get([m,m]);if(numeric.neq(Ae.x,De.x)||numeric.neq(Ae.y,De.y))O=J.getRow(c).getBlock([c],[m-1]),R=se.getRow(m).getBlock([c],[m-1]),se.set([m,c],J.get([c,m]).neg().sub(O.dot(R)).div(Ae.sub(De)));else{se.setRow(m,se.getRow(c));continue}}for(m=0;m<ee;m++)O=se.getRow(m),se.setRow(m,O.div(O.norm2()));return se=se.transpose(),se=h.transjugate().dot(se),{lambda:J.getDiag(),E:se}},numeric.ccsSparse=function(t){var n=t.length,c,r,i,a,e=[];for(i=n-1;i!==-1;--i){r=t[i];for(a in r){for(a=parseInt(a);a>=e.length;)e[e.length]=0;r[a]!==0&&e[a]++}}var c=e.length,o=Array(c+1);for(o[0]=0,i=0;i<c;++i)o[i+1]=o[i]+e[i];var f=Array(o[c]),h=Array(o[c]);for(i=n-1;i!==-1;--i){r=t[i];for(a in r)r[a]!==0&&(e[a]--,f[o[a]+e[a]]=i,h[o[a]+e[a]]=r[a])}return[o,f,h]},numeric.ccsFull=function(t){var n=t[0],r=t[1],i=t[2],a=numeric.ccsDim(t),e=a[0],c=a[1],o,f,h,u,M=numeric.rep([e,c],0);for(o=0;o<c;o++)for(h=n[o],u=n[o+1],f=h;f<u;++f)M[r[f]][o]=i[f];return M},numeric.ccsTSolve=function(t,n,r,i,a){var e=t[0],c=t[1],o=t[2],f=e.length-1,h=Math.max,u=0;typeof i>"u"&&(r=numeric.rep([f],0)),typeof i>"u"&&(i=numeric.linspace(0,r.length-1)),typeof a>"u"&&(a=[]);function M(x){var O;if(r[x]===0){for(r[x]=1,O=e[x];O<e[x+1];++O)M(c[O]);a[u]=x,++u}}var m,v,y,S,_,L,F;for(m=i.length-1;m!==-1;--m)M(i[m]);for(a.length=u,m=a.length-1;m!==-1;--m)r[a[m]]=0;for(m=i.length-1;m!==-1;--m)v=i[m],r[v]=n[v];for(m=a.length-1;m!==-1;--m){for(v=a[m],y=e[v],S=h(e[v+1],y),_=y;_!==S;++_)if(c[_]===v){r[v]/=o[_];break}for(F=r[v],_=y;_!==S;++_)L=c[_],L!==v&&(r[L]-=F*o[_])}return r},numeric.ccsDFS=function(t){this.k=Array(t),this.k1=Array(t),this.j=Array(t)},numeric.ccsDFS.prototype.dfs=function(t,n,r,i,a,e){var c=0,o,f=a.length,h=this.k,u=this.k1,M=this.j,m,v;if(i[t]===0)for(i[t]=1,M[0]=t,h[0]=m=n[t],u[0]=v=n[t+1];;)if(m>=v){if(a[f]=M[c],c===0)return;++f,--c,m=h[c],v=u[c]}else o=e[r[m]],i[o]===0?(i[o]=1,h[c]=m,++c,M[c]=o,m=n[o],u[c]=v=n[o+1]):++m},numeric.ccsLPSolve=function(t,n,r,i,a,e,c){var o=t[0],f=t[1],h=t[2];o.length-1;var u=n[0],M=n[1],m=n[2],v,y,S,_,L,F,x,O,R;for(y=u[a],S=u[a+1],i.length=0,v=y;v<S;++v)c.dfs(e[M[v]],o,f,r,i,e);for(v=i.length-1;v!==-1;--v)r[i[v]]=0;for(v=y;v!==S;++v)_=e[M[v]],r[_]=m[v];for(v=i.length-1;v!==-1;--v){for(_=i[v],L=o[_],F=o[_+1],x=L;x<F;++x)if(e[f[x]]===_){r[_]/=h[x];break}for(R=r[_],x=L;x<F;++x)O=e[f[x]],O!==_&&(r[O]-=R*h[x])}return r},numeric.ccsLUP1=function(t,n){var r=t[0].length-1,i=[numeric.rep([r+1],0),[],[]],a=[numeric.rep([r+1],0),[],[]],e=i[0],c=i[1],o=i[2],f=a[0],h=a[1],u=a[2],M=numeric.rep([r],0),m=numeric.rep([r],0),v,y,S,_,L,F,x,O=numeric.ccsLPSolve,R=Math.abs,I=numeric.linspace(0,r-1),l=numeric.linspace(0,r-1),b=new numeric.ccsDFS(r);for(typeof n>"u"&&(n=1),v=0;v<r;++v){for(O(i,t,M,m,v,l,b),_=-1,L=-1,y=m.length-1;y!==-1;--y)S=m[y],!(S<=v)&&(F=R(M[S]),F>_&&(L=S,_=F));for(R(M[v])<n*_&&(y=I[v],_=I[L],I[v]=_,l[_]=v,I[L]=y,l[y]=L,_=M[v],M[v]=M[L],M[L]=_),_=e[v],L=f[v],x=M[v],c[_]=I[v],o[_]=1,++_,y=m.length-1;y!==-1;--y)S=m[y],F=M[S],m[y]=0,M[S]=0,S<=v?(h[L]=S,u[L]=F,++L):(c[_]=I[S],o[_]=F/x,++_);e[v+1]=_,f[v+1]=L}for(y=c.length-1;y!==-1;--y)c[y]=l[c[y]];return{L:i,U:a,P:I,Pinv:l}},numeric.ccsDFS0=function(t){this.k=Array(t),this.k1=Array(t),this.j=Array(t)},numeric.ccsDFS0.prototype.dfs=function(t,n,r,i,a,e,c){var o=0,f,h=a.length,u=this.k,M=this.k1,m=this.j,v,y;if(i[t]===0)for(i[t]=1,m[0]=t,u[0]=v=n[e[t]],M[0]=y=n[e[t]+1];;){if(isNaN(v))throw new Error("Ow!");if(v>=y){if(a[h]=e[m[o]],o===0)return;++h,--o,v=u[o],y=M[o]}else f=r[v],i[f]===0?(i[f]=1,u[o]=v,++o,m[o]=f,f=e[f],v=n[f],M[o]=y=n[f+1]):++v}},numeric.ccsLPSolve0=function(t,n,r,i,a,e,c,o){var f=t[0],h=t[1],u=t[2];f.length-1;var M=n[0],m=n[1],v=n[2],y,S,_,L,F,x,O,R,I;for(S=M[a],_=M[a+1],i.length=0,y=S;y<_;++y)o.dfs(m[y],f,h,r,i,e,c);for(y=i.length-1;y!==-1;--y)L=i[y],r[c[L]]=0;for(y=S;y!==_;++y)L=m[y],r[L]=v[y];for(y=i.length-1;y!==-1;--y){for(L=i[y],R=c[L],F=f[L],x=f[L+1],O=F;O<x;++O)if(h[O]===R){r[R]/=u[O];break}for(I=r[R],O=F;O<x;++O)r[h[O]]-=I*u[O];r[R]=I}},numeric.ccsLUP0=function(t,n){var r=t[0].length-1,i=[numeric.rep([r+1],0),[],[]],a=[numeric.rep([r+1],0),[],[]],e=i[0],c=i[1],o=i[2],f=a[0],h=a[1],u=a[2],M=numeric.rep([r],0),m=numeric.rep([r],0),v,y,S,_,L,F,x,O=numeric.ccsLPSolve0,R=Math.abs,I=numeric.linspace(0,r-1),l=numeric.linspace(0,r-1),b=new numeric.ccsDFS0(r);for(typeof n>"u"&&(n=1),v=0;v<r;++v){for(O(i,t,M,m,v,l,I,b),_=-1,L=-1,y=m.length-1;y!==-1;--y)S=m[y],!(S<=v)&&(F=R(M[I[S]]),F>_&&(L=S,_=F));for(R(M[I[v]])<n*_&&(y=I[v],_=I[L],I[v]=_,l[_]=v,I[L]=y,l[y]=L),_=e[v],L=f[v],x=M[I[v]],c[_]=I[v],o[_]=1,++_,y=m.length-1;y!==-1;--y)S=m[y],F=M[I[S]],m[y]=0,M[I[S]]=0,S<=v?(h[L]=S,u[L]=F,++L):(c[_]=I[S],o[_]=F/x,++_);e[v+1]=_,f[v+1]=L}for(y=c.length-1;y!==-1;--y)c[y]=l[c[y]];return{L:i,U:a,P:I,Pinv:l}},numeric.ccsLUP=numeric.ccsLUP0,numeric.ccsDim=function(t){return[numeric.sup(t[1])+1,t[0].length-1]},numeric.ccsGetBlock=function(t,n,r){var i=numeric.ccsDim(t),a=i[0],e=i[1];typeof n>"u"?n=numeric.linspace(0,a-1):typeof n=="number"&&(n=[n]),typeof r>"u"?r=numeric.linspace(0,e-1):typeof r=="number"&&(r=[r]);var c,o=n.length,f,h=r.length,u,M,m,v=numeric.rep([e],0),y=[],S=[],_=[v,y,S],L=t[0],F=t[1],x=t[2],O=numeric.rep([a],0),R=0,I=numeric.rep([a],0);for(f=0;f<h;++f){M=r[f];var l=L[M],b=L[M+1];for(c=l;c<b;++c)u=F[c],I[u]=1,O[u]=x[c];for(c=0;c<o;++c)m=n[c],I[m]&&(y[R]=c,S[R]=O[n[c]],++R);for(c=l;c<b;++c)u=F[c],I[u]=0;v[f+1]=R}return _},numeric.ccsDot=function(t,n){var r=t[0],i=t[1],a=t[2],e=n[0],c=n[1],o=n[2],f=numeric.ccsDim(t),h=numeric.ccsDim(n),u=f[0];f[1];var M=h[1],m=numeric.rep([u],0),v=numeric.rep([u],0),y=Array(u),S=numeric.rep([M],0),_=[],L=[],F=[S,_,L],x,O,R,I,l,b,Z,G,J,ee,se;for(R=0;R!==M;++R){for(I=e[R],l=e[R+1],J=0,O=I;O<l;++O)for(ee=c[O],se=o[O],b=r[ee],Z=r[ee+1],x=b;x<Z;++x)G=i[x],v[G]===0&&(y[J]=G,v[G]=1,J=J+1),m[G]=m[G]+a[x]*se;for(I=S[R],l=I+J,S[R+1]=l,O=J-1;O!==-1;--O)se=I+O,x=y[O],_[se]=x,L[se]=m[x],v[x]=0,m[x]=0;S[R+1]=S[R]+J}return F},numeric.ccsLUPSolve=function(t,n){var r=t.L,i=t.U;t.P;var a=n[0],e=!1;typeof a!="object"&&(n=[[0,n.length],numeric.linspace(0,n.length-1),n],a=n[0],e=!0);var c=n[1],o=n[2],f=r[0].length-1,h=a.length-1,u=numeric.rep([f],0),M=Array(f),m=numeric.rep([f],0),v=Array(f),y=numeric.rep([h+1],0),S=[],_=[],L=numeric.ccsTSolve,F,x,O,R,I,l,b=0;for(F=0;F<h;++F){for(I=0,O=a[F],R=a[F+1],x=O;x<R;++x)l=t.Pinv[c[x]],v[I]=l,m[l]=o[x],++I;for(v.length=I,L(r,m,u,v,M),x=v.length-1;x!==-1;--x)m[v[x]]=0;if(L(i,u,m,M,v),e)return m;for(x=M.length-1;x!==-1;--x)u[M[x]]=0;for(x=v.length-1;x!==-1;--x)l=v[x],S[b]=l,_[b]=m[l],m[l]=0,++b;y[F+1]=b}return[y,S,_]},numeric.ccsbinop=function(t,n){return typeof n>"u"&&(n=""),Function("X","Y",`var Xi = X[0], Xj = X[1], Xv = X[2];
var Yi = Y[0], Yj = Y[1], Yv = Y[2];
var n = Xi.length-1,m = Math.max(numeric.sup(Xj),numeric.sup(Yj))+1;
var Zi = numeric.rep([n+1],0), Zj = [], Zv = [];
var x = numeric.rep([m],0),y = numeric.rep([m],0);
var xk,yk,zk;
var i,j,j0,j1,k,p=0;
`+n+`for(i=0;i<n;++i) {
  j0 = Xi[i]; j1 = Xi[i+1];
  for(j=j0;j!==j1;++j) {
    k = Xj[j];
    x[k] = 1;
    Zj[p] = k;
    ++p;
  }
  j0 = Yi[i]; j1 = Yi[i+1];
  for(j=j0;j!==j1;++j) {
    k = Yj[j];
    y[k] = Yv[j];
    if(x[k] === 0) {
      Zj[p] = k;
      ++p;
    }
  }
  Zi[i+1] = p;
  j0 = Xi[i]; j1 = Xi[i+1];
  for(j=j0;j!==j1;++j) x[Xj[j]] = Xv[j];
  j0 = Zi[i]; j1 = Zi[i+1];
  for(j=j0;j!==j1;++j) {
    k = Zj[j];
    xk = x[k];
    yk = y[k];
`+t+`
    Zv[j] = zk;
  }
  j0 = Xi[i]; j1 = Xi[i+1];
  for(j=j0;j!==j1;++j) x[Xj[j]] = 0;
  j0 = Yi[i]; j1 = Yi[i+1];
  for(j=j0;j!==j1;++j) y[Yj[j]] = 0;
}
return [Zi,Zj,Zv];`)},function(){var k,A,B,C;for(k in numeric.ops2)isFinite(eval("1"+numeric.ops2[k]+"0"))?A="[Y[0],Y[1],numeric."+k+"(X,Y[2])]":A="NaN",isFinite(eval("0"+numeric.ops2[k]+"1"))?B="[X[0],X[1],numeric."+k+"(X[2],Y)]":B="NaN",isFinite(eval("1"+numeric.ops2[k]+"0"))&&isFinite(eval("0"+numeric.ops2[k]+"1"))?C="numeric.ccs"+k+"MM(X,Y)":C="NaN",numeric["ccs"+k+"MM"]=numeric.ccsbinop("zk = xk "+numeric.ops2[k]+"yk;"),numeric["ccs"+k]=Function("X","Y",'if(typeof X === "number") return '+A+`;
if(typeof Y === "number") return `+B+`;
return `+C+`;
`)}(),numeric.ccsScatter=function p(t){var n=t[0],r=t[1],i=t[2],a=numeric.sup(r)+1,e=n.length,c=numeric.rep([a],0),o=Array(e),f=Array(e),h=numeric.rep([a],0),u;for(u=0;u<e;++u)h[r[u]]++;for(u=0;u<a;++u)c[u+1]=c[u]+h[u];var M=c.slice(0),m,v;for(u=0;u<e;++u)v=r[u],m=M[v],o[m]=n[u],f[m]=i[u],M[v]=M[v]+1;return[c,o,f]},numeric.ccsGather=function p(t){var n=t[0],r=t[1],i=t[2],a=n.length-1,e=r.length,c=Array(e),o=Array(e),f=Array(e),h,u,M,m,v;for(v=0,h=0;h<a;++h)for(M=n[h],m=n[h+1],u=M;u!==m;++u)o[v]=h,c[v]=r[u],f[v]=i[u],++v;return[c,o,f]},numeric.sdim=function p(t,n,r){if(typeof n>"u"&&(n=[]),typeof t!="object")return n;typeof r>"u"&&(r=0),r in n||(n[r]=0),t.length>n[r]&&(n[r]=t.length);var i;for(i in t)t.hasOwnProperty(i)&&p(t[i],n,r+1);return n},numeric.sclone=function p(t,n,r){typeof n>"u"&&(n=0),typeof r>"u"&&(r=numeric.sdim(t).length);var i,a=Array(t.length);if(n===r-1){for(i in t)t.hasOwnProperty(i)&&(a[i]=t[i]);return a}for(i in t)t.hasOwnProperty(i)&&(a[i]=p(t[i],n+1,r));return a},numeric.sdiag=function p(t){var n=t.length,r,i=Array(n),a;for(r=n-1;r>=1;r-=2)a=r-1,i[r]=[],i[r][r]=t[r],i[a]=[],i[a][a]=t[a];return r===0&&(i[0]=[],i[0][0]=t[r]),i},numeric.sidentity=function p(t){return numeric.sdiag(numeric.rep([t],1))},numeric.stranspose=function p(t){var n=[];t.length;var r,i,a;for(r in t)if(t.hasOwnProperty(r)){a=t[r];for(i in a)a.hasOwnProperty(i)&&(typeof n[i]!="object"&&(n[i]=[]),n[i][r]=a[i])}return n},numeric.sLUP=function p(t,n){throw new Error("The function numeric.sLUP had a bug in it and has been removed. Please use the new numeric.ccsLUP function instead.")},numeric.sdotMM=function p(t,n){var r=t.length;n.length;var i=numeric.stranspose(n),a=i.length,e,c,o,f,h,u,M=Array(r),m;for(o=r-1;o>=0;o--){for(m=[],e=t[o],h=a-1;h>=0;h--){u=0,c=i[h];for(f in e)e.hasOwnProperty(f)&&f in c&&(u+=e[f]*c[f]);u&&(m[h]=u)}M[o]=m}return M},numeric.sdotMV=function p(t,n){var r=t.length,i,a,e,c=Array(r),o;for(a=r-1;a>=0;a--){i=t[a],o=0;for(e in i)i.hasOwnProperty(e)&&n[e]&&(o+=i[e]*n[e]);o&&(c[a]=o)}return c},numeric.sdotVM=function p(t,n){var r,i,a,e,c=[];for(r in t)if(t.hasOwnProperty(r)){a=n[r],e=t[r];for(i in a)a.hasOwnProperty(i)&&(c[i]||(c[i]=0),c[i]+=e*a[i])}return c},numeric.sdotVV=function p(t,n){var r,i=0;for(r in t)t[r]&&n[r]&&(i+=t[r]*n[r]);return i},numeric.sdot=function p(t,n){var r=numeric.sdim(t).length,i=numeric.sdim(n).length,a=r*1e3+i;switch(a){case 0:return t*n;case 1001:return numeric.sdotVV(t,n);case 2001:return numeric.sdotMV(t,n);case 1002:return numeric.sdotVM(t,n);case 2002:return numeric.sdotMM(t,n);default:throw new Error("numeric.sdot not implemented for tensors of order "+r+" and "+i)}},numeric.sscatter=function p(t){var n=t[0].length,r,i,a,e=t.length,c=[],o;for(i=n-1;i>=0;--i)if(t[e-1][i]){for(o=c,a=0;a<e-2;a++)r=t[a][i],o[r]||(o[r]=[]),o=o[r];o[t[a][i]]=t[a+1][i]}return c},numeric.sgather=function p(t,n,r){typeof n>"u"&&(n=[]),typeof r>"u"&&(r=[]);var i,a,e;i=r.length;for(a in t)if(t.hasOwnProperty(a))if(r[i]=parseInt(a),e=t[a],typeof e=="number"){if(e){if(n.length===0)for(a=i+1;a>=0;--a)n[a]=[];for(a=i;a>=0;--a)n[a].push(r[a]);n[i+1].push(e)}}else p(e,n,r);return r.length>i&&r.pop(),n},numeric.cLU=function p(t){var n=t[0],r=t[1],i=t[2],b=n.length,a=0,e,c,o,f,h,u;for(e=0;e<b;e++)n[e]>a&&(a=n[e]);a++;var M=Array(a),m=Array(a),v=numeric.rep([a],1/0),y=numeric.rep([a],-1/0),F,x,S;for(o=0;o<b;o++)e=n[o],c=r[o],c<v[e]&&(v[e]=c),c>y[e]&&(y[e]=c);for(e=0;e<a-1;e++)y[e]>y[e+1]&&(y[e+1]=y[e]);for(e=a-1;e>=1;e--)v[e]<v[e-1]&&(v[e-1]=v[e]);var _=0,L=0;for(e=0;e<a;e++)m[e]=numeric.rep([y[e]-v[e]+1],0),M[e]=numeric.rep([e-v[e]],0),_+=e-v[e]+1,L+=y[e]-e+1;for(o=0;o<b;o++)e=n[o],m[e][r[o]-v[e]]=i[o];for(e=0;e<a-1;e++)for(f=e-v[e],F=m[e],c=e+1;v[c]<=e&&c<a;c++)if(h=e-v[c],u=y[e]-e,x=m[c],S=x[h]/F[f],S){for(o=1;o<=u;o++)x[o+h]-=S*F[o+f];M[c][e-v[c]]=S}var F=[],x=[],O=[],R=[],I=[],l=[],b,Z,G;for(b=0,Z=0,e=0;e<a;e++){for(f=v[e],h=y[e],G=m[e],c=e;c<=h;c++)G[c-f]&&(F[b]=e,x[b]=c,O[b]=G[c-f],b++);for(G=M[e],c=f;c<e;c++)G[c-f]&&(R[Z]=e,I[Z]=c,l[Z]=G[c-f],Z++);R[Z]=e,I[Z]=e,l[Z]=1,Z++}return{U:[F,x,O],L:[R,I,l]}},numeric.cLUsolve=function p(t,n){var r=t.L,i=t.U,a=numeric.clone(n),e=r[0],c=r[1],o=r[2],f=i[0],h=i[1],u=i[2],M=f.length;e.length;var m=a.length,v,y;for(y=0,v=0;v<m;v++){for(;c[y]<v;)a[v]-=o[y]*a[c[y]],y++;y++}for(y=M-1,v=m-1;v>=0;v--){for(;h[y]>v;)a[v]-=u[y]*a[h[y]],y--;a[v]/=u[y],y--}return a},numeric.cgrid=function p(t,n){typeof t=="number"&&(t=[t,t]);var r=numeric.rep(t,-1),i,a,e;if(typeof n!="function")switch(n){case"L":n=function(c,o){return c>=t[0]/2||o<t[1]/2};break;default:n=function(c,o){return!0};break}for(e=0,i=1;i<t[0]-1;i++)for(a=1;a<t[1]-1;a++)n(i,a)&&(r[i][a]=e,e++);return r},numeric.cdelsq=function p(t){var n=[[-1,0],[0,-1],[0,1],[1,0]],r=numeric.dim(t),i=r[0],a=r[1],e,c,o,f,h,u=[],M=[],m=[];for(e=1;e<i-1;e++)for(c=1;c<a-1;c++)if(!(t[e][c]<0)){for(o=0;o<4;o++)f=e+n[o][0],h=c+n[o][1],!(t[f][h]<0)&&(u.push(t[e][c]),M.push(t[f][h]),m.push(-1));u.push(t[e][c]),M.push(t[e][c]),m.push(4)}return[u,M,m]},numeric.cdotMV=function p(t,n){var r,i=t[0],a=t[1],e=t[2],c,o=i.length,f;for(f=0,c=0;c<o;c++)i[c]>f&&(f=i[c]);for(f++,r=numeric.rep([f],0),c=0;c<o;c++)r[i[c]]+=e[c]*n[a[c]];return r},numeric.Spline=function p(t,n,r,i,a){this.x=t,this.yl=n,this.yr=r,this.kl=i,this.kr=a},numeric.Spline.prototype._at=function p(o,n){var r=this.x,i=this.yl,a=this.yr,e=this.kl,c=this.kr,o,f,h,u,M=numeric.add,m=numeric.sub,v=numeric.mul;f=m(v(e[n],r[n+1]-r[n]),m(a[n+1],i[n])),h=M(v(c[n+1],r[n]-r[n+1]),m(a[n+1],i[n])),u=(o-r[n])/(r[n+1]-r[n]);var y=u*(1-u);return M(M(M(v(1-u,i[n]),v(u,a[n+1])),v(f,y*(1-u))),v(h,y*u))},numeric.Spline.prototype.at=function p(t){if(typeof t=="number"){var n=this.x,c=n.length,r,i,a,e=Math.floor;for(r=0,i=c-1;i-r>1;)a=e((r+i)/2),n[a]<=t?r=a:i=a;return this._at(t,r)}var c=t.length,o,f=Array(c);for(o=c-1;o!==-1;--o)f[o]=this.at(t[o]);return f},numeric.Spline.prototype.diff=function p(){var t=this.x,n=this.yl,r=this.yr,i=this.kl,a=this.kr,e=n.length,c,o,f,h=i,u=a,M=Array(e),m=Array(e),v=numeric.add,y=numeric.mul,S=numeric.div,_=numeric.sub;for(c=e-1;c!==-1;--c)o=t[c+1]-t[c],f=_(r[c+1],n[c]),M[c]=S(v(y(f,6),y(i[c],-4*o),y(a[c+1],-2*o)),o*o),m[c+1]=S(v(y(f,-6),y(i[c],2*o),y(a[c+1],4*o)),o*o);return new numeric.Spline(t,h,u,M,m)},numeric.Spline.prototype.roots=function p(){function t(w){return w*w}var S=[],n=this.x,r=this.yl,i=this.yr,a=this.kl,e=this.kr;typeof r[0]=="number"&&(r=[r],i=[i],a=[a],e=[e]);var c=r.length,o=n.length-1,f,h,u,M,m,v,y,S=Array(c),_,L,F,x,O,R,I,l,b,Z,G,J,ee,se,Ae,De,Se=Math.sqrt;for(f=0;f!==c;++f){for(M=r[f],m=i[f],v=a[f],y=e[f],_=[],h=0;h!==o;h++){for(h>0&&m[h]*M[h]<0&&_.push(n[h]),b=n[h+1]-n[h],n[h],x=M[h],O=m[h+1],L=v[h]/b,F=y[h+1]/b,l=t(L-F+3*(x-O))+12*F*x,R=F+3*x+2*L-3*O,I=3*(F+L+2*(x-O)),l<=0?(G=R/I,G>n[h]&&G<n[h+1]?Z=[n[h],G,n[h+1]]:Z=[n[h],n[h+1]]):(G=(R-Se(l))/I,J=(R+Se(l))/I,Z=[n[h]],G>n[h]&&G<n[h+1]&&Z.push(G),J>n[h]&&J<n[h+1]&&Z.push(J),Z.push(n[h+1])),se=Z[0],G=this._at(se,h),u=0;u<Z.length-1;u++){if(Ae=Z[u+1],J=this._at(Ae,h),G===0){_.push(se),se=Ae,G=J;continue}if(J===0||G*J>0){se=Ae,G=J;continue}for(var N=0;De=(G*Ae-J*se)/(G-J),!(De<=se||De>=Ae);)if(ee=this._at(De,h),ee*J>0)Ae=De,J=ee,N===-1&&(G*=.5),N=-1;else if(ee*G>0)se=De,G=ee,N===1&&(J*=.5),N=1;else break;_.push(De),se=Z[u+1],G=this._at(se,h)}J===0&&_.push(Ae)}S[f]=_}return typeof this.yl[0]=="number"?S[0]:S},numeric.spline=function p(t,n,r,i){var a=t.length,e=[],c=[],o=[],f,h=numeric.sub,u=numeric.mul,M=numeric.add;for(f=a-2;f>=0;f--)c[f]=t[f+1]-t[f],o[f]=h(n[f+1],n[f]);(typeof r=="string"||typeof i=="string")&&(r=i="periodic");var m=[[],[],[]];switch(typeof r){case"undefined":e[0]=u(3/(c[0]*c[0]),o[0]),m[0].push(0,0),m[1].push(0,1),m[2].push(2/c[0],1/c[0]);break;case"string":e[0]=M(u(3/(c[a-2]*c[a-2]),o[a-2]),u(3/(c[0]*c[0]),o[0])),m[0].push(0,0,0),m[1].push(a-2,0,1),m[2].push(1/c[a-2],2/c[a-2]+2/c[0],1/c[0]);break;default:e[0]=r,m[0].push(0),m[1].push(0),m[2].push(1);break}for(f=1;f<a-1;f++)e[f]=M(u(3/(c[f-1]*c[f-1]),o[f-1]),u(3/(c[f]*c[f]),o[f])),m[0].push(f,f,f),m[1].push(f-1,f,f+1),m[2].push(1/c[f-1],2/c[f-1]+2/c[f],1/c[f]);switch(typeof i){case"undefined":e[a-1]=u(3/(c[a-2]*c[a-2]),o[a-2]),m[0].push(a-1,a-1),m[1].push(a-2,a-1),m[2].push(1/c[a-2],2/c[a-2]);break;case"string":m[1][m[1].length-1]=0;break;default:e[a-1]=i,m[0].push(a-1),m[1].push(a-1),m[2].push(1);break}typeof e[0]!="number"?e=numeric.transpose(e):e=[e];var v=Array(e.length);if(typeof r=="string")for(f=v.length-1;f!==-1;--f)v[f]=numeric.ccsLUPSolve(numeric.ccsLUP(numeric.ccsScatter(m)),e[f]),v[f][a-1]=v[f][0];else for(f=v.length-1;f!==-1;--f)v[f]=numeric.cLUsolve(numeric.cLU(m),e[f]);return typeof n[0]=="number"?v=v[0]:v=numeric.transpose(v),new numeric.Spline(t,n,n,v,v)},numeric.fftpow2=function p(t,n){var r=t.length;if(r!==1){var i=Math.cos,a=Math.sin,e,c,o=Array(r/2),f=Array(r/2),h=Array(r/2),u=Array(r/2);for(c=r/2,e=r-1;e!==-1;--e)--c,h[c]=t[e],u[c]=n[e],--e,o[c]=t[e],f[c]=n[e];p(o,f),p(h,u),c=r/2;var M,m=-6.283185307179586/r,v,y;for(e=r-1;e!==-1;--e)--c,c===-1&&(c=r/2-1),M=m*e,v=i(M),y=a(M),t[e]=o[c]+v*h[c]-y*u[c],n[e]=f[c]+v*u[c]+y*h[c]}},numeric._ifftpow2=function p(t,n){var r=t.length;if(r!==1){var i=Math.cos,a=Math.sin,e,c,o=Array(r/2),f=Array(r/2),h=Array(r/2),u=Array(r/2);for(c=r/2,e=r-1;e!==-1;--e)--c,h[c]=t[e],u[c]=n[e],--e,o[c]=t[e],f[c]=n[e];p(o,f),p(h,u),c=r/2;var M,m=6.283185307179586/r,v,y;for(e=r-1;e!==-1;--e)--c,c===-1&&(c=r/2-1),M=m*e,v=i(M),y=a(M),t[e]=o[c]+v*h[c]-y*u[c],n[e]=f[c]+v*u[c]+y*h[c]}},numeric.ifftpow2=function p(t,n){numeric._ifftpow2(t,n),numeric.diveq(t,t.length),numeric.diveq(n,n.length)},numeric.convpow2=function p(t,n,r,i){numeric.fftpow2(t,n),numeric.fftpow2(r,i);var a,e=t.length,c,o,f,h;for(a=e-1;a!==-1;--a)c=t[a],f=n[a],o=r[a],h=i[a],t[a]=c*o-f*h,n[a]=c*h+f*o;numeric.ifftpow2(t,n)},numeric.T.prototype.fft=function p(){var t=this.x,n=this.y,r=t.length,i=Math.log,a=i(2),e=Math.ceil(i(2*r-1)/a),c=Math.pow(2,e),o=numeric.rep([c],0),f=numeric.rep([c],0),h=Math.cos,u=Math.sin,M,m=-3.141592653589793/r,v,y=numeric.rep([c],0),S=numeric.rep([c],0);for(M=0;M<r;M++)y[M]=t[M];if(typeof n<"u")for(M=0;M<r;M++)S[M]=n[M];for(o[0]=1,M=1;M<=c/2;M++)v=m*M*M,o[M]=h(v),f[M]=u(v),o[c-M]=h(v),f[c-M]=u(v);var _=new numeric.T(y,S),L=new numeric.T(o,f);return _=_.mul(L),numeric.convpow2(_.x,_.y,numeric.clone(L.x),numeric.neg(L.y)),_=_.mul(L),_.x.length=r,_.y.length=r,_},numeric.T.prototype.ifft=function p(){var t=this.x,n=this.y,r=t.length,i=Math.log,a=i(2),e=Math.ceil(i(2*r-1)/a),c=Math.pow(2,e),o=numeric.rep([c],0),f=numeric.rep([c],0),h=Math.cos,u=Math.sin,M,m=3.141592653589793/r,v,y=numeric.rep([c],0),S=numeric.rep([c],0);for(M=0;M<r;M++)y[M]=t[M];if(typeof n<"u")for(M=0;M<r;M++)S[M]=n[M];for(o[0]=1,M=1;M<=c/2;M++)v=m*M*M,o[M]=h(v),f[M]=u(v),o[c-M]=h(v),f[c-M]=u(v);var _=new numeric.T(y,S),L=new numeric.T(o,f);return _=_.mul(L),numeric.convpow2(_.x,_.y,numeric.clone(L.x),numeric.neg(L.y)),_=_.mul(L),_.x.length=r,_.y.length=r,_.div(r)},numeric.gradient=function p(t,n){var r=n.length,i=t(n);if(isNaN(i))throw new Error("gradient: f(x) is a NaN!");var u=Math.max,a,e=numeric.clone(n),c,o,f=Array(r);numeric.div,numeric.sub;var h,u=Math.max,M=.001,m=Math.abs,v=Math.min,y,S,_,L=0,F,x,O;for(a=0;a<r;a++)for(var R=u(1e-6*i,1e-8);;){if(++L,L>20)throw new Error("Numerical gradient fails");if(e[a]=n[a]+R,c=t(e),e[a]=n[a]-R,o=t(e),e[a]=n[a],isNaN(c)||isNaN(o)){R/=16;continue}if(f[a]=(c-o)/(2*R),y=n[a]-R,S=n[a],_=n[a]+R,F=(c-i)/R,x=(i-o)/R,O=u(m(f[a]),m(i),m(c),m(o),m(y),m(S),m(_),1e-8),h=v(u(m(F-f[a]),m(x-f[a]),m(F-x))/O,R/O),h>M)R/=16;else break}return f},numeric.uncmin=function p(t,n,r,i,a,e,c){var o=numeric.gradient;typeof c>"u"&&(c={}),typeof r>"u"&&(r=1e-8),typeof i>"u"&&(i=function(te){return o(t,te)}),typeof a>"u"&&(a=1e3),n=numeric.clone(n);var f=n.length,h=t(n),u,M;if(isNaN(h))throw new Error("uncmin: f(x0) is a NaN!");var m=Math.max,v=numeric.norm2;r=m(r,numeric.epsilon);var y,S,_,L=c.Hinv||numeric.identity(f),F=numeric.dot;numeric.inv;var x=numeric.sub,O=numeric.add,R=numeric.tensor,I=numeric.div,l=numeric.mul,b=numeric.all,Z=numeric.isFinite,G=numeric.neg,J=0,ee,se,Ae,De,Se,N,w,j="";for(S=i(n);J<a;){if(typeof e=="function"&&e(J,n,h,S,L)){j="Callback returned true";break}if(!b(Z(S))){j="Gradient has Infinity or NaN";break}if(y=G(F(L,S)),!b(Z(y))){j="Search direction has Infinity or NaN";break}if(w=v(y),w<r){j="Newton step smaller than tol";break}for(N=1,M=F(S,y),se=n;J<a&&!(N*w<r);){if(ee=l(y,N),se=O(n,ee),u=t(se),u-h>=.1*N*M||isNaN(u)){N*=.5,++J;continue}break}if(N*w<r){j="Line search step size smaller than tol";break}if(J===a){j="maxit reached during line search";break}_=i(se),Ae=x(_,S),Se=F(Ae,ee),De=F(L,Ae),L=x(O(L,l((Se+F(Ae,De))/(Se*Se),R(ee,ee))),I(O(R(De,ee),R(ee,De)),Se)),n=se,h=u,S=_,++J}return{solution:n,f:h,gradient:S,invHessian:L,iterations:J,message:j}},numeric.Dopri=function p(t,n,r,i,a,e,c){this.x=t,this.y=n,this.f=r,this.ymid=i,this.iterations=a,this.events=c,this.message=e},numeric.Dopri.prototype._at=function p(y,n){function r(l){return l*l}var i=this,a=i.x,e=i.y,c=i.f,o=i.ymid;a.length;var f,h,u,M,m,v,y,S,_=.5,L=numeric.add,F=numeric.mul,x=numeric.sub,O,R,I;return f=a[n],h=a[n+1],M=e[n],m=e[n+1],S=h-f,u=f+_*S,v=o[n],O=x(c[n],F(M,1/(f-u)+2/(f-h))),R=x(c[n+1],F(m,1/(h-u)+2/(h-f))),I=[r(y-h)*(y-u)/r(f-h)/(f-u),r(y-f)*r(y-h)/r(f-u)/r(h-u),r(y-f)*(y-u)/r(h-f)/(h-u),(y-f)*r(y-h)*(y-u)/r(f-h)/(f-u),(y-h)*r(y-f)*(y-u)/r(f-h)/(h-u)],L(L(L(L(F(M,I[0]),F(v,I[1])),F(m,I[2])),F(O,I[3])),F(R,I[4]))},numeric.Dopri.prototype.at=function p(t){var n,r,i,a=Math.floor;if(typeof t!="number"){var e=t.length,c=Array(e);for(n=e-1;n!==-1;--n)c[n]=this.at(t[n]);return c}var o=this.x;for(n=0,r=o.length-1;r-n>1;)i=a(.5*(n+r)),o[i]<=t?n=i:r=i;return this._at(t,n)},numeric.dopri=function p(t,n,r,i,a,e,c){typeof a>"u"&&(a=1e-6),typeof e>"u"&&(e=1e3);var o=[t],f=[r],h=[i(t,r)],u,M,m,v,y,S,_=[],L=1/5,F=[3/40,9/40],x=[44/45,-56/15,32/9],O=[19372/6561,-25360/2187,64448/6561,-212/729],R=[9017/3168,-355/33,46732/5247,49/176,-5103/18656],I=[35/384,0,500/1113,125/192,-2187/6784,11/84],l=[.5*6025192743/30085553152,0,.5*51252292925/65400821598,.5*-2691868925/45128329728,.5*187940372067/1594534317056,.5*-1776094331/19743644256,.5*11237099/235043384],b=[1/5,3/10,4/5,8/9,1,1],Z=[-71/57600,0,71/16695,-71/1920,17253/339200,-22/525,1/40],G=0,J,ee,se=(n-t)/10,Ae=0,De=numeric.add,Se=numeric.mul,N,w,j=Math.min,te=Math.abs,ie=numeric.norminf,ce=Math.pow,ge=numeric.any,D=numeric.lt,d=numeric.and;numeric.sub;var E,Q,z,X=new numeric.Dopri(o,f,h,_,-1,"");for(typeof c=="function"&&(E=c(t,r));t<n&&Ae<e;){if(++Ae,t+se>n&&(se=n-t),u=i(t+b[0]*se,De(r,Se(L*se,h[G]))),M=i(t+b[1]*se,De(De(r,Se(F[0]*se,h[G])),Se(F[1]*se,u))),m=i(t+b[2]*se,De(De(De(r,Se(x[0]*se,h[G])),Se(x[1]*se,u)),Se(x[2]*se,M))),v=i(t+b[3]*se,De(De(De(De(r,Se(O[0]*se,h[G])),Se(O[1]*se,u)),Se(O[2]*se,M)),Se(O[3]*se,m))),y=i(t+b[4]*se,De(De(De(De(De(r,Se(R[0]*se,h[G])),Se(R[1]*se,u)),Se(R[2]*se,M)),Se(R[3]*se,m)),Se(R[4]*se,v))),N=De(De(De(De(De(r,Se(h[G],se*I[0])),Se(M,se*I[2])),Se(m,se*I[3])),Se(v,se*I[4])),Se(y,se*I[5])),S=i(t+se,N),J=De(De(De(De(De(Se(h[G],se*Z[0]),Se(M,se*Z[2])),Se(m,se*Z[3])),Se(v,se*Z[4])),Se(y,se*Z[5])),Se(S,se*Z[6])),typeof J=="number"?w=te(J):w=ie(J),w>a){if(se=.2*se*ce(a/w,.25),t+se===t){X.msg="Step size became too small";break}continue}if(_[G]=De(De(De(De(De(De(r,Se(h[G],se*l[0])),Se(M,se*l[2])),Se(m,se*l[3])),Se(v,se*l[4])),Se(y,se*l[5])),Se(S,se*l[6])),++G,o[G]=t+se,f[G]=N,h[G]=S,typeof c=="function"){var $,he=t,de=t+.5*se,q;if(Q=c(de,_[G-1]),z=d(D(E,0),D(0,Q)),ge(z)||(he=de,de=t+se,E=Q,Q=c(de,N),z=d(D(E,0),D(0,Q))),ge(z)){for(var K,ne,oe=0,le=1,s=1;;){if(typeof E=="number")q=(s*Q*he-le*E*de)/(s*Q-le*E);else for(q=de,ee=E.length-1;ee!==-1;--ee)E[ee]<0&&Q[ee]>0&&(q=j(q,(s*Q[ee]*he-le*E[ee]*de)/(s*Q[ee]-le*E[ee])));if(q<=he||q>=de)break;$=X._at(q,G-1),ne=c(q,$),K=d(D(E,0),D(0,ne)),ge(K)?(de=q,Q=ne,z=K,s=1,oe===-1?le*=.5:le=1,oe=-1):(he=q,E=ne,le=1,oe===1?s*=.5:s=1,oe=1)}return N=X._at(.5*(t+q),G-1),X.f[G]=i(q,$),X.x[G]=q,X.y[G]=$,X.ymid[G-1]=N,X.events=z,X.iterations=Ae,X}}t+=se,r=N,E=Q,se=j(.8*se*ce(a/w,.25),4*se)}return X.iterations=Ae,X},numeric.LU=function(p,t){t=t||!1;var n=Math.abs,r,i,a,e,c,o,f,h,u,M=p.length,m=M-1,v=new Array(M);for(t||(p=numeric.clone(p)),a=0;a<M;++a){for(f=a,o=p[a],u=n(o[a]),i=a+1;i<M;++i)e=n(p[i][a]),u<e&&(u=e,f=i);for(v[a]=f,f!=a&&(p[a]=p[f],p[f]=o,o=p[a]),c=o[a],r=a+1;r<M;++r)p[r][a]/=c;for(r=a+1;r<M;++r){for(h=p[r],i=a+1;i<m;++i)h[i]-=h[a]*o[i],++i,h[i]-=h[a]*o[i];i===m&&(h[i]-=h[a]*o[i])}}return{LU:p,P:v}},numeric.LUsolve=function p(t,n){var r,i,a=t.LU,e=a.length,c=numeric.clone(n),o=t.P,f,h,u;for(r=e-1;r!==-1;--r)c[r]=n[r];for(r=0;r<e;++r)for(f=o[r],o[r]!==r&&(u=c[r],c[r]=c[f],c[f]=u),h=a[r],i=0;i<r;++i)c[r]-=c[i]*h[i];for(r=e-1;r>=0;--r){for(h=a[r],i=r+1;i<e;++i)c[r]-=c[i]*h[i];c[r]/=h[r]}return c},numeric.solve=function p(t,n,r){return numeric.LUsolve(numeric.LU(t,r),n)},numeric.echelonize=function p(t){var n=numeric.dim(t),r=n[0],i=n[1],a=numeric.identity(r),e=Array(r),c,o,f,h,u,M,m,v,y=Math.abs,S=numeric.diveq;for(t=numeric.clone(t),c=0;c<r;++c){for(f=0,u=t[c],M=a[c],o=1;o<i;++o)y(u[f])<y(u[o])&&(f=o);for(e[c]=f,S(M,u[f]),S(u,u[f]),o=0;o<r;++o)if(o!==c){for(m=t[o],v=m[f],h=i-1;h!==-1;--h)m[h]-=u[h]*v;for(m=a[o],h=r-1;h!==-1;--h)m[h]-=M[h]*v}}return{I:a,A:t,P:e}},numeric.__solveLP=function p(t,n,r,i,a,e,c){var o=numeric.sum;numeric.log;var f=numeric.mul,h=numeric.sub,u=numeric.dot,M=numeric.div,m=numeric.add,v=t.length,y=r.length,S,_=!1,L=0,F=1;numeric.transpose(n),numeric.svd;var x=numeric.transpose;numeric.leq;var O=Math.sqrt,R=Math.abs;numeric.muleq,numeric.norminf,numeric.any;var I=Math.min,l=numeric.all,b=numeric.gt,Z=Array(v),G=Array(y);numeric.rep([y],1);var J,ee=numeric.solve,se=h(r,u(n,e)),Ae,De=u(t,t),Se;for(Ae=L;Ae<a;++Ae){var N,w;for(N=y-1;N!==-1;--N)G[N]=M(n[N],se[N]);var j=x(G);for(N=v-1;N!==-1;--N)Z[N]=o(j[N]);F=.25*R(De/u(t,Z));var te=100*O(De/u(Z,Z));for((!isFinite(F)||F>te)&&(F=te),Se=m(t,f(F,Z)),J=u(j,G),N=v-1;N!==-1;--N)J[N][N]+=1;w=ee(J,M(Se,F),!0);var ie=M(se,u(n,w)),ce=1;for(N=y-1;N!==-1;--N)ie[N]<0&&(ce=I(ce,-.999*ie[N]));if(S=h(e,f(w,ce)),se=h(r,u(n,S)),!l(b(se,0)))return{solution:e,message:"",iterations:Ae};if(e=S,F<i)return{solution:S,message:"",iterations:Ae};if(c){var ge=u(t,Se),D=u(n,Se);for(_=!0,N=y-1;N!==-1;--N)if(ge*D[N]<0){_=!1;break}}else e[v-1]>=0?_=!1:_=!0;if(_)return{solution:S,message:"Unbounded",iterations:Ae}}return{solution:e,message:"maximum iteration count exceeded",iterations:Ae}},numeric._solveLP=function p(t,n,r,i,a){var e=t.length,c=r.length,v;numeric.sum,numeric.log,numeric.mul;var o=numeric.sub,f=numeric.dot;numeric.div,numeric.add;var h=numeric.rep([e],0).concat([1]),u=numeric.rep([c,1],-1),M=numeric.blockMatrix([[n,u]]),m=r,v=numeric.rep([e],0).concat(Math.max(0,numeric.sup(numeric.neg(r)))+1),y=numeric.__solveLP(h,M,m,i,a,v,!1),S=numeric.clone(y.solution);S.length=e;var _=numeric.inf(o(r,f(n,S)));if(_<0)return{solution:NaN,message:"Infeasible",iterations:y.iterations};var L=numeric.__solveLP(t,n,r,i,a-y.iterations,S,!0);return L.iterations+=y.iterations,L},numeric.solveLP=function p(t,n,r,i,a,e,c){if(typeof c>"u"&&(c=1e3),typeof e>"u"&&(e=numeric.epsilon),typeof i>"u")return numeric._solveLP(t,n,r,e,c);var o=i.length,f=i[0].length,h=n.length,u=numeric.echelonize(i),M=numeric.rep([f],0),m=u.P,v=[],y;for(y=m.length-1;y!==-1;--y)M[m[y]]=1;for(y=f-1;y!==-1;--y)M[y]===0&&v.push(y);var S=numeric.getRange,_=numeric.linspace(0,o-1),L=numeric.linspace(0,h-1),F=S(i,_,v),x=S(n,L,m),O=S(n,L,v),R=numeric.dot,I=numeric.sub,l=R(x,u.I),b=I(O,R(l,F)),Z=I(r,R(l,a)),G=Array(m.length),J=Array(v.length);for(y=m.length-1;y!==-1;--y)G[y]=t[m[y]];for(y=v.length-1;y!==-1;--y)J[y]=t[v[y]];var ee=I(J,R(G,R(u.I,F))),se=numeric._solveLP(ee,b,Z,e,c),Ae=se.solution;if(Ae!==Ae)return se;var De=R(u.I,I(a,R(F,Ae))),Se=Array(t.length);for(y=m.length-1;y!==-1;--y)Se[m[y]]=De[y];for(y=v.length-1;y!==-1;--y)Se[v[y]]=Ae[y];return{solution:Se,message:se.message,iterations:se.iterations}},numeric.MPStoLP=function p(t){t instanceof String&&t.split(`
`);var n=0,r=["Initial state","NAME","ROWS","COLUMNS","RHS","BOUNDS","ENDATA"],i=t.length,a,e,c,o=0,f={},h=[],u=0,M={},m=0,v,y=[],S=[],_=[];function L(I){throw new Error("MPStoLP: "+I+`
Line `+a+": "+t[a]+`
Current state: `+r[n]+`
`)}for(a=0;a<i;++a){c=t[a];var F=c.match(/\S*/g),x=[];for(e=0;e<F.length;++e)F[e]!==""&&x.push(F[e]);if(x.length!==0){for(e=0;e<r.length&&c.substr(0,r[e].length)!==r[e];++e);if(e<r.length){if(n=e,e===1&&(v=x[1]),e===6)return{name:v,c:y,A:numeric.transpose(S),b:_,rows:f,vars:M};continue}switch(n){case 0:case 1:L("Unexpected line");case 2:switch(x[0]){case"N":o===0?o=x[1]:L("Two or more N rows");break;case"L":f[x[1]]=u,h[u]=1,_[u]=0,++u;break;case"G":f[x[1]]=u,h[u]=-1,_[u]=0,++u;break;case"E":f[x[1]]=u,h[u]=0,_[u]=0,++u;break;default:L("Parse error "+numeric.prettyPrint(x))}break;case 3:M.hasOwnProperty(x[0])||(M[x[0]]=m,y[m]=0,S[m]=numeric.rep([u],0),++m);var O=M[x[0]];for(e=1;e<x.length;e+=2){if(x[e]===o){y[O]=parseFloat(x[e+1]);continue}var R=f[x[e]];S[O][R]=(h[R]<0?-1:1)*parseFloat(x[e+1])}break;case 4:for(e=1;e<x.length;e+=2)_[f[x[e]]]=(h[f[x[e]]]<0?-1:1)*parseFloat(x[e+1]);break;case 5:break;case 6:L("Internal error")}}}L("Reached end of file without ENDATA")},numeric.seedrandom={pow:Math.pow,random:Math.random},function(p,t,n,r,i,a,e){t.seedrandom=function(M,m){var v=[],y;return M=f(o(m?[M,p]:arguments.length?M:[new Date().getTime(),p,window],3),v),y=new c(v),f(y.S,p),t.random=function(){for(var _=y.g(r),L=e,F=0;_<i;)_=(_+F)*n,L*=n,F=y.g(1);for(;_>=a;)_/=2,L/=2,F>>>=1;return(_+F)/L},M};function c(u){var M,m,v=this,y=u.length,S=0,_=v.i=v.j=v.m=0;for(v.S=[],v.c=[],y||(u=[y++]);S<n;)v.S[S]=S++;for(S=0;S<n;S++)M=v.S[S],_=h(_+M+u[S%y]),m=v.S[_],v.S[S]=m,v.S[_]=M;v.g=function(F){var x=v.S,O=h(v.i+1),R=x[O],I=h(v.j+R),l=x[I];x[O]=l,x[I]=R;for(var b=x[h(R+l)];--F;)O=h(O+1),R=x[O],I=h(I+R),l=x[I],x[O]=l,x[I]=R,b=b*n+x[h(R+l)];return v.i=O,v.j=I,b},v.g(n)}function o(u,M,m,v,y){if(m=[],y=typeof u,M&&y=="object"){for(v in u)if(v.indexOf("S")<5)try{m.push(o(u[v],M-1))}catch{}}return m.length?m:u+(y!="string"?"\0":"")}function f(u,M,m,v){for(u+="",m=0,v=0;v<u.length;v++)M[h(v)]=h((m^=M[h(v)]*19)+u.charCodeAt(v));u="";for(v in M)u+=String.fromCharCode(M[v]);return u}function h(u){return u&n-1}e=t.pow(n,r),i=t.pow(2,i),a=i*2,f(t.random(),p)}([],numeric.seedrandom,256,6,52),function(p){function t(o){if(typeof o!="object")return o;var f=[],h,u=o.length;for(h=0;h<u;h++)f[h+1]=t(o[h]);return f}function n(o){if(typeof o!="object")return o;var f=[],h,u=o.length;for(h=1;h<u;h++)f[h-1]=n(o[h]);return f}function r(o,f,h){var u,M,m,v,y;for(m=1;m<=h;m=m+1){for(o[m][m]=1/o[m][m],y=-o[m][m],u=1;u<m;u=u+1)o[u][m]=y*o[u][m];if(v=m+1,h<v)break;for(M=v;M<=h;M=M+1)for(y=o[m][M],o[m][M]=0,u=1;u<=m;u=u+1)o[u][M]=o[u][M]+y*o[u][m]}}function i(o,f,h,u){var M,m,v,y;for(m=1;m<=h;m=m+1){for(y=0,M=1;M<m;M=M+1)y=y+o[M][m]*u[M];u[m]=(u[m]-y)/o[m][m]}for(v=1;v<=h;v=v+1)for(m=h+1-v,u[m]=u[m]/o[m][m],y=-u[m],M=1;M<m;M=M+1)u[M]=u[M]+y*o[M][m]}function a(o,f,h,u){var M,m,v,y,S,_;for(m=1;m<=h;m=m+1){if(u[1]=m,_=0,v=m-1,v<1){if(_=o[m][m]-_,_<=0)break;o[m][m]=Math.sqrt(_)}else{for(y=1;y<=v;y=y+1){for(S=o[y][m],M=1;M<y;M=M+1)S=S-o[M][m]*o[M][y];S=S/o[y][y],o[y][m]=S,_=_+S*S}if(_=o[m][m]-_,_<=0)break;o[m][m]=Math.sqrt(_)}u[1]=0}}function e(o,f,h,u,M,m,v,y,S,_,L,F,x,O,R,I){var l,b,Z,G,J,ee,se,Ae,De,Se,N,w,j,te,ie,ce,ge,D,d,E,Q,z,X,$,he,de,q;j=Math.min(u,_),Z=2*u+j*(j+5)/2+2*_+1,$=1e-60;do $=$+$,he=1+.1*$,de=1+.2*$;while(he<=1||de<=1);for(l=1;l<=u;l=l+1)R[l]=f[l];for(l=u+1;l<=Z;l=l+1)R[l]=0;for(l=1;l<=_;l=l+1)F[l]=0;if(J=[],I[1]===0){if(a(o,h,u,J),J[1]!==0){I[1]=2;return}i(o,h,u,f),r(o,h,u)}else{for(b=1;b<=u;b=b+1)for(M[b]=0,l=1;l<=b;l=l+1)M[b]=M[b]+o[l][b]*f[l];for(b=1;b<=u;b=b+1)for(f[b]=0,l=b;l<=u;l=l+1)f[b]=f[b]+o[b][l]*M[l]}for(m[1]=0,b=1;b<=u;b=b+1)for(M[b]=f[b],m[1]=m[1]+R[b]*M[b],R[b]=0,l=b+1;l<=u;l=l+1)o[l][b]=0;for(m[1]=-m[1]/2,I[1]=0,se=u,Ae=se+u,N=Ae+j,De=N+j+1,Se=De+j*(j+1)/2,te=Se+_,l=1;l<=_;l=l+1){for(ce=0,b=1;b<=u;b=b+1)ce=ce+v[b][l]*v[b][l];R[te+l]=Math.sqrt(ce)}x=0,O[1]=0,O[2]=0;function K(){for(O[1]=O[1]+1,Z=Se,l=1;l<=_;l=l+1){for(Z=Z+1,ce=-y[l],b=1;b<=u;b=b+1)ce=ce+v[b][l]*M[b];if(Math.abs(ce)<$&&(ce=0),l>L)R[Z]=ce;else if(R[Z]=-Math.abs(ce),ce>0){for(b=1;b<=u;b=b+1)v[b][l]=-v[b][l];y[l]=-y[l]}}for(l=1;l<=x;l=l+1)R[Se+F[l]]=0;for(w=0,ie=0,l=1;l<=_;l=l+1)R[Se+l]<ie*R[te+l]&&(w=l,ie=R[Se+l]/R[te+l]);return w===0?999:0}function ne(){for(l=1;l<=u;l=l+1){for(ce=0,b=1;b<=u;b=b+1)ce=ce+o[b][l]*v[b][w];R[l]=ce}for(G=se,l=1;l<=u;l=l+1)R[G+l]=0;for(b=x+1;b<=u;b=b+1)for(l=1;l<=u;l=l+1)R[G+l]=R[G+l]+o[l][b]*R[b];for(z=!0,l=x;l>=1;l=l-1){for(ce=R[l],Z=De+l*(l+3)/2,G=Z-l,b=l+1;b<=x;b=b+1)ce=ce-R[Z]*R[Ae+b],Z=Z+b;if(ce=ce/R[G],R[Ae+l]=ce,F[l]<L||ce<0)break;z=!1,ee=l}if(!z)for(ge=R[N+ee]/R[Ae+ee],l=1;l<=x&&!(F[l]<L||R[Ae+l]<0);l=l+1)ie=R[N+l]/R[Ae+l],ie<ge&&(ge=ie,ee=l);for(ce=0,l=se+1;l<=se+u;l=l+1)ce=ce+R[l]*R[l];if(Math.abs(ce)<=$){if(z)return I[1]=1,999;for(l=1;l<=x;l=l+1)R[N+l]=R[N+l]-ge*R[Ae+l];return R[N+x+1]=R[N+x+1]+ge,700}else{for(ce=0,l=1;l<=u;l=l+1)ce=ce+R[se+l]*v[l][w];for(D=-R[Se+w]/ce,X=!0,z||ge<D&&(D=ge,X=!1),l=1;l<=u;l=l+1)M[l]=M[l]+D*R[se+l],Math.abs(M[l])<$&&(M[l]=0);for(m[1]=m[1]+D*ce*(D/2+R[N+x+1]),l=1;l<=x;l=l+1)R[N+l]=R[N+l]-D*R[Ae+l];if(R[N+x+1]=R[N+x+1]+D,X){for(x=x+1,F[x]=w,Z=De+(x-1)*x/2+1,l=1;l<=x-1;l=l+1)R[Z]=R[l],Z=Z+1;if(x===u)R[Z]=R[u];else{for(l=u;l>=x+1&&!(R[l]===0||(d=Math.max(Math.abs(R[l-1]),Math.abs(R[l])),E=Math.min(Math.abs(R[l-1]),Math.abs(R[l])),R[l-1]>=0?ie=Math.abs(d*Math.sqrt(1+E*E/(d*d))):ie=-Math.abs(d*Math.sqrt(1+E*E/(d*d))),d=R[l-1]/ie,E=R[l]/ie,d===1));l=l-1)if(d===0)for(R[l-1]=E*ie,b=1;b<=u;b=b+1)ie=o[b][l-1],o[b][l-1]=o[b][l],o[b][l]=ie;else for(R[l-1]=ie,Q=E/(1+d),b=1;b<=u;b=b+1)ie=d*o[b][l-1]+E*o[b][l],o[b][l]=Q*(o[b][l-1]+ie)-o[b][l],o[b][l-1]=ie;R[Z]=R[x]}}else{for(ce=-y[w],b=1;b<=u;b=b+1)ce=ce+M[b]*v[b][w];if(w>L)R[Se+w]=ce;else if(R[Se+w]=-Math.abs(ce),ce>0){for(b=1;b<=u;b=b+1)v[b][w]=-v[b][w];y[w]=-y[w]}return 700}}return 0}function oe(){if(Z=De+ee*(ee+1)/2+1,G=Z+ee,R[G]===0||(d=Math.max(Math.abs(R[G-1]),Math.abs(R[G])),E=Math.min(Math.abs(R[G-1]),Math.abs(R[G])),R[G-1]>=0?ie=Math.abs(d*Math.sqrt(1+E*E/(d*d))):ie=-Math.abs(d*Math.sqrt(1+E*E/(d*d))),d=R[G-1]/ie,E=R[G]/ie,d===1))return 798;if(d===0){for(l=ee+1;l<=x;l=l+1)ie=R[G-1],R[G-1]=R[G],R[G]=ie,G=G+l;for(l=1;l<=u;l=l+1)ie=o[l][ee],o[l][ee]=o[l][ee+1],o[l][ee+1]=ie}else{for(Q=E/(1+d),l=ee+1;l<=x;l=l+1)ie=d*R[G-1]+E*R[G],R[G]=Q*(R[G-1]+ie)-R[G],R[G-1]=ie,G=G+l;for(l=1;l<=u;l=l+1)ie=d*o[l][ee]+E*o[l][ee+1],o[l][ee+1]=Q*(o[l][ee]+ie)-o[l][ee+1],o[l][ee]=ie}return 0}function le(){for(G=Z-ee,l=1;l<=ee;l=l+1)R[G]=R[Z],Z=Z+1,G=G+1;return R[N+ee]=R[N+ee+1],F[ee]=F[ee+1],ee=ee+1,ee<x?797:0}function s(){return R[N+x]=R[N+x+1],R[N+x+1]=0,F[x]=0,x=x-1,O[2]=O[2]+1,0}for(q=0;;){if(q=K(),q===999)return;for(;q=ne(),q!==0;){if(q===999)return;if(q===700)if(ee===x)s();else{for(;oe(),q=le(),q===797;);s()}}}}function c(o,f,h,u,M,m){o=t(o),f=t(f),h=t(h);var v,y,S,_,L,F=[],x=[],O=[],R=[],I=[],l;if(M=M||0,m=m?t(m):[void 0,0],u=u?t(u):[],y=o.length-1,S=h[1].length-1,!u)for(v=1;v<=S;v=v+1)u[v]=0;for(v=1;v<=S;v=v+1)x[v]=0;for(_=0,L=Math.min(y,S),v=1;v<=y;v=v+1)O[v]=0;for(F[1]=0,v=1;v<=2*y+L*(L+5)/2+2*S+1;v=v+1)R[v]=0;for(v=1;v<=2;v=v+1)I[v]=0;return e(o,f,y,y,O,F,h,u,y,S,M,x,_,I,R,m),l="",m[1]===1&&(l="constraints are inconsistent, no solution!"),m[1]===2&&(l="matrix D in quadratic function is not positive definite!"),{solution:n(O),value:n(F),unconstrained_solution:n(f),iterations:n(I),iact:n(x),message:l}}p.solveQP=c}(numeric),numeric.svd=function p(t){var n,r=numeric.epsilon,i=1e-64/r,a=50,e=0,c=0,o=0,f=0,h=0,u=numeric.clone(t),M=u.length,m=u[0].length;if(M<m)throw"Need more rows than columns";var v=new Array(m),y=new Array(m);for(c=0;c<m;c++)v[c]=y[c]=0;var S=numeric.rep([m,m],0);function _(J,ee){return J=Math.abs(J),ee=Math.abs(ee),J>ee?J*Math.sqrt(1+ee*ee/J/J):ee==0?J:ee*Math.sqrt(1+J*J/ee/ee)}var L=0,F=0,x=0,O=0,R=0,I=0,l=0;for(c=0;c<m;c++){for(v[c]=F,l=0,h=c+1,o=c;o<M;o++)l+=u[o][c]*u[o][c];if(l<=i)F=0;else for(L=u[c][c],F=Math.sqrt(l),L>=0&&(F=-F),x=L*F-l,u[c][c]=L-F,o=h;o<m;o++){for(l=0,f=c;f<M;f++)l+=u[f][c]*u[f][o];for(L=l/x,f=c;f<M;f++)u[f][o]+=L*u[f][c]}for(y[c]=F,l=0,o=h;o<m;o++)l=l+u[c][o]*u[c][o];if(l<=i)F=0;else{for(L=u[c][c+1],F=Math.sqrt(l),L>=0&&(F=-F),x=L*F-l,u[c][c+1]=L-F,o=h;o<m;o++)v[o]=u[c][o]/x;for(o=h;o<M;o++){for(l=0,f=h;f<m;f++)l+=u[o][f]*u[c][f];for(f=h;f<m;f++)u[o][f]+=l*v[f]}}R=Math.abs(y[c])+Math.abs(v[c]),R>O&&(O=R)}for(c=m-1;c!=-1;c+=-1){if(F!=0){for(x=F*u[c][c+1],o=h;o<m;o++)S[o][c]=u[c][o]/x;for(o=h;o<m;o++){for(l=0,f=h;f<m;f++)l+=u[c][f]*S[f][o];for(f=h;f<m;f++)S[f][o]+=l*S[f][c]}}for(o=h;o<m;o++)S[c][o]=0,S[o][c]=0;S[c][c]=1,F=v[c],h=c}for(c=m-1;c!=-1;c+=-1){for(h=c+1,F=y[c],o=h;o<m;o++)u[c][o]=0;if(F!=0){for(x=u[c][c]*F,o=h;o<m;o++){for(l=0,f=h;f<M;f++)l+=u[f][c]*u[f][o];for(L=l/x,f=c;f<M;f++)u[f][o]+=L*u[f][c]}for(o=c;o<M;o++)u[o][c]=u[o][c]/F}else for(o=c;o<M;o++)u[o][c]=0;u[c][c]+=1}for(r=r*O,f=m-1;f!=-1;f+=-1)for(var b=0;b<a;b++){var Z=!1;for(h=f;h!=-1;h+=-1){if(Math.abs(v[h])<=r){Z=!0;break}if(Math.abs(y[h-1])<=r)break}if(!Z){e=0,l=1;var G=h-1;for(c=h;c<f+1&&(L=l*v[c],v[c]=e*v[c],!(Math.abs(L)<=r));c++)for(F=y[c],x=_(L,F),y[c]=x,e=F/x,l=-L/x,o=0;o<M;o++)R=u[o][G],I=u[o][c],u[o][G]=R*e+I*l,u[o][c]=-R*l+I*e}if(I=y[f],h==f){if(I<0)for(y[f]=-I,o=0;o<m;o++)S[o][f]=-S[o][f];break}if(b>=a-1)throw"Error: no convergence.";for(O=y[h],R=y[f-1],F=v[f-1],x=v[f],L=((R-I)*(R+I)+(F-x)*(F+x))/(2*x*R),F=_(L,1),L<0?L=((O-I)*(O+I)+x*(R/(L-F)-x))/O:L=((O-I)*(O+I)+x*(R/(L+F)-x))/O,e=1,l=1,c=h+1;c<f+1;c++){for(F=v[c],R=y[c],x=l*F,F=e*F,I=_(L,x),v[c-1]=I,e=L/I,l=x/I,L=O*e+F*l,F=-O*l+F*e,x=R*l,R=R*e,o=0;o<m;o++)O=S[o][c-1],I=S[o][c],S[o][c-1]=O*e+I*l,S[o][c]=-O*l+I*e;for(I=_(L,x),y[c-1]=I,e=L/I,l=x/I,L=e*F+l*R,O=-l*F+e*R,o=0;o<M;o++)R=u[o][c-1],I=u[o][c],u[o][c-1]=R*e+I*l,u[o][c]=-R*l+I*e}v[h]=0,v[f]=L,y[f]=O}for(c=0;c<y.length;c++)y[c]<r&&(y[c]=0);for(c=0;c<m;c++)for(o=c-1;o>=0;o--)if(y[o]<y[c]){for(e=y[o],y[o]=y[c],y[c]=e,f=0;f<u.length;f++)n=u[f][c],u[f][c]=u[f][o],u[f][o]=n;for(f=0;f<S.length;f++)n=S[f][c],S[f][c]=S[f][o],S[f][o]=n;c=o}return{U:u,S:y,V:S}}})(numeric1_2_6);var numeric$1=numeric1_2_6,forwardSHT=function(p,t,n,r){var i=t.length,a=(p+1)*(p+1),e,c=[,];a>i&&console.log("The SHT degree is too high for the number of data points"),n==0&&(t=convertCart2Sph(t));for(var o=0;o<t.length;o++)c[o]=t[o][2];Y_N=computeRealSH(p,t),r==0?e=numeric$1.mul(1/i,Y_N):e=pinv_direct(numeric$1.transpose(Y_N));var f=numeric$1.dotMV(e,c);return f},convertCart2Sph=function(p,t){for(var n,r,i,a=new Array(p.length),e=0;e<p.length;e++)n=Math.atan2(p[e][1],p[e][0]),r=Math.atan2(p[e][2],Math.sqrt(p[e][0]*p[e][0]+p[e][1]*p[e][1])),t==1?a[e]=[n,r]:(i=Math.sqrt(p[e][0]*p[e][0]+p[e][1]*p[e][1]+p[e][2]*p[e][2]),a[e]=[n,r,i]);return a},computeRealSH=function(p,t){for(var n=new Array(t.length),r=new Array(t.length),i=0;i<t.length;i++)n[i]=t[i][0],r[i]=t[i][1];var a=new Array(2*p+1);n.length;for(var e=(p+1)*(p+1),c=0,o=0,f,h=numeric$1.sin(r),u=0,M=new Array(e),m,v,y,S,i=0;i<2*p+1;i++)a[i]=factorial(i);for(var _=0;_<p+1;_++){if(_==0){var L=new Array(n.length);L.fill(1),M[_]=L,u=1}else{f=recurseLegendrePoly(_,h,c,o),m=Math.sqrt(2*_+1);for(var F=0;F<_+1;F++)F==0?M[u+_]=numeric$1.mul(m,f[F]):(v=m*Math.sqrt(2*a[_-F]/a[_+F]),y=numeric$1.cos(numeric$1.mul(F,n)),S=numeric$1.sin(numeric$1.mul(F,n)),M[u+_-F]=numeric$1.mul(v,numeric$1.mul(f[F],S)),M[u+_+F]=numeric$1.mul(v,numeric$1.mul(f[F],y)));u=u+2*_+1}o=c,c=f}return M},factorial=function(p){return p===0?1:p*factorial(p-1)},recurseLegendrePoly=function(p,t,n,r){var i=new Array(p+1);switch(p){case 1:var h=numeric$1.mul(t,t),a=t,e=numeric$1.sqrt(numeric$1.sub(1,h));i[0]=a,i[1]=e;break;case 2:var h=numeric$1.mul(t,t),c=numeric$1.mul(3,h);c=numeric$1.sub(c,1),c=numeric$1.div(c,2);var o=numeric$1.sub(1,h);o=numeric$1.sqrt(o),o=numeric$1.mul(3,o),o=numeric$1.mul(o,t);var f=numeric$1.sub(1,h);f=numeric$1.mul(3,f),i[0]=c,i[1]=o,i[2]=f;break;default:var h=numeric$1.mul(t,t),u=numeric$1.sub(1,h),M=2*p-1,m=1;if(M%2==0)for(var v=1;v<M/2+1;v++)m=m*2*v;else for(var v=1;v<(M+1)/2+1;v++)m=m*(2*v-1);i[p]=numeric$1.mul(m,numeric$1.pow(u,p/2)),i[p-1]=numeric$1.mul(2*p-1,numeric$1.mul(t,n[p-1]));for(var y=0;y<p-1;y++){var S=numeric$1.mul(2*p-1,numeric$1.mul(t,n[y])),_=numeric$1.mul(p+y-1,r[y]);i[y]=numeric$1.div(numeric$1.sub(S,_),p-y)}}return i},pinv_direct=function(p){var t=numeric$1.transpose(p);return numeric$1.dot(numeric$1.inv(numeric$1.dot(t,p)),t)},getSHrotMtx=function(p,t){var n=(t+1)*(t+1),r=numeric$1.rep([n,n],0);r[0][0]=1;var i=numeric$1.rep([3,3],0);i[0][0]=p[1][1],i[0][1]=p[1][2],i[0][2]=p[1][0],i[1][0]=p[2][1],i[1][1]=p[2][2],i[1][2]=p[2][0],i[2][0]=p[0][1],i[2][1]=p[0][2],i[2][2]=p[0][0],r=numeric$1.setBlock(r,[1,1],[3,3],i);for(var a=i,e=3,c=2;c<t+1;c++){for(var o=numeric$1.rep([2*c+1,2*c+1],0),f=-c;f<c+1;f++)for(var h=-c;h<c+1;h++){var u,M,m,v,y;f==0?u=1:u=0,Math.abs(h)==c?M=2*c*(2*c-1):M=c*c-h*h,m=Math.sqrt((c*c-f*f)/M),v=Math.sqrt((1+u)*(c+Math.abs(f)-1)*(c+Math.abs(f))/M)*(1-2*u)*.5,y=Math.sqrt((c-Math.abs(f)-1)*(c-Math.abs(f))/M)*(1-u)*-.5,m!=0&&(m=m*U(c,f,h,i,a)),v!=0&&(v=v*V(c,f,h,i,a)),y!=0&&(y=y*W(c,f,h,i,a)),o[f+c][h+c]=m+v+y}r=numeric$1.setBlock(r,[e+1,e+1],[e+2*c+1,e+2*c+1],o),a=o,e=e+2*c+1}return r};function U(p,t,n,r,i){return P(0,p,t,n,r,i)}function V(p,t,n,r,i){var a,e,c,o;return t==0?(a=P(1,p,1,n,r,i),e=P(-1,p,-1,n,r,i),c=a+e):t>0?(t==1?o=1:o=0,a=P(1,p,t-1,n,r,i),e=P(-1,p,-t+1,n,r,i),c=a*Math.sqrt(1+o)-e*(1-o)):(t==-1?o=1:o=0,a=P(1,p,t+1,n,r,i),e=P(-1,p,-t-1,n,r,i),c=a*(1-o)+e*Math.sqrt(1+o)),c}function W(p,t,n,r,i){var a,e,c;return t==0?console.error("should not be called"):t>0?(a=P(1,p,t+1,n,r,i),e=P(-1,p,-t-1,n,r,i),c=a+e):(a=P(1,p,t-1,n,r,i),e=P(-1,p,-t+1,n,r,i),c=a-e),c}function P(p,t,n,r,i,a){var e,c,o,f;return e=i[p+1][2],c=i[p+1][0],o=i[p+1][1],r==-t?f=e*a[n+t-1][0]+c*a[n+t-1][2*t-2]:r==t?f=e*a[n+t-1][2*t-2]-c*a[n+t-1][0]:f=o*a[n+t-1][r+t-1],f}var yawPitchRoll2Rzyx=function(p,t,n){var r,i,a;n==0?r=[[1,0,0],[0,1,0],[0,0,1]]:r=[[1,0,0],[0,Math.cos(n),Math.sin(n)],[0,-Math.sin(n),Math.cos(n)]],t==0?i=[[1,0,0],[0,1,0],[0,0,1]]:i=[[Math.cos(t),0,-Math.sin(t)],[0,1,0],[Math.sin(t),0,Math.cos(t)]],p==0?a=[[1,0,0],[0,1,0],[0,0,1]]:a=[[Math.cos(p),Math.sin(p),0],[-Math.sin(p),Math.cos(p),0],[0,0,1]];var e=numeric$1.dotMMsmall(i,a);return e=numeric$1.dotMMsmall(r,e),e},forwardSHT_1=forwardSHT,convertCart2Sph_1=convertCart2Sph,computeRealSH_1=computeRealSH,factorial_1=factorial,recurseLegendrePoly_1=recurseLegendrePoly,getSHrotMtx_1=getSHrotMtx,yawPitchRoll2Rzyx_1=yawPitchRoll2Rzyx,jshlib=require("spherical-harmonic-transform"),convexhull=require("convex-hull");const numeric={mul:function(p,t){return Array.isArray(p)&&typeof t=="number"?p.map(n=>n*t):typeof p=="number"&&Array.isArray(t)?t.map(n=>p*n):Array.isArray(p)&&Array.isArray(t)?p.map((n,r)=>n*t[r]):p*t},div:function(p,t){return Array.isArray(p)?p.map(n=>n/t):p/t},sin:function(p){return p.map(t=>Math.sin(t))},cos:function(p){return p.map(t=>Math.cos(t))},pow:function(p,t){return p.map(n=>Math.pow(n,t))},sum:function(p){return p.reduce((t,n)=>t+n,0)},dotVV:function(p,t){let n=0;for(let r=0;r<p.length;r++)n+=p[r]*t[r];return n},sub:function(p,t){return Array.isArray(p)&&Array.isArray(t)?p.map((n,r)=>n-t[r]):p-t},round:function(p){return Array.isArray(p)?p.map(t=>Math.round(t)):Math.round(p)},mod:function(p,t){return Array.isArray(p)?p.map(n=>(n%t+t)%t):(p%t+t)%t},add:function(...p){if(p.length===0)return 0;let t=p[0];for(let n=1;n<p.length;n++){const r=p[n];Array.isArray(t)&&Array.isArray(r)?t=t.map((i,a)=>i+r[a]):Array.isArray(t)&&typeof r=="number"?t=t.map(i=>i+r):typeof t=="number"&&Array.isArray(r)?t=r.map(i=>i+t):t=t+r}return t},transpose:function(p){const t=p.length,n=p[0].length,r=new Array(n);for(let i=0;i<n;i++){r[i]=new Array(t);for(let a=0;a<t;a++)r[i][a]=p[a][i]}return r},dotMMsmall:function(p,t){const n=p.length,r=p[0].length,i=t[0].length,a=new Array(n);for(let e=0;e<n;e++){a[e]=new Array(i);for(let c=0;c<i;c++){let o=0;for(let f=0;f<r;f++)o+=p[e][f]*t[f][c];a[e][c]=o}}return a},inv:function(p){const t=p.length,n=new Array(t);for(let i=0;i<t;i++){n[i]=new Array(2*t);for(let a=0;a<t;a++)n[i][a]=p[i][a],n[i][a+t]=i===a?1:0}for(let i=0;i<t;i++){let a=i;for(let c=i+1;c<t;c++)Math.abs(n[c][i])>Math.abs(n[a][i])&&(a=c);if([n[i],n[a]]=[n[a],n[i]],Math.abs(n[i][i])<1e-10)throw new Error("Matrix is singular");const e=n[i][i];for(let c=0;c<2*t;c++)n[i][c]/=e;for(let c=0;c<t;c++)if(c!==i){const o=n[c][i];for(let f=0;f<2*t;f++)n[c][f]-=o*n[i][f]}}const r=new Array(t);for(let i=0;i<t;i++){r[i]=new Array(t);for(let a=0;a<t;a++)r[i][a]=n[i][a+t]}return r},identity:function(p){const t=new Array(p);for(let n=0;n<p;n++){t[n]=new Array(p);for(let r=0;r<p;r++)t[n][r]=n===r?1:0}return t},diag:function(p){const t=p.length,n=new Array(t);for(let r=0;r<t;r++){n[r]=new Array(t);for(let i=0;i<t;i++)n[r][i]=r===i?p[r]:0}return n},dot:function(p,t){if(!Array.isArray(p[0])&&!Array.isArray(t[0]))return numeric.dotVV(p,t);if(Array.isArray(p[0])&&!Array.isArray(t[0])){const e=p.length,c=p[0].length,o=new Array(e);for(let f=0;f<e;f++){let h=0;for(let u=0;u<c;u++)h+=p[f][u]*t[u];o[f]=h}return o}const n=p.length,r=p[0].length,i=t[0].length,a=new Array(n);for(let e=0;e<n;e++){a[e]=new Array(i);for(let c=0;c<i;c++){let o=0;for(let f=0;f<r;f++)o+=p[e][f]*t[f][c];a[e][c]=o}}return a}};function deg2rad(p){var t=[],n=Math.PI/180;for(let r=0;r<p.length;r++)p[0].length==3?t.push([p[r][0]*n,p[r][1]*n,p[r][2]]):p[0].length==2&&t.push([p[r][0]*n,p[r][1]*n]);return t}function rad2deg(p){var t=[],n=180/Math.PI;for(let r=0;r<p.length;r++)p[0].length==3?t.push([p[r][0]*n,p[r][1]*n,p[r][2]]):p[0].length==2&&t.push([p[r][0]*n,p[r][1]*n]);return t}function getColumn(p,t){return p.map(function(n){return n[t]})}function sampleCircle(p){for(var t=[],n=360/p,r=0,i=0;i<p;i++)t.push([r,0,1]),r+=n;return t}function getCircHarmonics(p,t){var n=p,r=2*n+1,i=t.length,a=new Array(r),e=new Array(i);t=numeric.mul(t,Math.PI/180),e.fill(1/Math.sqrt(2*Math.PI)),a[0]=e;for(var c=0;c<n;c++)a[2*c+1]=numeric.div(numeric.sin(numeric.mul(-(c+1),t)),Math.sqrt(Math.PI)),a[2*c+2]=numeric.div(numeric.cos(numeric.mul(c+1,t)),Math.sqrt(Math.PI));return a}function getAmbisonicDecMtx(p,t){var n=deg2rad(p),r=jshlib.convertSph2Cart(n),i=convexhull(r),a=i.length,e=n.length,c=new Array(a);for(let v=0;v<a;v++){let y=new Array(3);for(let L=0;L<3;L++)y[L]=r[i[v][L]];let S=numeric.inv(y),_=[];for(let L=0;L<3;L++)for(let F=0;F<3;F++)_.push(S[F][L]);c[v]=_}var o=getTdesign(2*t),f=deg2rad(o),h=vbap3(f,i,c,e);h=numeric.transpose(h);var u=jshlib.computeRealSH(t,f);u=numeric.transpose(u);var M=f.length,m=numeric.dotMMsmall(h,u);return m=numeric.mul(1/M,m),m}var vbap3=function(p,t,n,r){var i=p.length,a=r,e=t.length;function c(h){return Math.min.apply(null,h)}var o=new Array(i),f=jshlib.convertSph2Cart(p);for(let h=0;h<i;h++){let u=f[h],M=new Array(a);M.fill(0);for(let y=0;y<e;y++){let S=[],_=[n[y][0],n[y][1],n[y][2]];if(S[0]=numeric.dotVV(_,u),_=[n[y][3],n[y][4],n[y][5]],S[1]=numeric.dotVV(_,u),_=[n[y][6],n[y][7],n[y][8]],S[2]=numeric.dotVV(_,u),c(S)>-.001){let L=Math.sqrt(numeric.sum(numeric.pow(S,2))),F=numeric.div(S,L);for(let x=0;x<3;x++)M[t[y][x]]=F[x];break}}let m=Math.sqrt(numeric.sum(numeric.pow(M,2))),v=numeric.div(M,m);o[h]=v}return o};function createNearestLookup(p,t){var n=p.length,r=jshlib.convertSph2Cart(deg2rad(p)),i=Math.round(360/t[0])+1,a=Math.round(180/t[1])+1,e=new Array(i);e[0]=-180;for(let f=1;f<i;f++)e[f]=e[f-1]+t[0];var c=i*a,o=new Array(c);for(let f=0;f<c;f++){let h=[[f%i*t[0]-180,Math.floor(f/i)*t[1]-90]],u=jshlib.convertSph2Cart(deg2rad(h)),M=1e3;for(let m=0;m<n;m++){let v=numeric.sum(numeric.pow(numeric.sub(u[0],r[m]),2));v<M&&(o[f]=m,M=v)}}return o}function findNearest(p,t,n){var r=p.length,i=[],a=[];for(let u=0;u<r;u++)i.push(p[u][0]+180),a.push(p[u][1]+90);var e=Math.round(360/n[0])+1,c=numeric.round(numeric.div(numeric.mod(i,360),n[0])),o=numeric.round(numeric.div(a,n[1])),f=numeric.add(numeric.mul(o,e),c,1),h=[];for(let u=0;u<r;u++)h.push(t[f[u]]);return h}function getTdesign(p){if(p>21)throw new Error("Designs of order greater than 21 are not implemented");if(p<1)throw new Error("Order should be at least 1");var t=[[[0,0,1],[180,0,1]],[[45,35.26,1],[-45,-35.26,1],[135,-35.26,1],[-135,35.26,1]],[[0,0,1],[180,0,1],[90,0,1],[-90,0,1],[0,90,1],[0,-90,1]],[[0,-31.72,1],[-58.28,0,1],[-90,58.28,1],[0,31.72,1],[-121.72,0,1],[90,-58.28,1],[180,-31.72,1],[121.72,0,1],[90,58.28,1],[180,31.72,1],[58.28,0,1],[-90,-58.28,1]],[[0,-31.72,1],[-58.28,0,1],[-90,58.28,1],[0,31.72,1],[-121.72,0,1],[90,-58.28,1],[180,-31.72,1],[121.72,0,1],[90,58.28,1],[180,31.72,1],[58.28,0,1],[-90,-58.28,1]],[[26,15.46,1],[-26,-15.46,1],[17.11,-24.99,1],[-17.11,24.99,1],[154,-15.46,1],[-154,15.46,1],[162.89,24.99,1],[-162.89,-24.99,1],[72.89,24.99,1],[107.11,-24.99,1],[116,15.46,1],[64,-15.46,1],[-107.11,24.99,1],[-72.89,-24.99,1],[-64,15.46,1],[-116,-15.46,1],[32.25,60.03,1],[-147.75,60.03,1],[-57.75,60.03,1],[122.25,60.03,1],[-32.25,-60.03,1],[147.75,-60.03,1],[57.75,-60.03,1],[-122.25,-60.03,1]],[[26,15.46,1],[-26,-15.46,1],[17.11,-24.99,1],[-17.11,24.99,1],[154,-15.46,1],[-154,15.46,1],[162.89,24.99,1],[-162.89,-24.99,1],[72.89,24.99,1],[107.11,-24.99,1],[116,15.46,1],[64,-15.46,1],[-107.11,24.99,1],[-72.89,-24.99,1],[-64,15.46,1],[-116,-15.46,1],[32.25,60.03,1],[-147.75,60.03,1],[-57.75,60.03,1],[122.25,60.03,1],[-32.25,-60.03,1],[147.75,-60.03,1],[57.75,-60.03,1],[-122.25,-60.03,1]],[[-31.11,53.65,1],[110.82,30.5,1],[148.89,53.65,1],[32.21,-17.83,1],[69.18,-30.5,1],[-32.21,17.83,1],[-69.18,30.5,1],[-147.79,-17.83,1],[-110.82,-30.5,1],[147.79,17.83,1],[31.11,-53.65,1],[-148.89,-53.65,1],[-21.25,-47.78,1],[-108.2,38.78,1],[158.75,-47.78,1],[139.77,-14.09,1],[-71.8,-38.78,1],[-139.77,14.09,1],[71.8,38.78,1],[-40.23,-14.09,1],[108.2,-38.78,1],[40.23,14.09,1],[21.25,47.78,1],[-158.75,47.78,1],[106.65,-2.55,1],[-2.66,-16.63,1],[-73.35,-2.55,1],[-98.84,73.16,1],[-177.34,16.63,1],[98.84,-73.16,1],[177.34,-16.63,1],[81.16,73.16,1],[2.66,16.63,1],[-81.16,-73.16,1],[-106.65,2.55,1],[73.35,2.55,1]],[[20.75,-3.55,1],[-20.75,3.55,1],[-3.8,-20.7,1],[3.8,20.7,1],[159.25,3.55,1],[-159.25,-3.55,1],[-176.2,20.7,1],[176.2,-20.7,1],[93.8,20.7,1],[86.2,-20.7,1],[110.75,-3.55,1],[69.25,3.55,1],[-86.2,20.7,1],[-93.8,-20.7,1],[-69.25,-3.55,1],[-110.75,3.55,1],[-9.94,68.97,1],[170.06,68.97,1],[-99.94,68.97,1],[80.06,68.97,1],[9.94,-68.97,1],[-170.06,-68.97,1],[99.94,-68.97,1],[-80.06,-68.97,1],[42.15,17.57,1],[-42.15,-17.57,1],[23.12,-39.77,1],[-23.12,39.77,1],[137.85,-17.57,1],[-137.85,17.57,1],[156.88,39.77,1],[-156.88,-39.77,1],[66.88,39.77,1],[113.12,-39.77,1],[132.15,17.57,1],[47.85,-17.57,1],[-113.12,39.77,1],[-66.88,-39.77,1],[-47.85,17.57,1],[-132.15,-17.57,1],[25.26,44.98,1],[-154.74,44.98,1],[-64.74,44.98,1],[115.26,44.98,1],[-25.26,-44.98,1],[154.74,-44.98,1],[64.74,-44.98,1],[-115.26,-44.98,1]],[[144.09,-21.45,1],[-33.81,-48.92,1],[-35.91,-21.45,1],[-115.87,33.09,1],[-146.19,48.92,1],[115.87,-33.09,1],[146.19,-48.92,1],[64.13,33.09,1],[33.81,48.92,1],[-64.13,-33.09,1],[-144.09,21.45,1],[35.91,21.45,1],[-45.53,1.95,1],[177.26,44.44,1],[134.47,1.95,1],[87.21,-45.49,1],[2.74,-44.44,1],[-87.21,45.49,1],[-2.74,44.44,1],[-92.79,-45.49,1],[-177.26,-44.44,1],[92.79,45.49,1],[45.53,-1.95,1],[-134.47,-1.95,1],[15.59,-73.34,1],[-85.4,16.04,1],[-164.41,-73.34,1],[163.92,4.42,1],[-94.6,-16.04,1],[-163.92,-4.42,1],[94.6,16.04,1],[-16.08,4.42,1],[85.4,-16.04,1],[16.08,-4.42,1],[-15.59,73.34,1],[164.41,73.34,1],[-60.02,25.27,1],[151.41,26.86,1],[119.98,25.27,1],[46.63,-51.57,1],[28.59,-26.86,1],[-46.63,51.57,1],[-28.59,26.86,1],[-133.37,-51.57,1],[-151.41,-26.86,1],[133.37,51.57,1],[60.02,-25.27,1],[-119.98,-25.27,1],[-109.94,6.91,1],[172.65,-19.79,1],[70.06,6.91,1],[-70.44,-68.94,1],[7.35,19.79,1],[70.44,68.94,1],[-7.35,-19.79,1],[109.56,-68.94,1],[-172.65,19.79,1],[-109.56,68.94,1],[109.94,-6.91,1],[-70.06,-6.91,1]],[[132.93,7.69,1],[-83.93,-23.73,1],[8.47,23.51,1],[-113.34,70.42,1],[-103.27,-9.9,1],[-33.24,-70.75,1],[21.86,-26.46,1],[-156.54,47.78,1],[-64.26,-7.72,1],[165.78,44.53,1],[-25.2,26.39,1],[-97,-44.66,1],[27.85,9.77,1],[153.21,-47.71,1],[-155.06,7.45,1],[-11.84,-23.59,1],[80.54,23.72,1],[-42.06,70.44,1],[-31.22,-9.84,1],[38.84,-70.5,1],[93.76,-26.29,1],[-84.76,47.61,1],[7.76,-7.52,1],[-122.28,44.29,1],[46.8,26.64,1],[-24.77,-44.57,1],[99.89,9.91,1],[-134.78,-47.96,1],[-83.09,7.3,1],[60.13,-23.34,1],[152.64,23.64,1],[29.76,70.68,1],[40.78,-9.58,1],[110.18,-70.39,1],[165.65,-26.43,1],[-12.99,47.75,1],[79.74,-7.31,1],[-50.52,44.26,1],[118.92,26.71,1],[47.22,-44.31,1],[171.93,9.76,1],[-62.51,-48.04,1],[-11.12,7.44,1],[132.02,-23.33,1],[-135.36,23.39,1],[102.37,70.82,1],[112.74,-9.49,1],[-178.3,-70.58,1],[-122.32,-26.67,1],[59.08,48,1],[151.7,-7.38,1],[21.38,44.5,1],[-169.01,26.5,1],[118.98,-44.25,1],[-116.09,9.52,1],[9.65,-47.83,1],[60.89,7.68,1],[-156.02,-23.57,1],[-63.46,23.31,1],[174.93,70.66,1],[-175.29,-9.68,1],[-105.95,-70.8,1],[-50.19,-26.7,1],[131.36,48.01,1],[-136.3,-7.64,1],[93.56,44.67,1],[-97.08,26.3,1],[-169.16,-44.46,1],[-44.13,9.52,1],[81.48,-47.62,1]],[[-154.47,7.9,1],[162.15,-63.36,1],[25.53,7.9,1],[-81.26,-25.27,1],[17.85,63.36,1],[81.26,25.27,1],[-17.85,-63.36,1],[98.74,-25.27,1],[-162.15,63.36,1],[-98.74,25.27,1],[154.47,-7.9,1],[-25.53,-7.9,1],[1.3,-10.47,1],[-83.01,79.45,1],[-178.7,-10.47,1],[100.48,1.28,1],[-96.99,-79.45,1],[-100.48,-1.28,1],[96.99,79.45,1],[-79.52,1.28,1],[83.01,-79.45,1],[79.52,-1.28,1],[-1.3,10.47,1],[178.7,10.47,1],[157.24,13.15,1],[31.14,-63.89,1],[-22.76,13.15,1],[-75.78,22.13,1],[148.86,63.89,1],[75.78,-22.13,1],[-148.86,-63.89,1],[104.22,22.13,1],[-31.14,63.89,1],[-104.22,-22.13,1],[-157.24,-13.15,1],[22.76,-13.15,1],[110.44,-60.62,1],[-62.18,-9.87,1],[-69.56,-60.62,1],[-168.88,27.37,1],[-117.82,9.87,1],[168.88,-27.37,1],[117.82,-9.87,1],[11.12,27.37,1],[62.18,9.87,1],[-11.12,-27.37,1],[-110.44,60.62,1],[69.56,60.62,1],[-125.93,-47.4,1],[-126.67,-23.4,1],[54.07,-47.4,1],[-151.65,-33.24,1],[-53.33,23.4,1],[151.65,33.24,1],[53.33,-23.4,1],[28.35,-33.24,1],[126.67,23.4,1],[-28.35,33.24,1],[125.93,47.4,1],[-54.07,47.4,1],[61.41,37.54,1],[41.19,22.3,1],[-118.59,37.54,1],[31.92,44.13,1],[138.81,-22.3,1],[-31.92,-44.13,1],[-138.81,22.3,1],[-148.08,44.13,1],[-41.19,-22.3,1],[148.08,-44.13,1],[-61.41,-37.54,1],[118.59,-37.54,1],[132.92,4.73,1],[6.45,-42.74,1],[-47.08,4.73,1],[-83.07,46.87,1],[173.55,42.74,1],[83.07,-46.87,1],[-173.55,-42.74,1],[96.93,46.87,1],[-6.45,42.74,1],[-96.93,-46.87,1],[-132.92,-4.73,1],[47.08,-4.73,1]],[[-40.36,68.7,1],[61.12,65.68,1],[141.73,70.75,1],[-131.25,72.32,1],[-154.88,-12.62,1],[-66.2,-9.78,1],[26.36,-11.97,1],[114.95,-12.58,1],[37.02,51.13,1],[129.77,51.95,1],[-140.63,50.15,1],[-56.5,47.88,1],[-65.05,12.58,1],[25.12,12.62,1],[113.8,9.78,1],[-153.64,11.97,1],[-134.51,-9.73,1],[-46.23,-8.37,1],[47.91,-9.73,1],[141.51,-8.73,1],[-17.84,-44.1,1],[69.37,-43.27,1],[151.22,-42.67,1],[-106.78,-40.18,1],[-50.23,-51.95,1],[39.37,-50.15,1],[123.5,-47.88,1],[-142.98,-51.13,1],[-179.19,-60.75,1],[-84.57,-54.07,1],[5.39,-58.05,1],[89.5,-60.75,1],[-145.98,31.02,1],[-54.39,26.43,1],[28.92,32.51,1],[125.34,30.94,1],[168.71,-7.06,1],[-112.49,-10.38,1],[-21.96,-9.6,1],[73.11,-8.31,1],[95.68,.04,1],[-170.71,2.32,1],[-84.32,-.04,1],[9.29,-2.32,1],[9.19,-34.33,1],[98.21,-37.31,1],[-179.2,-40.48,1],[-77.81,-31.6,1],[-177.08,-21.74,1],[-93.77,-18.83,1],[-2.72,-19.8,1],[90.51,-20.91,1],[-106.89,8.31,1],[-11.29,7.06,1],[67.51,10.38,1],[158.04,9.6,1],[-118.88,-65.68,1],[-38.27,-70.75,1],[48.75,-72.32,1],[139.64,-68.7,1],[-54.66,-30.94,1],[34.02,-31.02,1],[125.61,-26.43,1],[-151.08,-32.51,1],[-170.81,34.33,1],[-81.79,37.31,1],[.8,40.48,1],[102.19,31.6,1],[-28.78,42.67,1],[73.22,40.18,1],[162.16,44.1,1],[-110.63,43.27,1],[-89.49,20.91,1],[2.92,21.74,1],[86.23,18.83,1],[177.28,19.8,1],[133.77,8.37,1],[-132.09,9.73,1],[-38.49,8.73,1],[45.49,9.73,1],[-25.6,24.04,1],[55.12,30.23,1],[149.3,28.05,1],[-118.71,26.06,1],[.81,60.75,1],[95.43,54.07,1],[-174.61,58.05,1],[-90.5,60.75,1],[-124.88,-30.23,1],[-30.7,-28.05,1],[61.29,-26.06,1],[154.4,-24.04,1],[-132.92,-85.6,1],[47.08,85.6,1]],[[-129.19,8.11,1],[169.58,-38.73,1],[50.81,8.12,1],[-77.27,-50.11,1],[10.42,38.73,1],[77.3,50.12,1],[-10.41,-38.72,1],[102.71,-50.11,1],[-169.57,38.72,1],[-102.71,50.11,1],[129.19,-8.11,1],[-50.8,-8.11,1],[-4.59,-56.01,1],[-93.1,33.85,1],[175.39,-56.03,1],[146.11,-2.57,1],[-86.89,-33.86,1],[-146.1,2.56,1],[86.91,33.86,1],[-33.89,-2.57,1],[93.1,-33.85,1],[33.9,2.58,1],[4.6,56.03,1],[-175.38,56.01,1],[106.57,26.1,1],[27.07,-14.82,1],[-73.44,26.09,1],[-30.2,59.41,1],[152.94,14.83,1],[30.2,-59.4,1],[-152.93,-14.84,1],[149.82,59.41,1],[-27.06,14.83,1],[-149.8,-59.42,1],[-106.55,-26.1,1],[73.44,-26.09,1],[-171.42,77.45,1],[91.9,-12.4,1],[8.54,77.46,1],[-12.4,-1.85,1],[88.11,12.41,1],[12.41,1.86,1],[-88.1,-12.41,1],[167.6,-1.86,1],[-91.89,12.4,1],[-167.59,1.84,1],[171.43,-77.46,1],[-8.52,-77.45,1],[-122.73,-10.44,1],[-167.65,-32.13,1],[57.27,-10.43,1],[-108.8,-55.83,1],[-12.35,32.13,1],[108.83,55.83,1],[12.36,-32.12,1],[71.19,-55.82,1],[167.66,32.12,1],[-71.19,55.82,1],[122.74,10.44,1],[-57.27,10.44,1],[-135.84,-23.05,1],[-148.58,-41.32,1],[44.16,-23.04,1],[-120.66,-39.88,1],[-31.41,41.31,1],[120.68,39.87,1],[31.42,-41.3,1],[59.33,-39.86,1],[148.6,41.31,1],[-59.33,39.87,1],[135.85,23.05,1],[-44.16,23.05,1],[-161.55,20.62,1],[130.04,-62.6,1],[18.45,20.64,1],[-68.35,-17.23,1],[49.96,62.61,1],[68.36,17.23,1],[-49.93,-62.6,1],[111.65,-17.22,1],[-130.05,62.59,1],[-111.64,17.22,1],[161.56,-20.63,1],[-18.44,-20.62,1],[-105.23,-3.38,1],[-176.5,-15.21,1],[74.77,-3.37,1],[-102.64,-74.41,1],[-3.5,15.21,1],[102.69,74.41,1],[3.51,-15.2,1],[77.33,-74.4,1],[176.51,15.2,1],[-77.36,74.4,1],[105.24,3.38,1],[-74.76,3.37,1],[-142.39,25.42,1],[142.08,-45.69,1],[37.61,25.43,1],[-59.02,-33.44,1],[37.92,45.69,1],[59.04,33.45,1],[-37.91,-45.68,1],[120.97,-33.44,1],[-142.07,45.68,1],[-120.96,33.44,1],[142.4,-25.43,1],[-37.6,-25.42,1]],[[-30.6,6.94,1],[166.56,58.69,1],[149.4,6.96,1],[81.95,-30.36,1],[13.48,-58.69,1],[-81.93,30.36,1],[-13.46,58.68,1],[-98.06,-30.37,1],[-166.54,-58.68,1],[98.07,30.37,1],[30.62,-6.95,1],[-149.38,-6.95,1],[106.69,-22.68,1],[-23.57,-15.36,1],[-73.31,-22.69,1],[-145.5,62.1,1],[-156.41,15.36,1],[145.53,-62.1,1],[156.43,-15.35,1],[34.47,62.11,1],[23.58,15.36,1],[-34.46,-62.11,1],[-106.67,22.68,1],[73.33,22.69,1],[166.82,1.39,1],[6.09,-76.74,1],[-13.19,1.38,1],[-88.57,13.18,1],[173.99,76.74,1],[88.59,-13.18,1],[-173.97,-76.73,1],[91.43,13.2,1],[-6.07,76.73,1],[-91.42,-13.2,1],[-166.8,-1.38,1],[13.2,-1.39,1],[-74.67,48.11,1],[130.86,10.16,1],[105.32,48.13,1],[13.34,-40.08,1],[49.16,-10.15,1],[-13.32,40.07,1],[-49.14,10.15,1],[-166.67,-40.08,1],[-130.84,-10.16,1],[166.69,40.08,1],[74.7,-48.11,1],[-105.31,-48.13,1],[-126.99,26.55,1],[147.96,-32.57,1],[53,26.56,1],[-50.28,-45.59,1],[32.05,32.58,1],[50.3,45.59,1],[-32.03,-32.58,1],[129.71,-45.58,1],[-147.94,32.57,1],[-129.69,45.58,1],[127.02,-26.55,1],[-52.98,-26.56,1],[-171.93,30.37,1],[103.47,-58.68,1],[8.07,30.36,1],[-59.38,-6.96,1],[76.54,58.69,1],[59.4,6.95,1],[-76.53,-58.69,1],[120.62,-6.94,1],[-103.44,58.68,1],[-120.6,6.95,1],[171.94,-30.36,1],[-8.05,-30.37,1],[40.86,10.16,1],[15.32,48.12,1],[-139.14,10.16,1],[76.68,40.09,1],[164.69,-48.12,1],[-76.67,-40.09,1],[-164.67,48.12,1],[-103.31,40.07,1],[-15.3,-48.13,1],[103.34,-40.07,1],[-40.84,-10.16,1],[139.16,-10.15,1],[103.2,-1.38,1],[-1.41,-13.19,1],[-76.8,-1.39,1],[-96.02,76.73,1],[-178.57,13.19,1],[96.07,-76.73,1],[178.58,-13.19,1],[83.94,76.74,1],[1.43,13.19,1],[-83.95,-76.74,1],[-103.18,1.38,1],[76.81,1.39,1],[37.02,-26.56,1],[-39.7,45.58,1],[-142.99,-26.56,1],[122.05,32.58,1],[-140.29,-45.59,1],[-122.04,-32.58,1],[140.31,45.59,1],[-57.95,32.57,1],[39.72,-45.58,1],[57.97,-32.57,1],[-37,26.55,1],[143,26.56,1],[163.33,22.69,1],[55.55,-62.1,1],[-16.67,22.68,1],[-66.41,15.35,1],[124.49,62.11,1],[66.43,-15.35,1],[-124.48,-62.11,1],[113.58,15.36,1],[-55.52,62.1,1],[-113.57,-15.36,1],[-163.31,-22.68,1],[16.69,-22.69,1]],[[-10.57,-17.35,1],[-120.42,69.76,1],[169.43,-17.35,1],[107.63,-10.08,1],[-59.57,-69.78,1],[-107.63,10.08,1],[59.57,69.78,1],[-72.37,-10.09,1],[120.42,-69.76,1],[72.37,10.09,1],[10.57,17.35,1],[-169.43,17.35,1],[-30.77,68.25,1],[101.53,18.57,1],[149.25,68.26,1],[18.92,-10.92,1],[78.47,-18.56,1],[-18.92,10.92,1],[-78.47,18.56,1],[-161.09,-10.92,1],[-101.53,-18.56,1],[161.09,10.92,1],[30.78,-68.26,1],[-149.26,-68.26,1],[56.46,41.26,1],[46.46,24.54,1],[-123.53,41.26,1],[32.19,38.8,1],[133.53,-24.53,1],[-32.19,-38.8,1],[-133.53,24.53,1],[-147.8,38.8,1],[-46.46,-24.54,1],[147.8,-38.8,1],[-56.46,-41.27,1],[123.53,-41.26,1],[84.74,27.31,1],[27.41,4.68,1],[-95.26,27.3,1],[10.06,62.23,1],[152.59,-4.67,1],[-10.06,-62.23,1],[-152.59,4.67,1],[-169.92,62.23,1],[-27.4,-4.68,1],[169.92,-62.22,1],[-84.74,-27.31,1],[95.26,-27.3,1],[136.27,-.73,1],[-1.05,-46.27,1],[-43.73,-.74,1],[-91.01,43.72,1],[-178.94,46.27,1],[91.01,-43.72,1],[178.94,-46.27,1],[88.99,43.73,1],[1.05,46.27,1],[-88.99,-43.73,1],[-136.27,.73,1],[43.73,.73,1],[55.23,10.82,1],[13.09,34.07,1],[-124.77,10.81,1],[71.48,53.8,1],[166.91,-34.06,1],[-71.48,-53.8,1],[-166.9,34.06,1],[-108.52,53.79,1],[-13.09,-34.06,1],[108.52,-53.79,1],[-55.23,-10.82,1],[124.77,-10.81,1],[-105.49,-68.13,1],[-111.15,-5.71,1],[74.52,-68.12,1],[-173.89,-21.04,1],[-68.85,5.7,1],[173.89,21.04,1],[68.85,-5.7,1],[6.12,-21.04,1],[111.15,5.71,1],[-6.12,21.04,1],[105.49,68.13,1],[-74.52,68.12,1],[35.28,-15.18,1],[-25.17,51.98,1],[-144.72,-15.19,1],[108.39,33.88,1],[-154.84,-51.99,1],[-108.39,-33.88,1],[154.84,51.99,1],[-71.61,33.87,1],[25.17,-51.98,1],[71.61,-33.87,1],[-35.28,15.18,1],[144.72,15.19,1],[-125.28,-28.56,1],[-146.32,-30.49,1],[54.72,-28.55,1],[-133.29,-45.82,1],[-33.69,30.48,1],[133.3,45.82,1],[33.68,-30.48,1],[46.71,-45.81,1],[146.32,30.49,1],[-46.71,45.81,1],[125.28,28.56,1],[-54.72,28.54,1],[-144.4,54.71,1],[112.38,-28.01,1],[35.58,54.72,1],[-29.92,-19.65,1],[67.62,28.02,1],[29.92,19.65,1],[-67.62,-28.02,1],[150.08,-19.64,1],[-112.38,28.01,1],[-150.08,19.64,1],[144.4,-54.71,1],[-35.58,-54.72,1],[68.53,-52.85,1],[-54.82,12.76,1],[-111.46,-52.87,1],[164.51,34.19,1],[-125.18,-12.77,1],[-164.51,-34.19,1],[125.18,12.77,1],[-15.5,34.19,1],[54.82,-12.76,1],[15.49,-34.19,1],[-68.53,52.85,1],[111.47,52.86,1],[91.48,-7.37,1],[-7.38,-1.47,1],[-88.52,-7.38,1],[-168.69,82.47,1],[-172.62,1.47,1],[168.69,-82.47,1],[172.62,-1.46,1],[11.22,82.48,1],[7.38,1.47,1],[-11.21,-82.48,1],[-91.48,7.37,1],[88.52,7.38,1]],[[-110.97,-81.34,1],[-98.09,-3.09,1],[69.03,-81.34,1],[-176.88,-8.08,1],[-81.91,3.09,1],[176.88,8.08,1],[81.91,-3.09,1],[3.12,-8.08,1],[98.09,3.09,1],[-3.12,8.08,1],[110.97,81.34,1],[-69.03,81.34,1],[145.76,30.52,1],[46.33,-45.41,1],[-34.24,30.52,1],[-54.51,28.99,1],[133.67,45.41,1],[54.51,-28.99,1],[-133.67,-45.41,1],[125.49,28.99,1],[-46.33,45.41,1],[-125.49,-28.99,1],[-145.76,-30.52,1],[34.24,-30.52,1],[159.58,41.4,1],[68.4,-44.67,1],[-20.42,41.4,1],[-46.75,15.18,1],[111.6,44.67,1],[46.75,-15.18,1],[-111.6,-44.67,1],[133.25,15.18,1],[-68.4,44.67,1],[-133.25,-15.18,1],[-159.58,-41.4,1],[20.42,-41.4,1],[85.43,-37.93,1],[-38.02,3.6,1],[-94.57,-37.93,1],[174.17,51.83,1],[-141.98,-3.6,1],[-174.17,-51.83,1],[141.98,3.6,1],[-5.83,51.83,1],[38.02,-3.6,1],[5.83,-51.83,1],[-85.43,37.93,1],[94.57,37.93,1],[21.18,27.17,1],[54.86,56.05,1],[-158.82,27.17,1],[61.17,18.75,1],[125.14,-56.05,1],[-61.17,-18.75,1],[-125.14,56.05,1],[-118.83,18.75,1],[-54.86,-56.05,1],[118.83,-18.75,1],[-21.18,-27.17,1],[158.82,-27.17,1],[104.66,-9.56,1],[-9.88,-14.45,1],[-75.34,-9.56,1],[-123.65,72.56,1],[-170.12,14.45,1],[123.65,-72.56,1],[170.12,-14.45,1],[56.35,72.56,1],[9.88,14.45,1],[-56.35,-72.56,1],[-104.66,9.56,1],[75.34,9.56,1],[25.94,-16.83,1],[-34.66,59.4,1],[-154.06,-16.83,1],[108.59,24.75,1],[-145.34,-59.41,1],[-108.59,-24.75,1],[145.34,59.41,1],[-71.41,24.75,1],[34.66,-59.41,1],[71.41,-24.75,1],[-25.94,16.83,1],[154.06,16.83,1],[-100.89,26.49,1],[153.1,-9.74,1],[79.11,26.49,1],[-20.77,-61.51,1],[26.9,9.74,1],[20.77,61.51,1],[-26.9,-9.74,1],[159.23,-61.51,1],[-153.1,9.74,1],[-159.23,61.51,1],[100.89,-26.49,1],[-79.11,-26.49,1],[44.31,12.28,1],[17.3,44.36,1],[-135.69,12.28,1],[73.08,43.05,1],[162.7,-44.36,1],[-73.08,-43.05,1],[-162.7,44.36,1],[-106.92,43.05,1],[-17.3,-44.36,1],[106.92,-43.05,1],[-44.31,-12.28,1],[135.69,-12.28,1],[-169.08,-24.53,1],[-112.54,-63.29,1],[10.92,-24.53,1],[-114.93,-9.92,1],[-67.46,63.28,1],[114.93,9.92,1],[67.46,-63.29,1],[65.07,-9.92,1],[112.54,63.29,1],[-65.07,9.92,1],[169.08,24.53,1],[-10.92,24.53,1],[93.2,-57.39,1],[-57.43,-1.73,1],[-86.8,-57.39,1],[-177.95,32.55,1],[-122.57,1.73,1],[177.95,-32.55,1],[122.57,-1.73,1],[2.05,32.55,1],[57.43,1.73,1],[-2.05,-32.55,1],[-93.2,57.39,1],[86.8,57.39,1],[-17.59,3.04,1],[170.04,72.16,1],[162.41,3.04,1],[86.81,-17.56,1],[9.96,-72.16,1],[-86.81,17.56,1],[-9.96,72.16,1],[-93.19,-17.56,1],[-170.04,-72.16,1],[93.19,17.56,1],[17.59,-3.04,1],[-162.41,-3.04,1],[39.38,44.26,1],[56.93,33.61,1],[-140.62,44.26,1],[38.42,27.03,1],[123.07,-33.61,1],[-38.42,-27.03,1],[-123.07,33.61,1],[-141.58,27.03,1],[-56.93,-33.61,1],[141.58,-27.03,1],[-39.38,-44.26,1],[140.62,-44.26,1]],[[165.52,26.52,1],[63.39,-60.04,1],[-14.48,26.52,1],[-62.74,12.93,1],[116.61,60.04,1],[62.74,-12.93,1],[-116.61,-60.04,1],[117.26,12.93,1],[-63.39,60.04,1],[-117.26,-12.93,1],[-165.52,-26.52,1],[14.48,-26.52,1],[-150.22,-21.62,1],[-141.41,-53.79,1],[29.78,-21.62,1],[-114.55,-27.5,1],[-38.59,53.79,1],[114.55,27.5,1],[38.59,-53.79,1],[65.45,-27.5,1],[141.41,53.79,1],[-65.45,27.5,1],[150.22,21.62,1],[-29.78,21.62,1],[-163.47,81.91,1],[92.31,-7.75,1],[16.53,81.91,1],[-7.76,-2.29,1],[87.69,7.75,1],[7.76,2.29,1],[-87.69,-7.75,1],[172.24,-2.29,1],[-92.31,7.75,1],[-172.24,2.29,1],[163.47,-81.91,1],[-16.53,-81.91,1],[-79.91,-73.49,1],[-106.27,2.85,1],[100.09,-73.49,1],[177.03,-16.24,1],[-73.73,-2.85,1],[-177.03,16.24,1],[73.73,2.85,1],[-2.97,-16.24,1],[106.27,-2.85,1],[2.97,16.24,1],[79.91,73.49,1],[-100.09,73.49,1],[-43.19,73.63,1],[101.37,11.86,1],[136.81,73.63,1],[12.09,-11.12,1],[78.63,-11.86,1],[-12.09,11.12,1],[-78.63,11.86,1],[-167.91,-11.12,1],[-101.37,-11.86,1],[167.91,11.12,1],[43.19,-73.63,1],[-136.81,-73.63,1],[109.86,-34.83,1],[-36.5,-16.19,1],[-70.14,-34.83,1],[-153.97,50.53,1],[-143.5,16.19,1],[153.97,-50.53,1],[143.5,-16.19,1],[26.03,50.53,1],[36.5,16.19,1],[-26.03,-50.53,1],[-109.86,34.83,1],[70.14,34.83,1],[-23.31,-6.54,1],[-163.84,65.83,1],[156.69,-6.54,1],[97.12,-23.15,1],[-16.16,-65.83,1],[-97.12,23.15,1],[16.16,65.83,1],[-82.88,-23.15,1],[163.84,-65.83,1],[82.88,23.15,1],[23.31,6.54,1],[-156.69,6.54,1],[-.87,-31.92,1],[-91.4,58.07,1],[179.13,-31.92,1],[121.93,-.74,1],[-88.6,-58.07,1],[-121.93,.74,1],[88.6,58.07,1],[-58.07,-.74,1],[91.4,-58.07,1],[58.07,.74,1],[.87,31.92,1],[-179.13,31.92,1],[163.12,43.35,1],[72.9,-44.1,1],[-16.88,43.35,1],[-45.39,12.19,1],[107.1,44.1,1],[45.39,-12.19,1],[-107.1,-44.1,1],[134.61,12.19,1],[-72.9,44.1,1],[-134.61,-12.19,1],[-163.12,-43.35,1],[16.88,-43.35,1],[-114.23,50.37,1],[127.06,-15.17,1],[65.77,50.37,1],[-18.77,-35.57,1],[52.94,15.17,1],[18.77,35.57,1],[-52.94,-15.17,1],[161.23,-35.57,1],[-127.06,15.17,1],[-161.23,35.57,1],[114.23,-50.37,1],[-65.77,-50.37,1],[54.17,30.16,1],[35.63,30.41,1],[-125.83,30.16,1],[45.21,44.51,1],[144.37,-30.41,1],[-45.21,-44.51,1],[-144.37,30.41,1],[-134.79,44.51,1],[-35.63,-30.41,1],[134.79,-44.51,1],[-54.17,-30.16,1],[125.83,-30.16,1],[126.2,41.73,1],[47.86,-26.15,1],[-53.8,41.73,1],[-33.51,37.03,1],[132.14,26.15,1],[33.51,-37.03,1],[-132.14,-26.15,1],[146.49,37.03,1],[-47.86,26.15,1],[-146.49,-37.03,1],[-126.2,-41.73,1],[53.8,-41.73,1],[-161.75,20.38,1],[130.12,-62.91,1],[18.25,20.38,1],[-68.63,-17.07,1],[49.88,62.91,1],[68.63,17.07,1],[-49.88,-62.91,1],[111.37,-17.07,1],[-130.12,62.91,1],[-111.37,17.07,1],[161.75,-20.38,1],[-18.25,-20.38,1],[2.71,48.49,1],[87.6,41.45,1],[-177.29,48.49,1],[41.48,1.8,1],[92.4,-41.45,1],[-41.48,-1.8,1],[-92.4,41.45,1],[-138.52,1.8,1],[-87.6,-41.45,1],[138.52,-1.8,1],[-2.71,-48.49,1],[177.29,-48.49,1],[-98.15,-27.54,1],[-152.22,-7.22,1],[81.85,-27.54,1],[-164.79,-61.37,1],[-27.78,7.22,1],[164.79,61.37,1],[27.78,-7.22,1],[15.21,-61.37,1],[152.22,7.22,1],[-15.21,61.37,1],[98.15,27.54,1],[-81.85,27.54,1]],[[-40.48,43.36,1],[124.51,33.58,1],[139.52,43.36,1],[38.85,-28.17,1],[55.49,-33.58,1],[-38.85,28.17,1],[-55.49,33.58,1],[-141.15,-28.17,1],[-124.51,-33.58,1],[141.15,28.17,1],[40.48,-43.36,1],[-139.52,-43.36,1],[56.01,17.18,1],[20.46,32.29,1],[-123.99,17.18,1],[61.05,52.38,1],[159.54,-32.29,1],[-61.05,-52.38,1],[-159.54,32.29,1],[-118.95,52.38,1],[-20.46,-32.29,1],[118.95,-52.38,1],[-56.01,-17.18,1],[123.99,-17.18,1],[-179.51,-8.95,1],[-93.08,-81.04,1],[.49,-8.95,1],[-98.95,-.48,1],[-86.92,81.04,1],[98.95,.48,1],[86.92,-81.04,1],[81.05,-.48,1],[93.08,81.04,1],[-81.05,.48,1],[179.51,8.95,1],[-.49,8.95,1],[12.04,-13.56,1],[-49.15,71.95,1],[-167.96,-13.56,1],[103.85,11.7,1],[-130.85,-71.95,1],[-103.85,-11.7,1],[130.85,71.95,1],[-76.15,11.7,1],[49.15,-71.95,1],[76.15,-11.7,1],[-12.04,13.56,1],[167.96,13.56,1],[-13.62,-58.2,1],[-98.3,30.8,1],[166.38,-58.2,1],[148.93,-7.13,1],[-81.7,-30.8,1],[-148.93,7.13,1],[81.7,30.8,1],[-31.07,-7.13,1],[98.3,-30.8,1],[31.07,7.13,1],[13.62,58.2,1],[-166.38,58.2,1],[65.26,-20.55,1],[-22.43,23.07,1],[-114.74,-20.55,1],[131.85,58.26,1],[-157.57,-23.07,1],[-131.85,-58.26,1],[157.57,23.07,1],[-48.15,58.26,1],[22.43,-23.07,1],[48.15,-58.26,1],[-65.26,20.55,1],[114.74,20.55,1],[-135.39,26.5,1],[144.63,-39.58,1],[44.61,26.5,1],[-55,-38.94,1],[35.37,39.58,1],[55,38.94,1],[-35.37,-39.58,1],[125,-38.94,1],[-144.63,39.58,1],[-125,38.94,1],[135.39,-26.5,1],[-44.61,-26.5,1],[114.95,-4.75,1],[-5.23,-24.86,1],[-65.05,-4.75,1],[-101.14,64.63,1],[-174.77,24.86,1],[101.14,-64.63,1],[174.77,-24.86,1],[78.86,64.63,1],[5.23,24.86,1],[-78.86,-64.63,1],[-114.95,4.75,1],[65.05,4.75,1],[35.85,52.64,1],[65.91,29.46,1],[-144.15,52.64,1],[31.75,20.82,1],[114.09,-29.46,1],[-31.75,-20.82,1],[-114.09,29.46,1],[-148.25,20.82,1],[-65.91,-29.46,1],[148.25,-20.82,1],[-35.85,-52.64,1],[144.15,-52.64,1],[86.45,11.52,1],[11.54,3.48,1],[-93.55,11.52,1],[16.9,77.95,1],[168.46,-3.48,1],[-16.9,-77.95,1],[-168.46,3.48,1],[-163.1,77.95,1],[-11.54,-3.48,1],[163.1,-77.95,1],[-86.45,-11.52,1],[93.55,-11.52,1],[135.24,4.02,1],[5.69,-45.1,1],[-44.76,4.02,1],[-84.35,44.62,1],[174.31,45.1,1],[84.35,-44.62,1],[-174.31,-45.1,1],[95.65,44.62,1],[-5.69,45.1,1],[-95.65,-44.62,1],[-135.24,-4.02,1],[44.76,-4.02,1],[-129.84,-18.16,1],[-156.86,-37.5,1],[50.16,-18.16,1],[-117.12,-46.85,1],[-23.14,37.5,1],[117.12,46.85,1],[23.14,-37.5,1],[62.88,-46.85,1],[156.86,37.5,1],[-62.88,46.85,1],[129.84,18.16,1],[-50.16,18.16,1],[-74.1,32.87,1],[146.1,13.3,1],[105.9,32.87,1],[22.97,-53.88,1],[33.9,-13.3,1],[-22.97,53.88,1],[-33.9,13.3,1],[-157.03,-53.88,1],[-146.1,-13.3,1],[157.03,53.88,1],[74.1,-32.87,1],[-105.9,-32.87,1],[-119.92,-5.64,1],[-173.5,-29.76,1],[60.08,-5.64,1],[-101.2,-59.6,1],[-6.5,29.76,1],[101.2,59.6,1],[6.5,-29.76,1],[78.8,-59.6,1],[173.5,29.76,1],[-78.8,59.6,1],[119.92,5.64,1],[-60.08,5.64,1],[73.14,16.13,1],[16.82,16.18,1],[-106.86,16.13,1],[45.09,66.83,1],[163.18,-16.18,1],[-45.09,-66.83,1],[-163.18,16.18,1],[-134.91,66.83,1],[-16.82,-16.18,1],[134.91,-66.83,1],[-73.14,-16.13,1],[106.86,-16.13,1],[-11.7,-43.38,1],[-102.11,45.38,1],[168.3,-43.38,1],[133.98,-8.47,1],[-77.89,-45.38,1],[-133.98,8.47,1],[77.89,45.38,1],[-46.02,-8.47,1],[102.11,-45.38,1],[46.02,8.47,1],[11.7,43.38,1],[-168.3,43.38,1],[-24.11,3.73,1],[170.94,65.63,1],[155.89,3.73,1],[85.92,-24.05,1],[9.06,-65.63,1],[-85.92,24.05,1],[-9.06,65.63,1],[-94.08,-24.05,1],[-170.94,-65.63,1],[94.08,24.05,1],[24.11,-3.73,1],[-155.89,-3.73,1]],[[104.6,-3.68,1],[-3.81,-14.57,1],[-75.4,-3.68,1],[-104.32,74.95,1],[-176.19,14.57,1],[104.32,-74.95,1],[176.19,-14.57,1],[75.68,74.95,1],[3.81,14.57,1],[-75.68,-74.95,1],[-104.6,3.68,1],[75.4,3.68,1],[153.77,-30.33,1],[-52.93,-50.74,1],[-26.23,-30.33,1],[-123.11,22.43,1],[-127.07,50.74,1],[123.11,-22.43,1],[127.07,-50.74,1],[56.89,22.43,1],[52.93,50.74,1],[-56.89,-22.43,1],[-153.77,30.33,1],[26.23,30.33,1],[35.99,-39.77,1],[-54.77,38.45,1],[-144.01,-39.77,1],[135.81,26.85,1],[-125.23,-38.45,1],[-135.81,-26.85,1],[125.23,38.45,1],[-44.19,26.85,1],[54.77,-38.45,1],[44.19,-26.85,1],[-35.99,39.77,1],[144.01,39.77,1],[71.82,-25.43,1],[-26.58,16.37,1],[-108.18,-25.43,1],[146.72,59.1,1],[-153.42,-16.37,1],[-146.72,-59.1,1],[153.42,16.37,1],[-33.28,59.1,1],[26.58,-16.37,1],[33.28,-59.1,1],[-71.82,25.43,1],[108.18,25.43,1],[-136.55,26.52,1],[144.03,-40.51,1],[43.45,26.52,1],[-55.5,-37.97,1],[35.97,40.51,1],[55.5,37.97,1],[-35.97,-40.51,1],[124.5,-37.97,1],[-144.03,40.51,1],[-124.5,37.97,1],[136.55,-26.52,1],[-43.45,-26.52,1],[-6.52,-1.08,1],[-170.58,83.4,1],[173.48,-1.08,1],[91.09,-6.52,1],[-9.42,-83.4,1],[-91.09,6.52,1],[9.42,83.4,1],[-88.91,-6.52,1],[170.58,-83.4,1],[88.91,6.52,1],[6.52,1.08,1],[-173.48,1.08,1],[-71.13,40.38,1],[138.05,14.26,1],[108.87,40.38,1],[20.82,-46.12,1],[41.95,-14.26,1],[-20.82,46.12,1],[-41.95,14.26,1],[-159.18,-46.12,1],[-138.05,-14.26,1],[159.18,46.12,1],[71.13,-40.38,1],[-108.87,-40.38,1],[-153.97,-27.97,1],[-129.57,-52.52,1],[26.03,-27.97,1],[-120.59,-22.81,1],[-50.43,52.52,1],[120.59,22.81,1],[50.43,-52.52,1],[59.41,-22.81,1],[129.57,52.52,1],[-59.41,22.81,1],[153.97,27.97,1],[-26.03,27.97,1],[-80.23,13.48,1],[166.33,9.49,1],[99.77,13.48,1],[35.29,-73.41,1],[13.67,-9.49,1],[-35.29,73.41,1],[-13.67,9.49,1],[-144.71,-73.41,1],[-166.33,-9.49,1],[144.71,73.41,1],[80.23,-13.48,1],[-99.77,-13.48,1],[55.43,-9,1],[-10.89,34.09,1],[-124.57,-9,1],[105.6,54.41,1],[-169.11,-34.09,1],[-105.6,-54.41,1],[169.11,34.09,1],[-74.4,54.41,1],[10.89,-34.09,1],[74.4,-54.41,1],[-55.43,9,1],[124.57,9,1],[68.32,-7.14,1],[-7.68,21.51,1],[-111.68,-7.14,1],[108.74,67.22,1],[-172.32,-21.51,1],[-108.74,-67.22,1],[172.32,21.51,1],[-71.26,67.22,1],[7.68,-21.51,1],[71.26,-67.22,1],[-68.32,7.14,1],[111.68,7.14,1],[-174.97,36.12,1],[96.85,-53.58,1],[5.03,36.12,1],[-53.77,-4.06,1],[83.15,53.58,1],[53.77,4.06,1],[-83.15,-53.58,1],[126.23,-4.06,1],[-96.85,53.58,1],[-126.23,4.06,1],[174.97,-36.12,1],[-5.03,-36.12,1],[-149.91,16.26,1],[149.81,-56.16,1],[30.09,16.26,1],[-71.37,-28.77,1],[30.19,56.16,1],[71.37,28.77,1],[-30.19,-56.16,1],[108.63,-28.77,1],[-149.81,56.16,1],[-108.63,28.77,1],[149.91,-16.26,1],[-30.09,-16.26,1],[2.52,-51.45,1],[-87.99,38.5,1],[-177.48,-51.45,1],[141.48,1.57,1],[-92.01,-38.5,1],[-141.48,-1.57,1],[92.01,38.5,1],[-38.52,1.57,1],[87.99,-38.5,1],[38.52,-1.57,1],[-2.52,51.45,1],[177.48,51.45,1],[161.12,-9.98,1],[-28.54,-68.73,1],[-18.88,-9.98,1],[-100.54,18.59,1],[-151.46,68.73,1],[100.54,-18.59,1],[151.46,-68.73,1],[79.46,18.59,1],[28.54,68.73,1],[-79.46,-18.59,1],[-161.12,9.98,1],[18.88,9.98,1],[12.84,24.97,1],[64.49,62.11,1],[-167.16,24.97,1],[64.47,11.62,1],[115.51,-62.11,1],[-64.47,-11.62,1],[-115.51,62.11,1],[-115.53,11.62,1],[-64.49,-62.11,1],[115.53,-11.62,1],[-12.84,-24.97,1],[167.16,-24.97,1],[74.13,41.65,1],[42.76,11.79,1],[-105.87,41.65,1],[17.09,45.95,1],[137.24,-11.79,1],[-17.09,-45.95,1],[-137.24,11.79,1],[-162.91,45.95,1],[-42.76,-11.79,1],[162.91,-45.95,1],[-74.13,-41.65,1],[105.87,-41.65,1],[154.04,1.27,1],[2.9,-64.01,1],[-25.96,1.27,1],[-88.59,25.96,1],[177.1,64.01,1],[88.59,-25.96,1],[-177.1,-64.01,1],[91.41,25.96,1],[-2.9,64.01,1],[-91.41,-25.96,1],[-154.04,-1.27,1],[25.96,-1.27,1]],[[24.8,-10.46,1],[-23.76,63.21,1],[-155.2,-10.46,1],[101.5,24.36,1],[-156.24,-63.21,1],[-101.5,-24.36,1],[156.24,63.21,1],[-78.5,24.36,1],[23.76,-63.21,1],[78.5,-24.36,1],[-24.8,10.46,1],[155.2,10.46,1],[-134.64,65.44,1],[108.01,-16.98,1],[45.36,65.44,1],[-17.8,-17.2,1],[71.99,16.98,1],[17.8,17.2,1],[-71.99,-16.98,1],[162.2,-17.2,1],[-108.01,16.98,1],[-162.2,17.2,1],[134.64,-65.44,1],[-45.36,-65.44,1],[177.6,54.85,1],[88.31,-35.12,1],[-2.4,54.85,1],[-35.13,1.38,1],[91.69,35.12,1],[35.13,-1.38,1],[-91.69,-35.12,1],[144.87,1.38,1],[-88.31,35.12,1],[-144.87,-1.38,1],[-177.6,-54.85,1],[2.4,-54.85,1],[157.93,82.01,1],[86.98,-7.4,1],[-22.07,82.01,1],[-7.41,2.99,1],[93.02,7.4,1],[7.41,-2.99,1],[-93.02,-7.4,1],[172.59,2.99,1],[-86.98,7.4,1],[-172.59,-2.99,1],[-157.93,-82.01,1],[22.07,-82.01,1],[42.48,-13.21,1],[-19.17,45.89,1],[-137.52,-13.21,1],[107.66,41.11,1],[-160.83,-45.89,1],[-107.66,-41.11,1],[160.83,45.89,1],[-72.34,41.11,1],[19.17,-45.89,1],[72.34,-41.11,1],[-42.48,13.21,1],[137.52,13.21,1],[28.48,10.9,1],[21.99,59.68,1],[-151.52,10.9,1],[77.65,27.92,1],[158.01,-59.68,1],[-77.65,-27.92,1],[-158.01,59.68,1],[-102.35,27.92,1],[-21.99,-59.68,1],[102.35,-27.92,1],[-28.48,-10.9,1],[151.52,-10.9,1],[-33.79,21.61,1],[144.53,50.59,1],[146.21,21.61,1],[64.51,-31.14,1],[35.47,-50.59,1],[-64.51,31.14,1],[-35.47,50.59,1],[-115.49,-31.14,1],[-144.53,-50.59,1],[115.49,31.14,1],[33.79,-21.61,1],[-146.21,-21.61,1],[-175.53,-31.74,1],[-97.19,-57.98,1],[4.47,-31.74,1],[-121.82,-3.8,1],[-82.81,57.98,1],[121.82,3.8,1],[82.81,-57.98,1],[58.18,-3.8,1],[97.19,57.98,1],[-58.18,3.8,1],[175.53,31.74,1],[-4.47,31.74,1],[89.4,19.43,1],[19.43,.56,1],[-90.6,19.43,1],[1.69,70.56,1],[160.57,-.56,1],[-1.69,-70.56,1],[-160.57,.56,1],[-178.31,70.56,1],[-19.43,-.56,1],[178.31,-70.56,1],[-89.4,-19.43,1],[90.6,-19.43,1],[-27.28,-27.88,1],[-130.91,51.78,1],[152.72,-27.88,1],[120.76,-23.9,1],[-49.09,-51.78,1],[-120.76,23.9,1],[49.09,51.78,1],[-59.24,-23.9,1],[130.91,-51.78,1],[59.24,23.9,1],[27.28,27.88,1],[-152.72,27.88,1],[139.9,-15.44,1],[-23.21,-47.5,1],[-40.1,-15.44,1],[-109.85,38.38,1],[-156.79,47.5,1],[109.85,-38.38,1],[156.79,-47.5,1],[70.15,38.38,1],[23.21,47.5,1],[-70.15,-38.38,1],[-139.9,15.44,1],[40.1,15.44,1],[-2.17,-43.33,1],[-92.29,46.62,1],[177.83,-43.33,1],[133.35,-1.58,1],[-87.71,-46.62,1],[-133.35,1.58,1],[87.71,46.62,1],[-46.65,-1.58,1],[92.29,-46.62,1],[46.65,1.58,1],[2.17,43.33,1],[-177.83,43.33,1],[41.12,27.96,1],[38.91,41.71,1],[-138.88,27.96,1],[54.83,35.51,1],[141.09,-41.71,1],[-54.83,-35.51,1],[-141.09,41.71,1],[-125.17,35.51,1],[-38.91,-41.71,1],[125.17,-35.51,1],[-41.12,-27.96,1],[138.88,-27.96,1],[-126.67,13.75,1],[163.04,-35.46,1],[53.33,13.75,1],[-67.73,-51.18,1],[16.96,35.46,1],[67.73,51.18,1],[-16.96,-35.46,1],[112.27,-51.18,1],[-163.04,35.46,1],[-112.27,51.18,1],[126.67,-13.75,1],[-53.33,-13.75,1],[6.02,-15.42,1],[-69.18,73.47,1],[-173.98,-15.42,1],[105.51,5.8,1],[-110.82,-73.47,1],[-105.51,-5.8,1],[110.82,73.47,1],[-74.49,5.8,1],[69.18,-73.47,1],[74.49,-5.8,1],[-6.02,15.42,1],[173.98,15.42,1],[160.08,33.45,1],[62.71,-51.67,1],[-19.92,33.45,1],[-54.9,16.52,1],[117.29,51.67,1],[54.9,-16.52,1],[-117.29,-51.67,1],[125.1,16.52,1],[-62.71,51.67,1],[-125.1,-16.52,1],[-160.08,-33.45,1],[19.92,-33.45,1],[80.34,6.51,1],[6.61,9.59,1],[-99.66,6.51,1],[55.76,78.37,1],[173.39,-9.59,1],[-55.76,-78.37,1],[-173.39,9.59,1],[-124.24,78.37,1],[-6.61,-9.59,1],[124.24,-78.37,1],[-80.34,-6.51,1],[99.66,-6.51,1],[6.25,24.64,1],[76.64,64.63,1],[-173.75,24.64,1],[65.23,5.68,1],[103.36,-64.63,1],[-65.23,-5.68,1],[-103.36,64.63,1],[-114.77,5.68,1],[-76.64,-64.63,1],[114.77,-5.68,1],[-6.25,-24.64,1],[173.75,-24.64,1],[51.41,-63.45,1],[-68.67,16.19,1],[-128.59,-63.45,1],[162.69,20.45,1],[-111.33,-16.19,1],[-162.69,-20.45,1],[111.33,16.19,1],[-17.31,20.45,1],[68.67,-16.19,1],[17.31,-20.45,1],[-51.41,63.45,1],[128.59,63.45,1],[-50.6,28.85,1],[144.51,33.77,1],[129.4,28.85,1],[49.04,-42.6,1],[35.49,-33.77,1],[-49.04,42.6,1],[-35.49,33.77,1],[-130.96,-42.6,1],[-144.51,-33.77,1],[130.96,42.6,1],[50.6,-28.85,1],[-129.4,-28.85,1]]],n=t[p-1];return n}module.exports.getAmbisonicDecMtx=getAmbisonicDecMtx,module.exports.getTdesign=getTdesign,module.exports.deg2rad=deg2rad,module.exports.rad2deg=rad2deg,module.exports.createNearestLookup=createNearestLookup,module.exports.findNearest=findNearest;const _utils=Object.freeze(Object.defineProperty({__proto__:null,createNearestLookup,deg2rad,findNearest,getAmbisonicDecMtx,getCircHarmonics,getColumn,getTdesign,numeric,rad2deg,sampleCircle},Symbol.toStringTag,{value:"Module"}));function computeEncodingCoefficients(p,t,n){const r=getAmbisonicChannelCount(n),i=degreesToRadians(p),a=degreesToRadians(t),e=computeRealSH_1(n,[[i,a]]),c=new Float32Array(r);for(let o=0;o<r;o++)c[o]=e[o][0];return c}function computeEncodingCoefficients2D(p,t){const n=getAmbisonicChannelCount2D(t),r=getCircHarmonics(t,[p]),i=new Float32Array(n);for(let a=0;a<n;a++)i[a]=r[a][0];return i}function encodeBuffer(p,t,n,r){const i=getAmbisonicChannelCount(r),a=p.length,e=computeEncodingCoefficients(t,n,r),c=new Array(i);for(let o=0;o<i;o++){c[o]=new Float32Array(a);const f=e[o];for(let h=0;h<a;h++)c[o][h]=p[h]*f}return c}function encodeBuffer2D(p,t,n){const r=getAmbisonicChannelCount2D(n),i=p.length,a=computeEncodingCoefficients2D(t,n),e=new Array(r);for(let c=0;c<r;c++){e[c]=new Float32Array(i);const o=a[c];for(let f=0;f<i;f++)e[c][f]=p[f]*o}return e}function encodeBufferFromDirection(p,t,n,r,i,a="ambisonics"){let e=t,c=n,o=r;a==="threejs"&&(e=r,c=-t,o=n);const[[f,h]]=convertCart2Sph_1([[e,c,o]],1),u=f*180/Math.PI,M=h*180/Math.PI;return encodeBuffer(p,u,M,i)}function encodeBuffer2DFromDirection(p,t,n,r,i,a="ambisonics"){let e=t,c=n;a==="threejs"&&(e=r,c=-t);const o=Math.atan2(c,e)*180/Math.PI;return encodeBuffer2D(p,o,i)}function encodeAndSumBuffers(p,t){if(p.length===0){const a=getAmbisonicChannelCount(t);return Array.from({length:a},()=>new Float32Array(0))}const n=Math.max(...p.map(a=>a.samples.length)),r=getAmbisonicChannelCount(t),i=Array.from({length:r},()=>new Float32Array(n));for(const a of p){const e=encodeBuffer(a.samples,a.azim,a.elev,t);for(let c=0;c<r;c++)for(let o=0;o<a.samples.length;o++)i[c][o]+=e[c][o]}return i}class monoEncoder{constructor(t,n){this.initialized=!1,this.ctx=t,this.order=n,this.nCh=getAmbisonicChannelCount(n),this.azim=0,this.elev=0,this.gains=new Array(this.nCh),this.gainNodes=new Array(this.nCh),this.in=this.ctx.createGain(),this.in.channelCountMode="explicit",this.in.channelCount=1,this.out=this.ctx.createChannelMerger(this.nCh);for(let r=0;r<this.nCh;r++)this.gainNodes[r]=this.ctx.createGain(),this.gainNodes[r].channelCountMode="explicit",this.gainNodes[r].channelCount=1;this.updateGains();for(let r=0;r<this.nCh;r++)this.in.connect(this.gainNodes[r]),this.gainNodes[r].connect(this.out,0,r);this.initialized=!0}updateGains(){const t=computeRealSH_1(this.order,[[degreesToRadians(this.azim),degreesToRadians(this.elev)]]);for(let n=0;n<this.nCh;n++)this.gains[n]=t[n][0],this.gainNodes[n].gain.value=this.gains[n]}setDirection(t,n,r,i="ambisonics"){let a=t,e=n,c=r;i==="threejs"&&(a=r,e=-t,c=n);const[[o,f]]=convertCart2Sph_1([[a,e,c]],1);this.azim=radiansToDegrees(o),this.elev=radiansToDegrees(f),this.updateGains()}getDirection(t="ambisonics"){const n=degreesToRadians(this.azim),r=degreesToRadians(this.elev),i=Math.cos(r),a=i*Math.cos(n),e=i*Math.sin(n),c=Math.sin(r);return t==="threejs"?[-e,c,a]:[a,e,c]}}class monoEncoder2D{constructor(t,n){this.initialized=!1,this.ctx=t,this.order=n,this.nCh=getAmbisonicChannelCount2D(n),this.azim=0,this.elev=0,this.gainNodes=new Array(this.nCh),this.in=this.ctx.createGain(),this.in.channelCountMode="explicit",this.in.channelCount=1,this.out=this.ctx.createChannelMerger(this.nCh);for(let r=0;r<this.nCh;r++)this.gainNodes[r]=this.ctx.createGain(),this.gainNodes[r].channelCountMode="explicit",this.gainNodes[r].channelCount=1;this.updateGains();for(let r=0;r<this.nCh;r++)this.in.connect(this.gainNodes[r]),this.gainNodes[r].connect(this.out,0,r);this.initialized=!0}updateGains(){const t=getCircHarmonics(this.order,[this.azim]);for(let n=0;n<this.nCh;n++)this.gainNodes[n].gain.value=t[n][0]}setDirection(t,n,r,i="ambisonics"){let a=t,e=n;i==="threejs"&&(a=r,e=-t),this.azim=radiansToDegrees(Math.atan2(e,a)),this.elev=0,this.updateGains()}getDirection(t="ambisonics"){const n=degreesToRadians(this.azim),r=Math.cos(n),i=Math.sin(n);return t==="threejs"?[-i,0,r]:[r,i,0]}}class orderLimiter{get order(){return this.orderOut}get nCh(){return this.nChOut}constructor(t,n,r){this.ctx=t,this.orderIn=n,this.orderOut=r<n?r:n,this.nChIn=getAmbisonicChannelCount(this.orderIn),this.nChOut=getAmbisonicChannelCount(this.orderOut),this.in=this.ctx.createChannelSplitter(this.nChIn),this.out=this.ctx.createChannelMerger(this.nChOut);for(let i=0;i<this.nChOut;i++)this.in.connect(this.out,i,i)}updateOrder(t){if(!(t>this.orderIn)){this.orderOut=t,this.nChOut=getAmbisonicChannelCount(this.orderOut),this.out.disconnect(),this.out=this.ctx.createChannelMerger(this.nChOut);for(let n=0;n<this.nChOut;n++)this.in.connect(this.out,n,n)}}}class orderLimiter2D{get order(){return this.orderOut}get nCh(){return this.nChOut}constructor(t,n,r){this.ctx=t,this.orderIn=n,this.orderOut=r<n?r:n,this.nChIn=getAmbisonicChannelCount2D(this.orderIn),this.nChOut=getAmbisonicChannelCount2D(this.orderOut),this.in=this.ctx.createChannelSplitter(this.nChIn),this.out=this.ctx.createChannelMerger(this.nChOut);for(let i=0;i<this.nChOut;i++)this.in.connect(this.out,i,i)}updateOrder(t){if(!(t>this.orderIn)){this.orderOut=t,this.nChOut=getAmbisonicChannelCount2D(this.orderOut),this.out.disconnect(),this.out=this.ctx.createChannelMerger(this.nChOut);for(let n=0;n<this.nChOut;n++)this.in.connect(this.out,n,n)}}}class orderWeight{constructor(t,n){this.ctx=t,this.order=n,this.nCh=getAmbisonicChannelCount(this.order),this.in=this.ctx.createChannelSplitter(this.nCh),this.out=this.ctx.createChannelMerger(this.nCh),this.gains=new Array(this.nCh),this.orderGains=new Array(this.order+1),this.orderGains.fill(1);for(let r=0;r<this.nCh;r++)this.gains[r]=this.ctx.createGain(),this.in.connect(this.gains[r],r,0),this.gains[r].connect(this.out,0,r)}updateOrderGains(){for(let t=0;t<this.nCh;t++){const n=Math.floor(Math.sqrt(t));this.gains[t].gain.value=this.orderGains[n]}}computeMaxRECoeffs(){const t=this.order;this.orderGains[0]=1;let n=0,r=0;for(let i=1;i<=t;i++){const a=recurseLegendrePoly_1(i,[Math.cos(2.406809/(t+1.51))],n,r);this.orderGains[i]=a[0][0],r=n,n=a}}}class sceneRotator{constructor(t,n){this.ctx=t,this.order=n,this.nCh=getAmbisonicChannelCount(n),this.yaw=0,this.pitch=0,this.roll=0,this.rotMtx=numeric.identity(this.nCh),this.rotMtxNodes=new Array(this.order),this.in=this.ctx.createChannelSplitter(this.nCh),this.out=this.ctx.createChannelMerger(this.nCh);for(let i=1;i<=this.order;i++){const a=new Array(2*i+1);for(let e=0;e<2*i+1;e++){a[e]=new Array(2*i+1);for(let c=0;c<2*i+1;c++)a[e][c]=this.ctx.createGain(),a[e][c].gain.value=e===c?1:0}this.rotMtxNodes[i-1]=a}this.in.connect(this.out,0,0);let r=1;for(let i=1;i<=this.order;i++){for(let a=0;a<2*i+1;a++)for(let e=0;e<2*i+1;e++)this.in.connect(this.rotMtxNodes[i-1][a][e],r+e,0),this.rotMtxNodes[i-1][a][e].connect(this.out,0,r+a);r=r+2*i+1}}updateRotMtx(){const t=degreesToRadians(this.yaw),n=degreesToRadians(this.pitch),r=degreesToRadians(this.roll);this.rotMtx=getSHrotMtx_1(yawPitchRoll2Rzyx_1(t,n,r),this.order);let i=1;for(let a=1;a<this.order+1;a++){for(let e=0;e<2*a+1;e++)for(let c=0;c<2*a+1;c++)this.rotMtxNodes[a-1][e][c].gain.value=this.rotMtx[i+e][i+c];i=i+2*a+1}}}class sceneRotator2D{constructor(t,n){this.ctx=t,this.order=n,this.nCh=getAmbisonicChannelCount2D(n),this.yaw=0,this.in=this.ctx.createChannelSplitter(this.nCh),this.out=this.ctx.createChannelMerger(this.nCh),this.rotMtxNodes=new Array(2*this.order),this.in.connect(this.out,0,0);for(let r=0;r<2*this.order;r=r+2){const i=[this.ctx.createGain(),this.ctx.createGain()],a=[this.ctx.createGain(),this.ctx.createGain()];this.rotMtxNodes[r]=i,this.rotMtxNodes[r+1]=a,this.in.connect(this.rotMtxNodes[r][0],r+1,0),this.rotMtxNodes[r][0].connect(this.out,0,r+1),this.in.connect(this.rotMtxNodes[r][1],r+2,0),this.rotMtxNodes[r][1].connect(this.out,0,r+1),this.in.connect(this.rotMtxNodes[r+1][0],r+1,0),this.rotMtxNodes[r+1][0].connect(this.out,0,r+2),this.in.connect(this.rotMtxNodes[r+1][1],r+2,0),this.rotMtxNodes[r+1][1].connect(this.out,0,r+2)}this.updateRotMtx()}updateRotMtx(){const t=degreesToRadians(this.yaw);let n=1;for(let r=0;r<2*this.order;r=r+2)this.rotMtxNodes[r][0].gain.value=Math.cos(n*t),this.rotMtxNodes[r][1].gain.value=Math.sin(n*t),this.rotMtxNodes[r+1][0].gain.value=-Math.sin(n*t),this.rotMtxNodes[r+1][1].gain.value=Math.cos(n*t),n++}}class sceneMirror{constructor(t,n){this.ctx=t,this.order=n,this.nCh=getAmbisonicChannelCount(n),this.mirrorPlane=0,this.in=this.ctx.createChannelSplitter(this.nCh),this.out=this.ctx.createChannelMerger(this.nCh),this.gains=new Array(this.nCh);for(let r=0;r<this.nCh;r++)this.gains[r]=this.ctx.createGain(),this.gains[r].gain.value=1,this.in.connect(this.gains[r],r,0),this.gains[r].connect(this.out,0,r)}reset(){for(let t=0;t<this.nCh;t++)this.gains[t].gain.value=1}mirror(t){switch(t){case 0:this.mirrorPlane=0,this.reset();break;case 1:this.reset(),this.mirrorPlane=1;for(let n=0;n<=this.order;n++)for(let r=-n;r<=n;r++){const i=n*n+n+r;(r<0&&r%2===0||r>0&&r%2===1)&&(this.gains[i].gain.value=-1)}break;case 2:this.reset(),this.mirrorPlane=2;for(let n=0;n<=this.order;n++)for(let r=-n;r<=n;r++){const i=n*n+n+r;r<0&&(this.gains[i].gain.value=-1)}break;case 3:this.reset(),this.mirrorPlane=3;for(let n=0;n<=this.order;n++)for(let r=-n;r<=n;r++){const i=n*n+n+r;(r+n)%2===1&&(this.gains[i].gain.value=-1)}break;default:console.log("The mirroring planes can be either 1 (yz), 2 (xz), 3 (xy), or 0 (no mirroring). Value set to 0."),this.mirrorPlane=0,this.reset()}}}class sceneMirror2D{constructor(t,n){this.ctx=t,this.order=n,this.nCh=getAmbisonicChannelCount2D(n),this.mirrorPlane=0,this.in=this.ctx.createChannelSplitter(this.nCh),this.out=this.ctx.createChannelMerger(this.nCh),this.gains=new Array(this.nCh);for(let r=0;r<this.nCh;r++)this.gains[r]=this.ctx.createGain(),this.gains[r].gain.value=1,this.in.connect(this.gains[r],r,0),this.gains[r].connect(this.out,0,r)}reset(){for(let t=0;t<this.nCh;t++)this.gains[t].gain.value=1}mirror(t){switch(t){case 0:this.mirrorPlane=0,this.reset();break;case 1:this.reset(),this.mirrorPlane=1;for(let n=2;n<this.nCh;n++)this.gains[n].gain.value=-1,n%2!==0&&(n=n+2);break;case 2:this.reset(),this.mirrorPlane=2;for(let n=0;n<this.nCh;n++)n%2!==0&&(this.gains[n].gain.value=-1);break;case 3:console.log("up-down mirroring in 2D mode not possible");break;default:console.log("The mirroring planes can be either 1 (yz), 2 (xz) or 0 (no mirroring). Value set to 0."),this.mirrorPlane=0,this.reset()}}}class binDecoder{constructor(t,n){this.initialized=!1,this.ctx=t,this.order=n,this.nCh=getAmbisonicChannelCount(n),this.decFilters=new Array(this.nCh),this.decFilterNodes=new Array(this.nCh),this.in=this.ctx.createChannelSplitter(this.nCh),this.out=this.ctx.createChannelMerger(2),this.out.channelCountMode="explicit",this.out.channelCount=1,this.gainMid=this.ctx.createGain(),this.gainSide=this.ctx.createGain(),this.invertSide=this.ctx.createGain(),this.gainMid.gain.value=1,this.gainSide.gain.value=1,this.invertSide.gain.value=-1;for(let r=0;r<this.nCh;r++)this.decFilterNodes[r]=this.ctx.createConvolver(),this.decFilterNodes[r].normalize=!1;this.resetFilters();for(let r=0;r<this.nCh;r++){this.in.connect(this.decFilterNodes[r],r,0);const i=Math.floor(Math.sqrt(r));r-i*i-i>=0?this.decFilterNodes[r].connect(this.gainMid):this.decFilterNodes[r].connect(this.gainSide)}this.gainMid.connect(this.out,0,0),this.gainSide.connect(this.out,0,0),this.gainMid.connect(this.out,0,1),this.gainSide.connect(this.invertSide,0,0),this.invertSide.connect(this.out,0,1),this.initialized=!0}updateFilters(t){for(let n=0;n<this.nCh;n++)this.decFilters[n]=this.ctx.createBuffer(1,t.length,t.sampleRate),this.decFilters[n].getChannelData(0).set(t.getChannelData(n)),this.decFilterNodes[n].buffer=this.decFilters[n]}resetFilters(){const t=new Array(this.nCh);t.fill(0),t[0]=.5,t[1]=.5/Math.sqrt(3);for(let n=0;n<this.nCh;n++){this.decFilters[n]=this.ctx.createBuffer(1,64,this.ctx.sampleRate);for(let r=0;r<64;r++)this.decFilters[n].getChannelData(0)[r]=0;this.decFilters[n].getChannelData(0)[0]=t[n],this.decFilterNodes[n].buffer=this.decFilters[n]}}}class binDecoder2D{constructor(t,n){this.initialized=!1,this.ctx=t,this.order=n,this.nCh=getAmbisonicChannelCount2D(n),this.decFilters=new Array(this.nCh),this.decFilterNodes=new Array(this.nCh),this.in=this.ctx.createChannelSplitter(this.nCh),this.out=this.ctx.createChannelMerger(2),this.out.channelCountMode="explicit",this.out.channelCount=1,this.gainMid=this.ctx.createGain(),this.gainSide=this.ctx.createGain(),this.invertSide=this.ctx.createGain(),this.gainMid.gain.value=1,this.gainSide.gain.value=1,this.invertSide.gain.value=-1;for(let r=0;r<this.nCh;r++)this.decFilterNodes[r]=this.ctx.createConvolver(),this.decFilterNodes[r].normalize=!1;this.resetFilters();for(let r=0;r<this.nCh;r++)this.in.connect(this.decFilterNodes[r],r,0),r%2===0?this.decFilterNodes[r].connect(this.gainMid):this.decFilterNodes[r].connect(this.gainSide);this.gainMid.connect(this.out,0,0),this.gainSide.connect(this.out,0,0),this.gainMid.connect(this.out,0,1),this.gainSide.connect(this.invertSide,0,0),this.invertSide.connect(this.out,0,1),this.initialized=!0}updateFilters(t){for(let n=0;n<this.nCh;n++)this.decFilters[n]=this.ctx.createBuffer(1,t.length,t.sampleRate),this.decFilters[n].getChannelData(0).set(t.getChannelData(n)),this.decFilterNodes[n].buffer=this.decFilters[n]}resetFilters(){const t=new Array(this.nCh);t.fill(0),t[0]=.5,t[1]=.5/Math.sqrt(3);for(let n=0;n<this.nCh;n++){this.decFilters[n]=this.ctx.createBuffer(1,64,this.ctx.sampleRate);for(let r=0;r<64;r++)this.decFilters[n].getChannelData(0)[r]=0;this.decFilters[n].getChannelData(0)[0]=t[n],this.decFilterNodes[n].buffer=this.decFilters[n]}}}class decoder{constructor(t,n){this.ctx=t,this.order=n,this.nCh=getAmbisonicChannelCount(n),this.nSpk=0,this._decodingMatrix=[],this._spkSphPosArray=[],this.in=this.ctx.createChannelSplitter(this.nCh),this.out=this.ctx.createChannelMerger(1),this._spkSphPosArray=this._getDefaultSpkConfig(this.order),this._updateDecodeMtx(this._spkSphPosArray)}set speakerPos(t){t===void 0&&(t=this._getDefaultSpkConfig(this.order)),this._spkSphPosArray=t,this.out.disconnect(),this._updateDecodeMtx(t)}get speakerPos(){return this._spkSphPosArray}_updateDecodeMtx(t){this.nSpk=t.length,this.out=this.ctx.createChannelMerger(this.nSpk),this._decodingMatrix=getAmbisonicDecMtx(t,this.order),this.mtxGain=new Array(this.nCh);for(let n=0;n<this.nCh;n++){this.mtxGain[n]=new Array(this.nSpk);for(let r=0;r<this.nSpk;r++){const i=this.ctx.createGain();i.gain.value=this._decodingMatrix[r][n],this.in.connect(i,n,0),i.connect(this.out,0,r),this.mtxGain[n][r]=i}}}_getDefaultSpkConfig(t){let n=[];switch(t){case 1:n=[[0,0,1],[90,0,1],[180,0,1],[270,0,1],[0,90,1],[0,-90,1]];break;case 2:n=[[180,-31.7161,.5878],[180,31.7161,.5878],[-121.7161,0,.5878],[121.7161,0,.5878],[-90,-58.2839,.5878],[-90,58.2839,.5878],[90,-58.2839,.5878],[90,58.2839,.5878],[-58.2839,0,.5878],[58.2839,0,.5878],[0,-31.7161,.5878],[0,31.7161,.5878]];break;case 3:n=[[-159.0931,0,.5352],[159.0931,0,.5352],[-135,-35.2644,.5352],[-135,35.2644,.5352],[135,-35.2644,.5352],[135,35.2644,.5352],[180,-69.0931,.5352],[180,69.0931,.5352],[-90,-20.9069,.5352],[-90,20.9069,.5352],[90,-20.9069,.5352],[90,20.9069,.5352],[0,-69.0931,.5352],[0,69.0931,.5352],[-45,-35.2644,.5352],[-45,35.2644,.5352],[45,-35.2644,.5352],[45,35.2644,.5352],[-20.9069,0,.5352],[20.9069,0,.5352]];break;default:console.error("unsupported default order:",t)}return n}}class convolver{constructor(t,n){this.initialized=!1,this.ctx=t,this.order=n,this.nCh=getAmbisonicChannelCount(n),this.encFilters=new Array(this.nCh),this.encFilterNodes=new Array(this.nCh),this.in=this.ctx.createGain(),this.in.channelCountMode="explicit",this.in.channelCount=1,this.out=this.ctx.createChannelMerger(this.nCh);for(let r=0;r<this.nCh;r++)this.encFilterNodes[r]=this.ctx.createConvolver(),this.encFilterNodes[r].normalize=!1;for(let r=0;r<this.nCh;r++)this.in.connect(this.encFilterNodes[r]),this.encFilterNodes[r].connect(this.out,0,r);this.initialized=!0}updateFilters(t){for(let n=0;n<this.nCh;n++)this.encFilters[n]=this.ctx.createBuffer(1,t.length,t.sampleRate),this.encFilters[n].getChannelData(0).set(t.getChannelData(n)),this.encFilterNodes[n].buffer=this.encFilters[n]}}class virtualMic{constructor(t,n){this.initialized=!1,this.ctx=t,this.order=n,this.nCh=getAmbisonicChannelCount(n),this.azim=0,this.elev=0,this.vmicGains=new Array(this.nCh),this.vmicGainNodes=new Array(this.nCh),this.vmicCoeffs=new Array(this.order+1),this.vmicPattern="hypercardioid",this.in=this.ctx.createChannelSplitter(this.nCh),this.out=this.ctx.createGain();for(let r=0;r<this.nCh;r++)this.vmicGainNodes[r]=this.ctx.createGain();this.SHxyz=new Array(this.nCh),this.SHxyz.fill(0),this.updatePattern(),this.updateOrientation();for(let r=0;r<this.nCh;r++)this.in.connect(this.vmicGainNodes[r],r,0),this.vmicGainNodes[r].connect(this.out);this.initialized=!0}updatePattern(){switch(this.vmicPattern){case"cardioid":this.vmicCoeffs=this.computeCardioidCoeffs(this.order);break;case"supercardioid":this.vmicCoeffs=this.computeSupercardCoeffs(this.order);break;case"hypercardioid":this.vmicCoeffs=this.computeHypercardCoeffs(this.order);break;case"max_rE":this.vmicCoeffs=this.computeMaxRECoeffs(this.order);break;default:this.vmicPattern="hypercardioid",this.vmicCoeffs=this.computeHypercardCoeffs(this.order)}this.updateGains()}updateOrientation(){const t=degreesToRadians(this.azim),n=degreesToRadians(this.elev),r=computeRealSH_1(this.order,[[t,n]]);for(let i=0;i<this.nCh;i++)this.SHxyz[i]=r[i][0];this.updateGains()}updateGains(){for(let t=0;t<=this.order;t++)for(let n=-t;n<=t;n++){const r=t*t+t+n;this.vmicGains[r]=this.vmicCoeffs[t]*this.SHxyz[r]}for(let t=0;t<this.nCh;t++)this.vmicGainNodes[t].gain.value=this.vmicGains[t]}computeCardioidCoeffs(t){const n=new Array(t+1);for(let r=0;r<=t;r++)n[r]=factorial_1(t)*factorial_1(t)/(factorial_1(t+r+1)*factorial_1(t-r));return n}computeHypercardCoeffs(t){const n=new Array(t+1),r=(t+1)*(t+1);for(let i=0;i<=t;i++)n[i]=1/r;return n}computeSupercardCoeffs(t){switch(t){case 1:return[.366,.2113];case 2:return[.2362,.1562,.059];case 3:return[.1768,.1281,.0633,.0175];case 4:return[.1414,.1087,.0623,.0247,.0054];default:return console.error("Orders should be in the range of 1-4 at the moment."),[]}}computeMaxRECoeffs(t){const n=new Array(t+1);n[0]=1;let r=0,i=0;for(let e=1;e<t+1;e++){const c=recurseLegendrePoly_1(e,[Math.cos(2.406809/(t+1.51))],r,i);n[e]=c[0][0],i=r,r=c}let a=0;for(let e=0;e<=t;e++)a+=n[e]*(2*e+1);for(let e=0;e<=t;e++)n[e]=n[e]/a;return n}}if(commonjsGlobal.AnalyserNode&&!commonjsGlobal.AnalyserNode.prototype.getFloatTimeDomainData){var uint8=new Uint8Array(2048);commonjsGlobal.AnalyserNode.prototype.getFloatTimeDomainData=function(p){this.getByteTimeDomainData(uint8);for(var t=0,n=p.length;t<n;t++)p[t]=(uint8[t]-128)*.0078125}}class rmsAnalyser{constructor(t,n){this.ctx=t,this.order=n,this.nCh=getAmbisonicChannelCount(n),this.fftSize=2048,this.in=this.ctx.createChannelSplitter(this.nCh),this.out=this.ctx.createChannelMerger(this.nCh),this.analysers=new Array(this.nCh),this.analBuffers=new Array(this.nCh);for(let r=0;r<this.nCh;r++)this.analysers[r]=this.ctx.createAnalyser(),this.analysers[r].fftSize=this.fftSize,this.analysers[r].smoothingTimeConstant=0,this.analBuffers[r]=new Float32Array(this.fftSize),this.in.connect(this.analysers[r],r,0),this.analysers[r].connect(this.out,0,r)}updateBuffers(){for(let t=0;t<this.nCh;t++)this.analysers[t].getFloatTimeDomainData(this.analBuffers[t])}computeRMS(){const t=new Array(this.nCh);t.fill(0);for(let n=0;n<this.nCh;n++){for(let r=0;r<this.fftSize;r++)t[n]=t[n]+this.analBuffers[n][r]*this.analBuffers[n][r];t[n]=Math.sqrt(t[n]/this.fftSize)}return t}}class powermapAnalyser{constructor(t,n,r){this.ctx=t,this.order=n,this.nCh=getAmbisonicChannelCount(n),this.fftSize=2048,this.analysers=new Array(this.nCh),this.analBuffers=new Array(this.nCh),this.in=this.ctx.createChannelSplitter(this.nCh),this.out=this.ctx.createChannelMerger(this.nCh);for(let a=0;a<this.nCh;a++)this.analysers[a]=this.ctx.createAnalyser(),this.analysers[a].fftSize=this.fftSize,this.analysers[a].smoothingTimeConstant=0,this.analBuffers[a]=new Float32Array(this.fftSize);for(let a=0;a<this.nCh;a++)this.in.connect(this.out,a,a),this.in.connect(this.analysers[a],a,0);const i=getTdesign(4*n);this.td_dirs_rad=deg2rad(i),this.SHmtx=computeRealSH_1(this.order,this.td_dirs_rad),this.mode=r}updateBuffers(){for(let t=0;t<this.nCh;t++)this.analysers[t].getFloatTimeDomainData(this.analBuffers[t])}computePowermap(){const t=this.td_dirs_rad.length,n=numeric.dot(numeric.transpose(this.SHmtx),this.analBuffers),r=new Array(t);for(let i=0;i<t;i++){let a=0;for(let e=0;e<this.fftSize;e++)a=a+n[i][e]*n[i][e];a=a/this.fftSize,r[i]=[this.td_dirs_rad[i][0],this.td_dirs_rad[i][1],a]}return this.mode===0?r:forwardSHT_1(2*this.order,r,1,0)}}class intensityAnalyser{constructor(t){this.ctx=t,this.fftSize=2048,this.in=this.ctx.createChannelSplitter(4),this.out=this.ctx.createChannelMerger(4),this.gains=new Array(3);for(let n=0;n<3;n++)this.gains[n]=this.ctx.createGain(),this.gains[n].gain.value=1/Math.sqrt(3);this.analysers=new Array(4),this.analBuffers=new Array(4);for(let n=0;n<4;n++)this.analysers[n]=this.ctx.createAnalyser(),this.analysers[n].fftSize=this.fftSize,this.analysers[n].smoothingTimeConstant=0,this.analBuffers[n]=new Float32Array(this.fftSize);this.in.connect(this.out,0,0),this.in.connect(this.analysers[0],0,0),this.in.connect(this.gains[1],1,0),this.in.connect(this.gains[2],2,0),this.in.connect(this.gains[0],3,0);for(let n=0;n<3;n++)this.gains[n].connect(this.analysers[n+1],0,0),this.gains[n].connect(this.out,0,n+1)}updateBuffers(){for(let t=0;t<4;t++)this.analysers[t].getFloatTimeDomainData(this.analBuffers[t])}computeIntensity(){let t=0,n=0,r=0,i=0,a=0,e=0,c=0;for(let v=0;v<this.fftSize;v++)t=t+this.analBuffers[0][v]*this.analBuffers[1][v],n=n+this.analBuffers[0][v]*this.analBuffers[2][v],r=r+this.analBuffers[0][v]*this.analBuffers[3][v],i=i+this.analBuffers[0][v]*this.analBuffers[0][v],a=a+this.analBuffers[1][v]*this.analBuffers[1][v],e=e+this.analBuffers[2][v]*this.analBuffers[2][v],c=c+this.analBuffers[3][v]*this.analBuffers[3][v];const o=[t,n,r],f=Math.sqrt(o[0]*o[0]+o[1]*o[1]+o[2]*o[2]),h=(i+a+e+c)/2,u=1-f/(h+1e-7),M=radiansToDegrees(Math.atan2(n,t)),m=radiansToDegrees(Math.atan2(o[2],Math.sqrt(o[0]*o[0]+o[1]*o[1])));return[M,m,u,h]}}class intensityAnalyser2D{constructor(t){this.ctx=t,this.fftSize=2048,this.in=this.ctx.createChannelSplitter(3),this.out=this.ctx.createChannelMerger(3),this.gains=new Array(2);for(let n=0;n<2;n++)this.gains[n]=this.ctx.createGain(),this.gains[n].gain.value=1/Math.sqrt(3);this.analysers=new Array(3),this.analBuffers=new Array(3);for(let n=0;n<3;n++)this.analysers[n]=this.ctx.createAnalyser(),this.analysers[n].fftSize=this.fftSize,this.analysers[n].smoothingTimeConstant=0,this.analBuffers[n]=new Float32Array(this.fftSize);this.in.connect(this.out,0,0),this.in.connect(this.analysers[0],0,0),this.in.connect(this.gains[1],1,0),this.in.connect(this.gains[0],2,0);for(let n=0;n<2;n++)this.gains[n].connect(this.analysers[n+1],0,0),this.gains[n].connect(this.out,0,n+1)}updateBuffers(){for(let t=0;t<3;t++)this.analysers[t].getFloatTimeDomainData(this.analBuffers[t])}computeIntensity(){let t=0,n=0,r=0,i=0,a=0;for(let M=0;M<this.fftSize;M++)t=t+this.analBuffers[0][M]*this.analBuffers[1][M],n=n+this.analBuffers[0][M]*this.analBuffers[2][M],r=r+this.analBuffers[0][M]*this.analBuffers[0][M],i=i+this.analBuffers[1][M]*this.analBuffers[1][M],a=a+this.analBuffers[2][M]*this.analBuffers[2][M];const e=[t,n],c=Math.sqrt(e[0]*e[0]+e[1]*e[1]),o=(r+i+a)/2,f=1-c/(o+1e-7);return[-radiansToDegrees(Math.atan2(n,t)),0,f,o]}}function pad(p,t){return("000000000"+p).substr(-2)}class HOAloader{constructor(t,n,r,i){this.context=t,this.order=n,this.nCh=getAmbisonicChannelCount(n),this.nChGroups=Math.ceil(this.nCh/8),this.buffers=new Array,this.loadCount=0,this.loaded=!1,this.onLoad=i,this.urls=new Array(this.nChGroups),this.concatBuffer=null;const a=r.slice(r.length-3,r.length);this.fileExt=a;for(let e=0;e<this.nChGroups;e++)e===this.nChGroups-1?this.urls[e]=r.slice(0,r.length-4)+"_"+pad(e*8+1)+"-"+pad(this.nCh)+"ch."+a:this.urls[e]=r.slice(0,r.length-4)+"_"+pad(e*8+1)+"-"+pad(e*8+8)+"ch."+a}loadBuffers(t,n){const r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer";const i=this;r.onload=function(){i.context.decodeAudioData(r.response,function(a){if(!a){alert("error decoding file data: "+t);return}i.buffers[n]=a,i.loadCount++,i.loadCount===i.nChGroups&&(i.loaded=!0,i.concatBuffers(),console.log("HOAloader: all buffers loaded and concatenated"),i.onLoad(i.concatBuffer))},function(a){alert("Browser cannot decode audio data:  "+t+`

Error: `+a+`

(If you re using Safari and get a null error, this is most likely due to Apple's shady plan going on to stop the .ogg format from easing web developer's life :)`)})},r.onerror=function(){alert("HOAloader: XHR error")},r.send()}load(){for(let t=0;t<this.nChGroups;++t)this.loadBuffers(this.urls[t],t)}concatBuffers(){if(!this.loaded)return;const t=this.nCh,n=this.nChGroups;let r=this.buffers[0].length;this.buffers.forEach(e=>{r=Math.max(r,e.length)});const i=this.buffers[0].sampleRate;let a=[1,2,3,4,5,6,7,8];this.fileExt.toLowerCase()==="ogg"&&(console.log("Loading of 8chan OGG files [Chrome/Firefox]: remap channels to correct order!"),a=[1,3,2,7,8,5,6,4]),this.concatBuffer=this.context.createBuffer(t,r,i);for(let e=0;e<n;e++)for(let c=0;c<this.buffers[e].numberOfChannels;c++)this.concatBuffer.getChannelData(e*8+c).set(this.buffers[e].getChannelData(a[c]-1))}}class HRIRloader_local{constructor(t,n,r){this.context=t,this.order=n,this.nCh=getAmbisonicChannelCount(n),this.onLoad=r,this.vls_dirs_deg=getTdesign(2*this.order),this.nVLS=this.vls_dirs_deg.length,this.nearestLookupRes=[5,5],this.fs=0,this.nSamples=0,this.hrir_dirs_deg=[],this.hrirs=[],this.nearestLookup=[],this.nearest_dirs_deg=[],this.vls_hrirs=[],this.decodingMatrix=[],this.hoaBuffer=null}load(t){const n=this,r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="json",r.onload=function(){n.parseHrirFromJSON(r.response),n.nearestLookup=createNearestLookup(n.hrir_dirs_deg,n.nearestLookupRes);const i=findNearest(n.vls_dirs_deg,n.nearestLookup,n.nearestLookupRes);n.nearest_dirs_deg=n.getClosestDirs(i,n.hrir_dirs_deg),n.vls_hrirs=n.getClosestHrirFilters(i,n.hrirs),n.computeDecFilters()},r.send()}parseHrirFromJSON(t){const n=this;this.fs=t.leaves[6].data[0],this.nSamples=t.leaves[8].data[0][1].length,this.hrir_dirs_deg=[],t.leaves[4].data.forEach(function(r){n.hrir_dirs_deg.push([r[0],r[1]])}),this.hrirs=[],t.leaves[8].data.forEach(function(r){const i=new Float64Array(r[0]),a=new Float64Array(r[1]);n.hrirs.push([i,a])})}getClosestDirs(t,n){const r=t.length,i=[];for(let a=0;a<r;a++)i.push(n[t[a]]);return i}getClosestHrirFilters(t,n){const r=t.length,i=[];for(let a=0;a<r;a++)i.push(n[t[a]]);return i}computeDecFilters(){this.decodingMatrix=getAmbisonicDecMtx(this.nearest_dirs_deg,this.order),this.hoaBuffer=this.getHoaFilterFromHrirFilter(this.nCh,this.nSamples,this.fs,this.vls_hrirs,this.decodingMatrix),this.onLoad(this.hoaBuffer)}getHoaFilterFromHrirFilter(t,n,r,i,a){n>i[0][0].length&&(n=i[0][0].length);const e=this.context.createBuffer(t,n,r);for(let c=0;c<t;c++){const o=new Float32Array(n);for(let f=0;f<i.length;f++)for(let h=0;h<n;h++)o[h]+=a[f][c]*i[f][0][h];e.getChannelData(c).set(o)}return e}}class HRIRloader2D_local{constructor(t,n,r){this.context=t,this.order=n,this.nCh=getAmbisonicChannelCount2D(n),this.onLoad=r,this.vls_dirs_deg=sampleCircle(2*this.order+2),this.nVLS=this.vls_dirs_deg.length,this.nearestLookupRes=[5,5],this.fs=0,this.nSamples=0,this.hrir_dirs_deg=[],this.hrirs=[],this.nearestLookup=[],this.vls_hrirs=[],this.decodingMatrix=[],this.hoaBuffer=null}load(t){const n=this,r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="json",r.onload=function(){n.parseHrirFromJSON(r.response),n.nearestLookup=createNearestLookup(n.hrir_dirs_deg,n.nearestLookupRes);const i=findNearest(n.vls_dirs_deg,n.nearestLookup,n.nearestLookupRes);n.getClosestDirs(i,n.hrir_dirs_deg),n.vls_hrirs=n.getClosestHrirFilters(i,n.hrirs),n.computeDecFilters()},r.send()}parseHrirFromJSON(t){const n=this;this.fs=t.leaves[6].data[0],this.nSamples=t.leaves[8].data[0][1].length,this.hrir_dirs_deg=[],t.leaves[4].data.forEach(function(r){n.hrir_dirs_deg.push([r[0],r[1]])}),this.hrirs=[],t.leaves[8].data.forEach(function(r){const i=new Float64Array(r[0]),a=new Float64Array(r[1]);n.hrirs.push([i,a])})}getClosestDirs(t,n){const r=t.length,i=[];for(let a=0;a<r;a++)i.push(n[t[a]]);return i}getClosestHrirFilters(t,n){const r=t.length,i=[];for(let a=0;a<r;a++)i.push(n[t[a]]);return i}computeDecFilters(){const t=[];t.push(1);for(let r=1;r<this.order+1;r++)t.push(Math.cos(r*Math.PI/(2*this.order+2))),t.push(Math.cos(r*Math.PI/(2*this.order+2)));const n=numeric.diag(t);this.decodingMatrix=numeric.transpose(getCircHarmonics(this.order,getColumn(this.vls_dirs_deg,0))),this.decodingMatrix=numeric.dot(this.decodingMatrix,n),this.decodingMatrix=numeric.mul(2*Math.PI/this.vls_dirs_deg.length,this.decodingMatrix),this.hoaBuffer=this.getHoaFilterFromHrirFilter(this.nCh,this.nSamples,this.fs,this.vls_hrirs,this.decodingMatrix),this.onLoad(this.hoaBuffer)}getHoaFilterFromHrirFilter(t,n,r,i,a){n>i[0][0].length&&(n=i[0][0].length);const e=this.context.createBuffer(t,n,r);for(let c=0;c<t;c++){const o=new Float32Array(n);for(let f=0;f<i.length;f++)for(let h=0;h<n;h++)o[h]+=a[f][c]*i[f][0][h];e.getChannelData(c).set(o)}return e}}function commonjsRequire(p){throw new Error('Could not dynamically require "'+p+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var serveSofaHrir={exports:{}};(function(p,t){(function(n){p.exports=n()})(function(){return function n(r,i,a){function e(f,h){if(!i[f]){if(!r[f]){var u=typeof commonjsRequire=="function"&&commonjsRequire;if(!h&&u)return u(f,!0);if(c)return c(f,!0);var M=new Error("Cannot find module '"+f+"'");throw M.code="MODULE_NOT_FOUND",M}var m=i[f]={exports:{}};r[f][0].call(m.exports,function(v){var y=r[f][1][v];return e(y||v)},m,m.exports,n,r,i,a)}return i[f].exports}for(var c=typeof commonjsRequire=="function"&&commonjsRequire,o=0;o<a.length;o++)e(a[o]);return e}({1:[function(n,r,i){r.exports={default:n("core-js/library/fn/object/define-property"),__esModule:!0}},{"core-js/library/fn/object/define-property":4}],2:[function(n,r,i){i.default=function(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")},i.__esModule=!0},{}],3:[function(n,r,i){var a=n("babel-runtime/core-js/object/define-property").default;i.default=function(){function e(c,o){for(var f=0;f<o.length;f++){var h=o[f];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),a(c,h.key,h)}}return function(c,o,f){return o&&e(c.prototype,o),f&&e(c,f),c}}(),i.__esModule=!0},{"babel-runtime/core-js/object/define-property":1}],4:[function(n,r,i){var a=n("../../modules/$");r.exports=function(c,o,f){return a.setDesc(c,o,f)}},{"../../modules/$":5}],5:[function(n,r,i){var a=Object;r.exports={create:a.create,getProto:a.getPrototypeOf,isEnum:{}.propertyIsEnumerable,getDesc:a.getOwnPropertyDescriptor,setDesc:a.defineProperty,setDescs:a.defineProperties,getKeys:a.keys,getNames:a.getOwnPropertyNames,getSymbols:a.getOwnPropertySymbols,each:[].forEach}},{}],6:[function(n,r,i){var a=n("babel-runtime/helpers/create-class").default,e=n("babel-runtime/helpers/class-call-check").default;Object.defineProperty(i,"__esModule",{value:!0});var c=function(){function o(f,h){e(this,o),this.delayTime=0,this.posRead=0,this.posWrite=0,this.fracXi1=0,this.fracYi1=0,this.intDelay=0,this.fracDelay=0,this.a1=void 0,this.sampleRate=f,this.maxDelayTime=h||1,this.bufferSize=this.maxDelayTime*this.sampleRate,this.bufferSize%1!==0&&(this.bufferSize=parseInt(this.bufferSize)+1),this.buffer=new Float32Array(this.bufferSize)}return a(o,[{key:"setDelay",value:function(h){if(h<this.maxDelayTime){this.delayTime=h;var u=h*this.sampleRate;this.intDelay=parseInt(u),this.fracDelay=u-this.intDelay,this.resample(),this.fracDelay!==0&&this.updateThiranCoefficient()}else throw new Error("delayTime > maxDelayTime")}},{key:"getDelay",value:function(){return this.delayTime}},{key:"process",value:function(h){for(var u=new Float32Array(h.length),M=0;M<h.length;M=M+1)this.buffer[this.posWrite]=h[M],u[M]=this.buffer[this.posRead],this.updatePointers();return this.fracDelay===0||(u=new Float32Array(this.fractionalThiranProcess(u))),u}},{key:"updatePointers",value:function(){this.posWrite===this.buffer.length-1?this.posWrite=0:this.posWrite=this.posWrite+1,this.posRead===this.buffer.length-1?this.posRead=0:this.posRead=this.posRead+1}},{key:"updateThiranCoefficient",value:function(){this.a1=(1-this.fracDelay)/(1+this.fracDelay)}},{key:"resample",value:function(){if(this.posWrite-this.intDelay<0){var h=this.intDelay-this.posWrite;this.posRead=this.buffer.length-h}else this.posRead=this.posWrite-this.intDelay}},{key:"fractionalThiranProcess",value:function(h){for(var u=new Float32Array(h.length),M,m,v=this.fracXi1,y=this.fracYi1,S=0;S<h.length;S=S+1)M=h[S],m=this.a1*M+v-this.a1*y,v=M,y=m,u[S]=m;return this.fracXi1=v,this.fracYi1=y,u}}]),o}();i.default=c,r.exports=i.default},{"babel-runtime/helpers/class-call-check":2,"babel-runtime/helpers/create-class":3}],7:[function(n,r,i){r.exports=n("./dist/fractional-delay")},{"./dist/fractional-delay":6}],8:[function(n,r,i){(function(e,c){if(typeof i=="object"&&typeof r=="object")r.exports=c();else{var o=c();for(var f in o)(typeof i=="object"?i:e)[f]=o[f]}})(this,function(){return function(a){var e={};function c(o){if(e[o])return e[o].exports;var f=e[o]={i:o,l:!1,exports:{}};return a[o].call(f.exports,f,f.exports,c),f.l=!0,f.exports}return c.m=a,c.c=e,c.d=function(o,f,h){c.o(o,f)||Object.defineProperty(o,f,{configurable:!1,enumerable:!0,get:h})},c.n=function(o){var f=o&&o.__esModule?function(){return o.default}:function(){return o};return c.d(f,"a",f),f},c.o=function(o,f){return Object.prototype.hasOwnProperty.call(o,f)},c.p="",c(c.s=4)}([function(a,e,c){Object.defineProperty(e,"__esModule",{value:!0}),e.setMatrixArrayType=f,e.toRadian=u,e.equals=M;var o=e.EPSILON=1e-6;e.ARRAY_TYPE=typeof Float32Array<"u"?Float32Array:Array,e.RANDOM=Math.random;function f(m){e.ARRAY_TYPE=m}var h=Math.PI/180;function u(m){return m*h}function M(m,v){return Math.abs(m-v)<=o*Math.max(1,Math.abs(m),Math.abs(v))}},function(a,e,c){Object.defineProperty(e,"__esModule",{value:!0}),e.sub=e.mul=void 0,e.create=u,e.fromMat4=M,e.clone=m,e.copy=v,e.fromValues=y,e.set=S,e.identity=_,e.transpose=L,e.invert=F,e.adjoint=x,e.determinant=O,e.multiply=R,e.translate=I,e.rotate=l,e.scale=b,e.fromTranslation=Z,e.fromRotation=G,e.fromScaling=J,e.fromMat2d=ee,e.fromQuat=se,e.normalFromMat4=Ae,e.projection=De,e.str=Se,e.frob=N,e.add=w,e.subtract=j,e.multiplyScalar=te,e.multiplyScalarAndAdd=ie,e.exactEquals=ce,e.equals=ge;var o=c(0),f=h(o);function h(D){if(D&&D.__esModule)return D;var d={};if(D!=null)for(var E in D)Object.prototype.hasOwnProperty.call(D,E)&&(d[E]=D[E]);return d.default=D,d}function u(){var D=new f.ARRAY_TYPE(9);return D[0]=1,D[1]=0,D[2]=0,D[3]=0,D[4]=1,D[5]=0,D[6]=0,D[7]=0,D[8]=1,D}function M(D,d){return D[0]=d[0],D[1]=d[1],D[2]=d[2],D[3]=d[4],D[4]=d[5],D[5]=d[6],D[6]=d[8],D[7]=d[9],D[8]=d[10],D}function m(D){var d=new f.ARRAY_TYPE(9);return d[0]=D[0],d[1]=D[1],d[2]=D[2],d[3]=D[3],d[4]=D[4],d[5]=D[5],d[6]=D[6],d[7]=D[7],d[8]=D[8],d}function v(D,d){return D[0]=d[0],D[1]=d[1],D[2]=d[2],D[3]=d[3],D[4]=d[4],D[5]=d[5],D[6]=d[6],D[7]=d[7],D[8]=d[8],D}function y(D,d,E,Q,z,X,$,he,de){var q=new f.ARRAY_TYPE(9);return q[0]=D,q[1]=d,q[2]=E,q[3]=Q,q[4]=z,q[5]=X,q[6]=$,q[7]=he,q[8]=de,q}function S(D,d,E,Q,z,X,$,he,de,q){return D[0]=d,D[1]=E,D[2]=Q,D[3]=z,D[4]=X,D[5]=$,D[6]=he,D[7]=de,D[8]=q,D}function _(D){return D[0]=1,D[1]=0,D[2]=0,D[3]=0,D[4]=1,D[5]=0,D[6]=0,D[7]=0,D[8]=1,D}function L(D,d){if(D===d){var E=d[1],Q=d[2],z=d[5];D[1]=d[3],D[2]=d[6],D[3]=E,D[5]=d[7],D[6]=Q,D[7]=z}else D[0]=d[0],D[1]=d[3],D[2]=d[6],D[3]=d[1],D[4]=d[4],D[5]=d[7],D[6]=d[2],D[7]=d[5],D[8]=d[8];return D}function F(D,d){var E=d[0],Q=d[1],z=d[2],X=d[3],$=d[4],he=d[5],de=d[6],q=d[7],K=d[8],ne=K*$-he*q,oe=-K*X+he*de,le=q*X-$*de,s=E*ne+Q*oe+z*le;return s?(s=1/s,D[0]=ne*s,D[1]=(-K*Q+z*q)*s,D[2]=(he*Q-z*$)*s,D[3]=oe*s,D[4]=(K*E-z*de)*s,D[5]=(-he*E+z*X)*s,D[6]=le*s,D[7]=(-q*E+Q*de)*s,D[8]=($*E-Q*X)*s,D):null}function x(D,d){var E=d[0],Q=d[1],z=d[2],X=d[3],$=d[4],he=d[5],de=d[6],q=d[7],K=d[8];return D[0]=$*K-he*q,D[1]=z*q-Q*K,D[2]=Q*he-z*$,D[3]=he*de-X*K,D[4]=E*K-z*de,D[5]=z*X-E*he,D[6]=X*q-$*de,D[7]=Q*de-E*q,D[8]=E*$-Q*X,D}function O(D){var d=D[0],E=D[1],Q=D[2],z=D[3],X=D[4],$=D[5],he=D[6],de=D[7],q=D[8];return d*(q*X-$*de)+E*(-q*z+$*he)+Q*(de*z-X*he)}function R(D,d,E){var Q=d[0],z=d[1],X=d[2],$=d[3],he=d[4],de=d[5],q=d[6],K=d[7],ne=d[8],oe=E[0],le=E[1],s=E[2],g=E[3],H=E[4],Y=E[5],re=E[6],ae=E[7],fe=E[8];return D[0]=oe*Q+le*$+s*q,D[1]=oe*z+le*he+s*K,D[2]=oe*X+le*de+s*ne,D[3]=g*Q+H*$+Y*q,D[4]=g*z+H*he+Y*K,D[5]=g*X+H*de+Y*ne,D[6]=re*Q+ae*$+fe*q,D[7]=re*z+ae*he+fe*K,D[8]=re*X+ae*de+fe*ne,D}function I(D,d,E){var Q=d[0],z=d[1],X=d[2],$=d[3],he=d[4],de=d[5],q=d[6],K=d[7],ne=d[8],oe=E[0],le=E[1];return D[0]=Q,D[1]=z,D[2]=X,D[3]=$,D[4]=he,D[5]=de,D[6]=oe*Q+le*$+q,D[7]=oe*z+le*he+K,D[8]=oe*X+le*de+ne,D}function l(D,d,E){var Q=d[0],z=d[1],X=d[2],$=d[3],he=d[4],de=d[5],q=d[6],K=d[7],ne=d[8],oe=Math.sin(E),le=Math.cos(E);return D[0]=le*Q+oe*$,D[1]=le*z+oe*he,D[2]=le*X+oe*de,D[3]=le*$-oe*Q,D[4]=le*he-oe*z,D[5]=le*de-oe*X,D[6]=q,D[7]=K,D[8]=ne,D}function b(D,d,E){var Q=E[0],z=E[1];return D[0]=Q*d[0],D[1]=Q*d[1],D[2]=Q*d[2],D[3]=z*d[3],D[4]=z*d[4],D[5]=z*d[5],D[6]=d[6],D[7]=d[7],D[8]=d[8],D}function Z(D,d){return D[0]=1,D[1]=0,D[2]=0,D[3]=0,D[4]=1,D[5]=0,D[6]=d[0],D[7]=d[1],D[8]=1,D}function G(D,d){var E=Math.sin(d),Q=Math.cos(d);return D[0]=Q,D[1]=E,D[2]=0,D[3]=-E,D[4]=Q,D[5]=0,D[6]=0,D[7]=0,D[8]=1,D}function J(D,d){return D[0]=d[0],D[1]=0,D[2]=0,D[3]=0,D[4]=d[1],D[5]=0,D[6]=0,D[7]=0,D[8]=1,D}function ee(D,d){return D[0]=d[0],D[1]=d[1],D[2]=0,D[3]=d[2],D[4]=d[3],D[5]=0,D[6]=d[4],D[7]=d[5],D[8]=1,D}function se(D,d){var E=d[0],Q=d[1],z=d[2],X=d[3],$=E+E,he=Q+Q,de=z+z,q=E*$,K=Q*$,ne=Q*he,oe=z*$,le=z*he,s=z*de,g=X*$,H=X*he,Y=X*de;return D[0]=1-ne-s,D[3]=K-Y,D[6]=oe+H,D[1]=K+Y,D[4]=1-q-s,D[7]=le-g,D[2]=oe-H,D[5]=le+g,D[8]=1-q-ne,D}function Ae(D,d){var E=d[0],Q=d[1],z=d[2],X=d[3],$=d[4],he=d[5],de=d[6],q=d[7],K=d[8],ne=d[9],oe=d[10],le=d[11],s=d[12],g=d[13],H=d[14],Y=d[15],re=E*he-Q*$,ae=E*de-z*$,fe=E*q-X*$,ue=Q*de-z*he,me=Q*q-X*he,ve=z*q-X*de,ye=K*g-ne*s,Ce=K*H-oe*s,Me=K*Y-le*s,we=ne*H-oe*g,xe=ne*Y-le*g,_e=oe*Y-le*H,pe=re*_e-ae*xe+fe*we+ue*Me-me*Ce+ve*ye;return pe?(pe=1/pe,D[0]=(he*_e-de*xe+q*we)*pe,D[1]=(de*Me-$*_e-q*Ce)*pe,D[2]=($*xe-he*Me+q*ye)*pe,D[3]=(z*xe-Q*_e-X*we)*pe,D[4]=(E*_e-z*Me+X*Ce)*pe,D[5]=(Q*Me-E*xe-X*ye)*pe,D[6]=(g*ve-H*me+Y*ue)*pe,D[7]=(H*fe-s*ve-Y*ae)*pe,D[8]=(s*me-g*fe+Y*re)*pe,D):null}function De(D,d,E){return D[0]=2/d,D[1]=0,D[2]=0,D[3]=0,D[4]=-2/E,D[5]=0,D[6]=-1,D[7]=1,D[8]=1,D}function Se(D){return"mat3("+D[0]+", "+D[1]+", "+D[2]+", "+D[3]+", "+D[4]+", "+D[5]+", "+D[6]+", "+D[7]+", "+D[8]+")"}function N(D){return Math.sqrt(Math.pow(D[0],2)+Math.pow(D[1],2)+Math.pow(D[2],2)+Math.pow(D[3],2)+Math.pow(D[4],2)+Math.pow(D[5],2)+Math.pow(D[6],2)+Math.pow(D[7],2)+Math.pow(D[8],2))}function w(D,d,E){return D[0]=d[0]+E[0],D[1]=d[1]+E[1],D[2]=d[2]+E[2],D[3]=d[3]+E[3],D[4]=d[4]+E[4],D[5]=d[5]+E[5],D[6]=d[6]+E[6],D[7]=d[7]+E[7],D[8]=d[8]+E[8],D}function j(D,d,E){return D[0]=d[0]-E[0],D[1]=d[1]-E[1],D[2]=d[2]-E[2],D[3]=d[3]-E[3],D[4]=d[4]-E[4],D[5]=d[5]-E[5],D[6]=d[6]-E[6],D[7]=d[7]-E[7],D[8]=d[8]-E[8],D}function te(D,d,E){return D[0]=d[0]*E,D[1]=d[1]*E,D[2]=d[2]*E,D[3]=d[3]*E,D[4]=d[4]*E,D[5]=d[5]*E,D[6]=d[6]*E,D[7]=d[7]*E,D[8]=d[8]*E,D}function ie(D,d,E,Q){return D[0]=d[0]+E[0]*Q,D[1]=d[1]+E[1]*Q,D[2]=d[2]+E[2]*Q,D[3]=d[3]+E[3]*Q,D[4]=d[4]+E[4]*Q,D[5]=d[5]+E[5]*Q,D[6]=d[6]+E[6]*Q,D[7]=d[7]+E[7]*Q,D[8]=d[8]+E[8]*Q,D}function ce(D,d){return D[0]===d[0]&&D[1]===d[1]&&D[2]===d[2]&&D[3]===d[3]&&D[4]===d[4]&&D[5]===d[5]&&D[6]===d[6]&&D[7]===d[7]&&D[8]===d[8]}function ge(D,d){var E=D[0],Q=D[1],z=D[2],X=D[3],$=D[4],he=D[5],de=D[6],q=D[7],K=D[8],ne=d[0],oe=d[1],le=d[2],s=d[3],g=d[4],H=d[5],Y=d[6],re=d[7],ae=d[8];return Math.abs(E-ne)<=f.EPSILON*Math.max(1,Math.abs(E),Math.abs(ne))&&Math.abs(Q-oe)<=f.EPSILON*Math.max(1,Math.abs(Q),Math.abs(oe))&&Math.abs(z-le)<=f.EPSILON*Math.max(1,Math.abs(z),Math.abs(le))&&Math.abs(X-s)<=f.EPSILON*Math.max(1,Math.abs(X),Math.abs(s))&&Math.abs($-g)<=f.EPSILON*Math.max(1,Math.abs($),Math.abs(g))&&Math.abs(he-H)<=f.EPSILON*Math.max(1,Math.abs(he),Math.abs(H))&&Math.abs(de-Y)<=f.EPSILON*Math.max(1,Math.abs(de),Math.abs(Y))&&Math.abs(q-re)<=f.EPSILON*Math.max(1,Math.abs(q),Math.abs(re))&&Math.abs(K-ae)<=f.EPSILON*Math.max(1,Math.abs(K),Math.abs(ae))}e.mul=R,e.sub=j},function(a,e,c){Object.defineProperty(e,"__esModule",{value:!0}),e.forEach=e.sqrLen=e.len=e.sqrDist=e.dist=e.div=e.mul=e.sub=void 0,e.create=u,e.clone=M,e.length=m,e.fromValues=v,e.copy=y,e.set=S,e.add=_,e.subtract=L,e.multiply=F,e.divide=x,e.ceil=O,e.floor=R,e.min=I,e.max=l,e.round=b,e.scale=Z,e.scaleAndAdd=G,e.distance=J,e.squaredDistance=ee,e.squaredLength=se,e.negate=Ae,e.inverse=De,e.normalize=Se,e.dot=N,e.cross=w,e.lerp=j,e.hermite=te,e.bezier=ie,e.random=ce,e.transformMat4=ge,e.transformMat3=D,e.transformQuat=d,e.rotateX=E,e.rotateY=Q,e.rotateZ=z,e.angle=X,e.str=$,e.exactEquals=he,e.equals=de;var o=c(0),f=h(o);function h(q){if(q&&q.__esModule)return q;var K={};if(q!=null)for(var ne in q)Object.prototype.hasOwnProperty.call(q,ne)&&(K[ne]=q[ne]);return K.default=q,K}function u(){var q=new f.ARRAY_TYPE(3);return q[0]=0,q[1]=0,q[2]=0,q}function M(q){var K=new f.ARRAY_TYPE(3);return K[0]=q[0],K[1]=q[1],K[2]=q[2],K}function m(q){var K=q[0],ne=q[1],oe=q[2];return Math.sqrt(K*K+ne*ne+oe*oe)}function v(q,K,ne){var oe=new f.ARRAY_TYPE(3);return oe[0]=q,oe[1]=K,oe[2]=ne,oe}function y(q,K){return q[0]=K[0],q[1]=K[1],q[2]=K[2],q}function S(q,K,ne,oe){return q[0]=K,q[1]=ne,q[2]=oe,q}function _(q,K,ne){return q[0]=K[0]+ne[0],q[1]=K[1]+ne[1],q[2]=K[2]+ne[2],q}function L(q,K,ne){return q[0]=K[0]-ne[0],q[1]=K[1]-ne[1],q[2]=K[2]-ne[2],q}function F(q,K,ne){return q[0]=K[0]*ne[0],q[1]=K[1]*ne[1],q[2]=K[2]*ne[2],q}function x(q,K,ne){return q[0]=K[0]/ne[0],q[1]=K[1]/ne[1],q[2]=K[2]/ne[2],q}function O(q,K){return q[0]=Math.ceil(K[0]),q[1]=Math.ceil(K[1]),q[2]=Math.ceil(K[2]),q}function R(q,K){return q[0]=Math.floor(K[0]),q[1]=Math.floor(K[1]),q[2]=Math.floor(K[2]),q}function I(q,K,ne){return q[0]=Math.min(K[0],ne[0]),q[1]=Math.min(K[1],ne[1]),q[2]=Math.min(K[2],ne[2]),q}function l(q,K,ne){return q[0]=Math.max(K[0],ne[0]),q[1]=Math.max(K[1],ne[1]),q[2]=Math.max(K[2],ne[2]),q}function b(q,K){return q[0]=Math.round(K[0]),q[1]=Math.round(K[1]),q[2]=Math.round(K[2]),q}function Z(q,K,ne){return q[0]=K[0]*ne,q[1]=K[1]*ne,q[2]=K[2]*ne,q}function G(q,K,ne,oe){return q[0]=K[0]+ne[0]*oe,q[1]=K[1]+ne[1]*oe,q[2]=K[2]+ne[2]*oe,q}function J(q,K){var ne=K[0]-q[0],oe=K[1]-q[1],le=K[2]-q[2];return Math.sqrt(ne*ne+oe*oe+le*le)}function ee(q,K){var ne=K[0]-q[0],oe=K[1]-q[1],le=K[2]-q[2];return ne*ne+oe*oe+le*le}function se(q){var K=q[0],ne=q[1],oe=q[2];return K*K+ne*ne+oe*oe}function Ae(q,K){return q[0]=-K[0],q[1]=-K[1],q[2]=-K[2],q}function De(q,K){return q[0]=1/K[0],q[1]=1/K[1],q[2]=1/K[2],q}function Se(q,K){var ne=K[0],oe=K[1],le=K[2],s=ne*ne+oe*oe+le*le;return s>0&&(s=1/Math.sqrt(s),q[0]=K[0]*s,q[1]=K[1]*s,q[2]=K[2]*s),q}function N(q,K){return q[0]*K[0]+q[1]*K[1]+q[2]*K[2]}function w(q,K,ne){var oe=K[0],le=K[1],s=K[2],g=ne[0],H=ne[1],Y=ne[2];return q[0]=le*Y-s*H,q[1]=s*g-oe*Y,q[2]=oe*H-le*g,q}function j(q,K,ne,oe){var le=K[0],s=K[1],g=K[2];return q[0]=le+oe*(ne[0]-le),q[1]=s+oe*(ne[1]-s),q[2]=g+oe*(ne[2]-g),q}function te(q,K,ne,oe,le,s){var g=s*s,H=g*(2*s-3)+1,Y=g*(s-2)+s,re=g*(s-1),ae=g*(3-2*s);return q[0]=K[0]*H+ne[0]*Y+oe[0]*re+le[0]*ae,q[1]=K[1]*H+ne[1]*Y+oe[1]*re+le[1]*ae,q[2]=K[2]*H+ne[2]*Y+oe[2]*re+le[2]*ae,q}function ie(q,K,ne,oe,le,s){var g=1-s,H=g*g,Y=s*s,re=H*g,ae=3*s*H,fe=3*Y*g,ue=Y*s;return q[0]=K[0]*re+ne[0]*ae+oe[0]*fe+le[0]*ue,q[1]=K[1]*re+ne[1]*ae+oe[1]*fe+le[1]*ue,q[2]=K[2]*re+ne[2]*ae+oe[2]*fe+le[2]*ue,q}function ce(q,K){K=K||1;var ne=f.RANDOM()*2*Math.PI,oe=f.RANDOM()*2-1,le=Math.sqrt(1-oe*oe)*K;return q[0]=Math.cos(ne)*le,q[1]=Math.sin(ne)*le,q[2]=oe*K,q}function ge(q,K,ne){var oe=K[0],le=K[1],s=K[2],g=ne[3]*oe+ne[7]*le+ne[11]*s+ne[15];return g=g||1,q[0]=(ne[0]*oe+ne[4]*le+ne[8]*s+ne[12])/g,q[1]=(ne[1]*oe+ne[5]*le+ne[9]*s+ne[13])/g,q[2]=(ne[2]*oe+ne[6]*le+ne[10]*s+ne[14])/g,q}function D(q,K,ne){var oe=K[0],le=K[1],s=K[2];return q[0]=oe*ne[0]+le*ne[3]+s*ne[6],q[1]=oe*ne[1]+le*ne[4]+s*ne[7],q[2]=oe*ne[2]+le*ne[5]+s*ne[8],q}function d(q,K,ne){var oe=K[0],le=K[1],s=K[2],g=ne[0],H=ne[1],Y=ne[2],re=ne[3],ae=re*oe+H*s-Y*le,fe=re*le+Y*oe-g*s,ue=re*s+g*le-H*oe,me=-g*oe-H*le-Y*s;return q[0]=ae*re+me*-g+fe*-Y-ue*-H,q[1]=fe*re+me*-H+ue*-g-ae*-Y,q[2]=ue*re+me*-Y+ae*-H-fe*-g,q}function E(q,K,ne,oe){var le=[],s=[];return le[0]=K[0]-ne[0],le[1]=K[1]-ne[1],le[2]=K[2]-ne[2],s[0]=le[0],s[1]=le[1]*Math.cos(oe)-le[2]*Math.sin(oe),s[2]=le[1]*Math.sin(oe)+le[2]*Math.cos(oe),q[0]=s[0]+ne[0],q[1]=s[1]+ne[1],q[2]=s[2]+ne[2],q}function Q(q,K,ne,oe){var le=[],s=[];return le[0]=K[0]-ne[0],le[1]=K[1]-ne[1],le[2]=K[2]-ne[2],s[0]=le[2]*Math.sin(oe)+le[0]*Math.cos(oe),s[1]=le[1],s[2]=le[2]*Math.cos(oe)-le[0]*Math.sin(oe),q[0]=s[0]+ne[0],q[1]=s[1]+ne[1],q[2]=s[2]+ne[2],q}function z(q,K,ne,oe){var le=[],s=[];return le[0]=K[0]-ne[0],le[1]=K[1]-ne[1],le[2]=K[2]-ne[2],s[0]=le[0]*Math.cos(oe)-le[1]*Math.sin(oe),s[1]=le[0]*Math.sin(oe)+le[1]*Math.cos(oe),s[2]=le[2],q[0]=s[0]+ne[0],q[1]=s[1]+ne[1],q[2]=s[2]+ne[2],q}function X(q,K){var ne=v(q[0],q[1],q[2]),oe=v(K[0],K[1],K[2]);Se(ne,ne),Se(oe,oe);var le=N(ne,oe);return le>1?0:le<-1?Math.PI:Math.acos(le)}function $(q){return"vec3("+q[0]+", "+q[1]+", "+q[2]+")"}function he(q,K){return q[0]===K[0]&&q[1]===K[1]&&q[2]===K[2]}function de(q,K){var ne=q[0],oe=q[1],le=q[2],s=K[0],g=K[1],H=K[2];return Math.abs(ne-s)<=f.EPSILON*Math.max(1,Math.abs(ne),Math.abs(s))&&Math.abs(oe-g)<=f.EPSILON*Math.max(1,Math.abs(oe),Math.abs(g))&&Math.abs(le-H)<=f.EPSILON*Math.max(1,Math.abs(le),Math.abs(H))}e.sub=L,e.mul=F,e.div=x,e.dist=J,e.sqrDist=ee,e.len=m,e.sqrLen=se,e.forEach=function(){var q=u();return function(K,ne,oe,le,s,g){var H=void 0,Y=void 0;for(ne||(ne=3),oe||(oe=0),le?Y=Math.min(le*ne+oe,K.length):Y=K.length,H=oe;H<Y;H+=ne)q[0]=K[H],q[1]=K[H+1],q[2]=K[H+2],s(q,q,g),K[H]=q[0],K[H+1]=q[1],K[H+2]=q[2];return K}}()},function(a,e,c){Object.defineProperty(e,"__esModule",{value:!0}),e.forEach=e.sqrLen=e.len=e.sqrDist=e.dist=e.div=e.mul=e.sub=void 0,e.create=u,e.clone=M,e.fromValues=m,e.copy=v,e.set=y,e.add=S,e.subtract=_,e.multiply=L,e.divide=F,e.ceil=x,e.floor=O,e.min=R,e.max=I,e.round=l,e.scale=b,e.scaleAndAdd=Z,e.distance=G,e.squaredDistance=J,e.length=ee,e.squaredLength=se,e.negate=Ae,e.inverse=De,e.normalize=Se,e.dot=N,e.lerp=w,e.random=j,e.transformMat4=te,e.transformQuat=ie,e.str=ce,e.exactEquals=ge,e.equals=D;var o=c(0),f=h(o);function h(d){if(d&&d.__esModule)return d;var E={};if(d!=null)for(var Q in d)Object.prototype.hasOwnProperty.call(d,Q)&&(E[Q]=d[Q]);return E.default=d,E}function u(){var d=new f.ARRAY_TYPE(4);return d[0]=0,d[1]=0,d[2]=0,d[3]=0,d}function M(d){var E=new f.ARRAY_TYPE(4);return E[0]=d[0],E[1]=d[1],E[2]=d[2],E[3]=d[3],E}function m(d,E,Q,z){var X=new f.ARRAY_TYPE(4);return X[0]=d,X[1]=E,X[2]=Q,X[3]=z,X}function v(d,E){return d[0]=E[0],d[1]=E[1],d[2]=E[2],d[3]=E[3],d}function y(d,E,Q,z,X){return d[0]=E,d[1]=Q,d[2]=z,d[3]=X,d}function S(d,E,Q){return d[0]=E[0]+Q[0],d[1]=E[1]+Q[1],d[2]=E[2]+Q[2],d[3]=E[3]+Q[3],d}function _(d,E,Q){return d[0]=E[0]-Q[0],d[1]=E[1]-Q[1],d[2]=E[2]-Q[2],d[3]=E[3]-Q[3],d}function L(d,E,Q){return d[0]=E[0]*Q[0],d[1]=E[1]*Q[1],d[2]=E[2]*Q[2],d[3]=E[3]*Q[3],d}function F(d,E,Q){return d[0]=E[0]/Q[0],d[1]=E[1]/Q[1],d[2]=E[2]/Q[2],d[3]=E[3]/Q[3],d}function x(d,E){return d[0]=Math.ceil(E[0]),d[1]=Math.ceil(E[1]),d[2]=Math.ceil(E[2]),d[3]=Math.ceil(E[3]),d}function O(d,E){return d[0]=Math.floor(E[0]),d[1]=Math.floor(E[1]),d[2]=Math.floor(E[2]),d[3]=Math.floor(E[3]),d}function R(d,E,Q){return d[0]=Math.min(E[0],Q[0]),d[1]=Math.min(E[1],Q[1]),d[2]=Math.min(E[2],Q[2]),d[3]=Math.min(E[3],Q[3]),d}function I(d,E,Q){return d[0]=Math.max(E[0],Q[0]),d[1]=Math.max(E[1],Q[1]),d[2]=Math.max(E[2],Q[2]),d[3]=Math.max(E[3],Q[3]),d}function l(d,E){return d[0]=Math.round(E[0]),d[1]=Math.round(E[1]),d[2]=Math.round(E[2]),d[3]=Math.round(E[3]),d}function b(d,E,Q){return d[0]=E[0]*Q,d[1]=E[1]*Q,d[2]=E[2]*Q,d[3]=E[3]*Q,d}function Z(d,E,Q,z){return d[0]=E[0]+Q[0]*z,d[1]=E[1]+Q[1]*z,d[2]=E[2]+Q[2]*z,d[3]=E[3]+Q[3]*z,d}function G(d,E){var Q=E[0]-d[0],z=E[1]-d[1],X=E[2]-d[2],$=E[3]-d[3];return Math.sqrt(Q*Q+z*z+X*X+$*$)}function J(d,E){var Q=E[0]-d[0],z=E[1]-d[1],X=E[2]-d[2],$=E[3]-d[3];return Q*Q+z*z+X*X+$*$}function ee(d){var E=d[0],Q=d[1],z=d[2],X=d[3];return Math.sqrt(E*E+Q*Q+z*z+X*X)}function se(d){var E=d[0],Q=d[1],z=d[2],X=d[3];return E*E+Q*Q+z*z+X*X}function Ae(d,E){return d[0]=-E[0],d[1]=-E[1],d[2]=-E[2],d[3]=-E[3],d}function De(d,E){return d[0]=1/E[0],d[1]=1/E[1],d[2]=1/E[2],d[3]=1/E[3],d}function Se(d,E){var Q=E[0],z=E[1],X=E[2],$=E[3],he=Q*Q+z*z+X*X+$*$;return he>0&&(he=1/Math.sqrt(he),d[0]=Q*he,d[1]=z*he,d[2]=X*he,d[3]=$*he),d}function N(d,E){return d[0]*E[0]+d[1]*E[1]+d[2]*E[2]+d[3]*E[3]}function w(d,E,Q,z){var X=E[0],$=E[1],he=E[2],de=E[3];return d[0]=X+z*(Q[0]-X),d[1]=$+z*(Q[1]-$),d[2]=he+z*(Q[2]-he),d[3]=de+z*(Q[3]-de),d}function j(d,E){return E=E||1,d[0]=f.RANDOM(),d[1]=f.RANDOM(),d[2]=f.RANDOM(),d[3]=f.RANDOM(),Se(d,d),b(d,d,E),d}function te(d,E,Q){var z=E[0],X=E[1],$=E[2],he=E[3];return d[0]=Q[0]*z+Q[4]*X+Q[8]*$+Q[12]*he,d[1]=Q[1]*z+Q[5]*X+Q[9]*$+Q[13]*he,d[2]=Q[2]*z+Q[6]*X+Q[10]*$+Q[14]*he,d[3]=Q[3]*z+Q[7]*X+Q[11]*$+Q[15]*he,d}function ie(d,E,Q){var z=E[0],X=E[1],$=E[2],he=Q[0],de=Q[1],q=Q[2],K=Q[3],ne=K*z+de*$-q*X,oe=K*X+q*z-he*$,le=K*$+he*X-de*z,s=-he*z-de*X-q*$;return d[0]=ne*K+s*-he+oe*-q-le*-de,d[1]=oe*K+s*-de+le*-he-ne*-q,d[2]=le*K+s*-q+ne*-de-oe*-he,d[3]=E[3],d}function ce(d){return"vec4("+d[0]+", "+d[1]+", "+d[2]+", "+d[3]+")"}function ge(d,E){return d[0]===E[0]&&d[1]===E[1]&&d[2]===E[2]&&d[3]===E[3]}function D(d,E){var Q=d[0],z=d[1],X=d[2],$=d[3],he=E[0],de=E[1],q=E[2],K=E[3];return Math.abs(Q-he)<=f.EPSILON*Math.max(1,Math.abs(Q),Math.abs(he))&&Math.abs(z-de)<=f.EPSILON*Math.max(1,Math.abs(z),Math.abs(de))&&Math.abs(X-q)<=f.EPSILON*Math.max(1,Math.abs(X),Math.abs(q))&&Math.abs($-K)<=f.EPSILON*Math.max(1,Math.abs($),Math.abs(K))}e.sub=_,e.mul=L,e.div=F,e.dist=G,e.sqrDist=J,e.len=ee,e.sqrLen=se,e.forEach=function(){var d=u();return function(E,Q,z,X,$,he){var de=void 0,q=void 0;for(Q||(Q=4),z||(z=0),X?q=Math.min(X*Q+z,E.length):q=E.length,de=z;de<q;de+=Q)d[0]=E[de],d[1]=E[de+1],d[2]=E[de+2],d[3]=E[de+3],$(d,d,he),E[de]=d[0],E[de+1]=d[1],E[de+2]=d[2],E[de+3]=d[3];return E}}()},function(a,e,c){Object.defineProperty(e,"__esModule",{value:!0}),e.vec4=e.vec3=e.vec2=e.quat=e.mat4=e.mat3=e.mat2d=e.mat2=e.glMatrix=void 0;var o=c(0),f=Z(o),h=c(5),u=Z(h),M=c(6),m=Z(M),v=c(1),y=Z(v),S=c(7),_=Z(S),L=c(8),F=Z(L),x=c(9),O=Z(x),R=c(2),I=Z(R),l=c(3),b=Z(l);function Z(G){if(G&&G.__esModule)return G;var J={};if(G!=null)for(var ee in G)Object.prototype.hasOwnProperty.call(G,ee)&&(J[ee]=G[ee]);return J.default=G,J}e.glMatrix=f,e.mat2=u,e.mat2d=m,e.mat3=y,e.mat4=_,e.quat=F,e.vec2=O,e.vec3=I,e.vec4=b},function(a,e,c){Object.defineProperty(e,"__esModule",{value:!0}),e.sub=e.mul=void 0,e.create=u,e.clone=M,e.copy=m,e.identity=v,e.fromValues=y,e.set=S,e.transpose=_,e.invert=L,e.adjoint=F,e.determinant=x,e.multiply=O,e.rotate=R,e.scale=I,e.fromRotation=l,e.fromScaling=b,e.str=Z,e.frob=G,e.LDU=J,e.add=ee,e.subtract=se,e.exactEquals=Ae,e.equals=De,e.multiplyScalar=Se,e.multiplyScalarAndAdd=N;var o=c(0),f=h(o);function h(w){if(w&&w.__esModule)return w;var j={};if(w!=null)for(var te in w)Object.prototype.hasOwnProperty.call(w,te)&&(j[te]=w[te]);return j.default=w,j}function u(){var w=new f.ARRAY_TYPE(4);return w[0]=1,w[1]=0,w[2]=0,w[3]=1,w}function M(w){var j=new f.ARRAY_TYPE(4);return j[0]=w[0],j[1]=w[1],j[2]=w[2],j[3]=w[3],j}function m(w,j){return w[0]=j[0],w[1]=j[1],w[2]=j[2],w[3]=j[3],w}function v(w){return w[0]=1,w[1]=0,w[2]=0,w[3]=1,w}function y(w,j,te,ie){var ce=new f.ARRAY_TYPE(4);return ce[0]=w,ce[1]=j,ce[2]=te,ce[3]=ie,ce}function S(w,j,te,ie,ce){return w[0]=j,w[1]=te,w[2]=ie,w[3]=ce,w}function _(w,j){if(w===j){var te=j[1];w[1]=j[2],w[2]=te}else w[0]=j[0],w[1]=j[2],w[2]=j[1],w[3]=j[3];return w}function L(w,j){var te=j[0],ie=j[1],ce=j[2],ge=j[3],D=te*ge-ce*ie;return D?(D=1/D,w[0]=ge*D,w[1]=-ie*D,w[2]=-ce*D,w[3]=te*D,w):null}function F(w,j){var te=j[0];return w[0]=j[3],w[1]=-j[1],w[2]=-j[2],w[3]=te,w}function x(w){return w[0]*w[3]-w[2]*w[1]}function O(w,j,te){var ie=j[0],ce=j[1],ge=j[2],D=j[3],d=te[0],E=te[1],Q=te[2],z=te[3];return w[0]=ie*d+ge*E,w[1]=ce*d+D*E,w[2]=ie*Q+ge*z,w[3]=ce*Q+D*z,w}function R(w,j,te){var ie=j[0],ce=j[1],ge=j[2],D=j[3],d=Math.sin(te),E=Math.cos(te);return w[0]=ie*E+ge*d,w[1]=ce*E+D*d,w[2]=ie*-d+ge*E,w[3]=ce*-d+D*E,w}function I(w,j,te){var ie=j[0],ce=j[1],ge=j[2],D=j[3],d=te[0],E=te[1];return w[0]=ie*d,w[1]=ce*d,w[2]=ge*E,w[3]=D*E,w}function l(w,j){var te=Math.sin(j),ie=Math.cos(j);return w[0]=ie,w[1]=te,w[2]=-te,w[3]=ie,w}function b(w,j){return w[0]=j[0],w[1]=0,w[2]=0,w[3]=j[1],w}function Z(w){return"mat2("+w[0]+", "+w[1]+", "+w[2]+", "+w[3]+")"}function G(w){return Math.sqrt(Math.pow(w[0],2)+Math.pow(w[1],2)+Math.pow(w[2],2)+Math.pow(w[3],2))}function J(w,j,te,ie){return w[2]=ie[2]/ie[0],te[0]=ie[0],te[1]=ie[1],te[3]=ie[3]-w[2]*te[1],[w,j,te]}function ee(w,j,te){return w[0]=j[0]+te[0],w[1]=j[1]+te[1],w[2]=j[2]+te[2],w[3]=j[3]+te[3],w}function se(w,j,te){return w[0]=j[0]-te[0],w[1]=j[1]-te[1],w[2]=j[2]-te[2],w[3]=j[3]-te[3],w}function Ae(w,j){return w[0]===j[0]&&w[1]===j[1]&&w[2]===j[2]&&w[3]===j[3]}function De(w,j){var te=w[0],ie=w[1],ce=w[2],ge=w[3],D=j[0],d=j[1],E=j[2],Q=j[3];return Math.abs(te-D)<=f.EPSILON*Math.max(1,Math.abs(te),Math.abs(D))&&Math.abs(ie-d)<=f.EPSILON*Math.max(1,Math.abs(ie),Math.abs(d))&&Math.abs(ce-E)<=f.EPSILON*Math.max(1,Math.abs(ce),Math.abs(E))&&Math.abs(ge-Q)<=f.EPSILON*Math.max(1,Math.abs(ge),Math.abs(Q))}function Se(w,j,te){return w[0]=j[0]*te,w[1]=j[1]*te,w[2]=j[2]*te,w[3]=j[3]*te,w}function N(w,j,te,ie){return w[0]=j[0]+te[0]*ie,w[1]=j[1]+te[1]*ie,w[2]=j[2]+te[2]*ie,w[3]=j[3]+te[3]*ie,w}e.mul=O,e.sub=se},function(a,e,c){Object.defineProperty(e,"__esModule",{value:!0}),e.sub=e.mul=void 0,e.create=u,e.clone=M,e.copy=m,e.identity=v,e.fromValues=y,e.set=S,e.invert=_,e.determinant=L,e.multiply=F,e.rotate=x,e.scale=O,e.translate=R,e.fromRotation=I,e.fromScaling=l,e.fromTranslation=b,e.str=Z,e.frob=G,e.add=J,e.subtract=ee,e.multiplyScalar=se,e.multiplyScalarAndAdd=Ae,e.exactEquals=De,e.equals=Se;var o=c(0),f=h(o);function h(N){if(N&&N.__esModule)return N;var w={};if(N!=null)for(var j in N)Object.prototype.hasOwnProperty.call(N,j)&&(w[j]=N[j]);return w.default=N,w}function u(){var N=new f.ARRAY_TYPE(6);return N[0]=1,N[1]=0,N[2]=0,N[3]=1,N[4]=0,N[5]=0,N}function M(N){var w=new f.ARRAY_TYPE(6);return w[0]=N[0],w[1]=N[1],w[2]=N[2],w[3]=N[3],w[4]=N[4],w[5]=N[5],w}function m(N,w){return N[0]=w[0],N[1]=w[1],N[2]=w[2],N[3]=w[3],N[4]=w[4],N[5]=w[5],N}function v(N){return N[0]=1,N[1]=0,N[2]=0,N[3]=1,N[4]=0,N[5]=0,N}function y(N,w,j,te,ie,ce){var ge=new f.ARRAY_TYPE(6);return ge[0]=N,ge[1]=w,ge[2]=j,ge[3]=te,ge[4]=ie,ge[5]=ce,ge}function S(N,w,j,te,ie,ce,ge){return N[0]=w,N[1]=j,N[2]=te,N[3]=ie,N[4]=ce,N[5]=ge,N}function _(N,w){var j=w[0],te=w[1],ie=w[2],ce=w[3],ge=w[4],D=w[5],d=j*ce-te*ie;return d?(d=1/d,N[0]=ce*d,N[1]=-te*d,N[2]=-ie*d,N[3]=j*d,N[4]=(ie*D-ce*ge)*d,N[5]=(te*ge-j*D)*d,N):null}function L(N){return N[0]*N[3]-N[1]*N[2]}function F(N,w,j){var te=w[0],ie=w[1],ce=w[2],ge=w[3],D=w[4],d=w[5],E=j[0],Q=j[1],z=j[2],X=j[3],$=j[4],he=j[5];return N[0]=te*E+ce*Q,N[1]=ie*E+ge*Q,N[2]=te*z+ce*X,N[3]=ie*z+ge*X,N[4]=te*$+ce*he+D,N[5]=ie*$+ge*he+d,N}function x(N,w,j){var te=w[0],ie=w[1],ce=w[2],ge=w[3],D=w[4],d=w[5],E=Math.sin(j),Q=Math.cos(j);return N[0]=te*Q+ce*E,N[1]=ie*Q+ge*E,N[2]=te*-E+ce*Q,N[3]=ie*-E+ge*Q,N[4]=D,N[5]=d,N}function O(N,w,j){var te=w[0],ie=w[1],ce=w[2],ge=w[3],D=w[4],d=w[5],E=j[0],Q=j[1];return N[0]=te*E,N[1]=ie*E,N[2]=ce*Q,N[3]=ge*Q,N[4]=D,N[5]=d,N}function R(N,w,j){var te=w[0],ie=w[1],ce=w[2],ge=w[3],D=w[4],d=w[5],E=j[0],Q=j[1];return N[0]=te,N[1]=ie,N[2]=ce,N[3]=ge,N[4]=te*E+ce*Q+D,N[5]=ie*E+ge*Q+d,N}function I(N,w){var j=Math.sin(w),te=Math.cos(w);return N[0]=te,N[1]=j,N[2]=-j,N[3]=te,N[4]=0,N[5]=0,N}function l(N,w){return N[0]=w[0],N[1]=0,N[2]=0,N[3]=w[1],N[4]=0,N[5]=0,N}function b(N,w){return N[0]=1,N[1]=0,N[2]=0,N[3]=1,N[4]=w[0],N[5]=w[1],N}function Z(N){return"mat2d("+N[0]+", "+N[1]+", "+N[2]+", "+N[3]+", "+N[4]+", "+N[5]+")"}function G(N){return Math.sqrt(Math.pow(N[0],2)+Math.pow(N[1],2)+Math.pow(N[2],2)+Math.pow(N[3],2)+Math.pow(N[4],2)+Math.pow(N[5],2)+1)}function J(N,w,j){return N[0]=w[0]+j[0],N[1]=w[1]+j[1],N[2]=w[2]+j[2],N[3]=w[3]+j[3],N[4]=w[4]+j[4],N[5]=w[5]+j[5],N}function ee(N,w,j){return N[0]=w[0]-j[0],N[1]=w[1]-j[1],N[2]=w[2]-j[2],N[3]=w[3]-j[3],N[4]=w[4]-j[4],N[5]=w[5]-j[5],N}function se(N,w,j){return N[0]=w[0]*j,N[1]=w[1]*j,N[2]=w[2]*j,N[3]=w[3]*j,N[4]=w[4]*j,N[5]=w[5]*j,N}function Ae(N,w,j,te){return N[0]=w[0]+j[0]*te,N[1]=w[1]+j[1]*te,N[2]=w[2]+j[2]*te,N[3]=w[3]+j[3]*te,N[4]=w[4]+j[4]*te,N[5]=w[5]+j[5]*te,N}function De(N,w){return N[0]===w[0]&&N[1]===w[1]&&N[2]===w[2]&&N[3]===w[3]&&N[4]===w[4]&&N[5]===w[5]}function Se(N,w){var j=N[0],te=N[1],ie=N[2],ce=N[3],ge=N[4],D=N[5],d=w[0],E=w[1],Q=w[2],z=w[3],X=w[4],$=w[5];return Math.abs(j-d)<=f.EPSILON*Math.max(1,Math.abs(j),Math.abs(d))&&Math.abs(te-E)<=f.EPSILON*Math.max(1,Math.abs(te),Math.abs(E))&&Math.abs(ie-Q)<=f.EPSILON*Math.max(1,Math.abs(ie),Math.abs(Q))&&Math.abs(ce-z)<=f.EPSILON*Math.max(1,Math.abs(ce),Math.abs(z))&&Math.abs(ge-X)<=f.EPSILON*Math.max(1,Math.abs(ge),Math.abs(X))&&Math.abs(D-$)<=f.EPSILON*Math.max(1,Math.abs(D),Math.abs($))}e.mul=F,e.sub=ee},function(a,e,c){Object.defineProperty(e,"__esModule",{value:!0}),e.sub=e.mul=void 0,e.create=u,e.clone=M,e.copy=m,e.fromValues=v,e.set=y,e.identity=S,e.transpose=_,e.invert=L,e.adjoint=F,e.determinant=x,e.multiply=O,e.translate=R,e.scale=I,e.rotate=l,e.rotateX=b,e.rotateY=Z,e.rotateZ=G,e.fromTranslation=J,e.fromScaling=ee,e.fromRotation=se,e.fromXRotation=Ae,e.fromYRotation=De,e.fromZRotation=Se,e.fromRotationTranslation=N,e.getTranslation=w,e.getScaling=j,e.getRotation=te,e.fromRotationTranslationScale=ie,e.fromRotationTranslationScaleOrigin=ce,e.fromQuat=ge,e.frustum=D,e.perspective=d,e.perspectiveFromFieldOfView=E,e.ortho=Q,e.lookAt=z,e.targetTo=X,e.str=$,e.frob=he,e.add=de,e.subtract=q,e.multiplyScalar=K,e.multiplyScalarAndAdd=ne,e.exactEquals=oe,e.equals=le;var o=c(0),f=h(o);function h(s){if(s&&s.__esModule)return s;var g={};if(s!=null)for(var H in s)Object.prototype.hasOwnProperty.call(s,H)&&(g[H]=s[H]);return g.default=s,g}function u(){var s=new f.ARRAY_TYPE(16);return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function M(s){var g=new f.ARRAY_TYPE(16);return g[0]=s[0],g[1]=s[1],g[2]=s[2],g[3]=s[3],g[4]=s[4],g[5]=s[5],g[6]=s[6],g[7]=s[7],g[8]=s[8],g[9]=s[9],g[10]=s[10],g[11]=s[11],g[12]=s[12],g[13]=s[13],g[14]=s[14],g[15]=s[15],g}function m(s,g){return s[0]=g[0],s[1]=g[1],s[2]=g[2],s[3]=g[3],s[4]=g[4],s[5]=g[5],s[6]=g[6],s[7]=g[7],s[8]=g[8],s[9]=g[9],s[10]=g[10],s[11]=g[11],s[12]=g[12],s[13]=g[13],s[14]=g[14],s[15]=g[15],s}function v(s,g,H,Y,re,ae,fe,ue,me,ve,ye,Ce,Me,we,xe,_e){var pe=new f.ARRAY_TYPE(16);return pe[0]=s,pe[1]=g,pe[2]=H,pe[3]=Y,pe[4]=re,pe[5]=ae,pe[6]=fe,pe[7]=ue,pe[8]=me,pe[9]=ve,pe[10]=ye,pe[11]=Ce,pe[12]=Me,pe[13]=we,pe[14]=xe,pe[15]=_e,pe}function y(s,g,H,Y,re,ae,fe,ue,me,ve,ye,Ce,Me,we,xe,_e,pe){return s[0]=g,s[1]=H,s[2]=Y,s[3]=re,s[4]=ae,s[5]=fe,s[6]=ue,s[7]=me,s[8]=ve,s[9]=ye,s[10]=Ce,s[11]=Me,s[12]=we,s[13]=xe,s[14]=_e,s[15]=pe,s}function S(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function _(s,g){if(s===g){var H=g[1],Y=g[2],re=g[3],ae=g[6],fe=g[7],ue=g[11];s[1]=g[4],s[2]=g[8],s[3]=g[12],s[4]=H,s[6]=g[9],s[7]=g[13],s[8]=Y,s[9]=ae,s[11]=g[14],s[12]=re,s[13]=fe,s[14]=ue}else s[0]=g[0],s[1]=g[4],s[2]=g[8],s[3]=g[12],s[4]=g[1],s[5]=g[5],s[6]=g[9],s[7]=g[13],s[8]=g[2],s[9]=g[6],s[10]=g[10],s[11]=g[14],s[12]=g[3],s[13]=g[7],s[14]=g[11],s[15]=g[15];return s}function L(s,g){var H=g[0],Y=g[1],re=g[2],ae=g[3],fe=g[4],ue=g[5],me=g[6],ve=g[7],ye=g[8],Ce=g[9],Me=g[10],we=g[11],xe=g[12],_e=g[13],pe=g[14],be=g[15],Fe=H*ue-Y*fe,Be=H*me-re*fe,Ee=H*ve-ae*fe,Te=Y*me-re*ue,Pe=Y*ve-ae*ue,ke=re*ve-ae*me,qe=ye*_e-Ce*xe,Le=ye*pe-Me*xe,je=ye*be-we*xe,ze=Ce*pe-Me*_e,Oe=Ce*be-we*_e,Ne=Me*be-we*pe,Re=Fe*Ne-Be*Oe+Ee*ze+Te*je-Pe*Le+ke*qe;return Re?(Re=1/Re,s[0]=(ue*Ne-me*Oe+ve*ze)*Re,s[1]=(re*Oe-Y*Ne-ae*ze)*Re,s[2]=(_e*ke-pe*Pe+be*Te)*Re,s[3]=(Me*Pe-Ce*ke-we*Te)*Re,s[4]=(me*je-fe*Ne-ve*Le)*Re,s[5]=(H*Ne-re*je+ae*Le)*Re,s[6]=(pe*Ee-xe*ke-be*Be)*Re,s[7]=(ye*ke-Me*Ee+we*Be)*Re,s[8]=(fe*Oe-ue*je+ve*qe)*Re,s[9]=(Y*je-H*Oe-ae*qe)*Re,s[10]=(xe*Pe-_e*Ee+be*Fe)*Re,s[11]=(Ce*Ee-ye*Pe-we*Fe)*Re,s[12]=(ue*Le-fe*ze-me*qe)*Re,s[13]=(H*ze-Y*Le+re*qe)*Re,s[14]=(_e*Be-xe*Te-pe*Fe)*Re,s[15]=(ye*Te-Ce*Be+Me*Fe)*Re,s):null}function F(s,g){var H=g[0],Y=g[1],re=g[2],ae=g[3],fe=g[4],ue=g[5],me=g[6],ve=g[7],ye=g[8],Ce=g[9],Me=g[10],we=g[11],xe=g[12],_e=g[13],pe=g[14],be=g[15];return s[0]=ue*(Me*be-we*pe)-Ce*(me*be-ve*pe)+_e*(me*we-ve*Me),s[1]=-(Y*(Me*be-we*pe)-Ce*(re*be-ae*pe)+_e*(re*we-ae*Me)),s[2]=Y*(me*be-ve*pe)-ue*(re*be-ae*pe)+_e*(re*ve-ae*me),s[3]=-(Y*(me*we-ve*Me)-ue*(re*we-ae*Me)+Ce*(re*ve-ae*me)),s[4]=-(fe*(Me*be-we*pe)-ye*(me*be-ve*pe)+xe*(me*we-ve*Me)),s[5]=H*(Me*be-we*pe)-ye*(re*be-ae*pe)+xe*(re*we-ae*Me),s[6]=-(H*(me*be-ve*pe)-fe*(re*be-ae*pe)+xe*(re*ve-ae*me)),s[7]=H*(me*we-ve*Me)-fe*(re*we-ae*Me)+ye*(re*ve-ae*me),s[8]=fe*(Ce*be-we*_e)-ye*(ue*be-ve*_e)+xe*(ue*we-ve*Ce),s[9]=-(H*(Ce*be-we*_e)-ye*(Y*be-ae*_e)+xe*(Y*we-ae*Ce)),s[10]=H*(ue*be-ve*_e)-fe*(Y*be-ae*_e)+xe*(Y*ve-ae*ue),s[11]=-(H*(ue*we-ve*Ce)-fe*(Y*we-ae*Ce)+ye*(Y*ve-ae*ue)),s[12]=-(fe*(Ce*pe-Me*_e)-ye*(ue*pe-me*_e)+xe*(ue*Me-me*Ce)),s[13]=H*(Ce*pe-Me*_e)-ye*(Y*pe-re*_e)+xe*(Y*Me-re*Ce),s[14]=-(H*(ue*pe-me*_e)-fe*(Y*pe-re*_e)+xe*(Y*me-re*ue)),s[15]=H*(ue*Me-me*Ce)-fe*(Y*Me-re*Ce)+ye*(Y*me-re*ue),s}function x(s){var g=s[0],H=s[1],Y=s[2],re=s[3],ae=s[4],fe=s[5],ue=s[6],me=s[7],ve=s[8],ye=s[9],Ce=s[10],Me=s[11],we=s[12],xe=s[13],_e=s[14],pe=s[15],be=g*fe-H*ae,Fe=g*ue-Y*ae,Be=g*me-re*ae,Ee=H*ue-Y*fe,Te=H*me-re*fe,Pe=Y*me-re*ue,ke=ve*xe-ye*we,qe=ve*_e-Ce*we,Le=ve*pe-Me*we,je=ye*_e-Ce*xe,ze=ye*pe-Me*xe,Oe=Ce*pe-Me*_e;return be*Oe-Fe*ze+Be*je+Ee*Le-Te*qe+Pe*ke}function O(s,g,H){var Y=g[0],re=g[1],ae=g[2],fe=g[3],ue=g[4],me=g[5],ve=g[6],ye=g[7],Ce=g[8],Me=g[9],we=g[10],xe=g[11],_e=g[12],pe=g[13],be=g[14],Fe=g[15],Be=H[0],Ee=H[1],Te=H[2],Pe=H[3];return s[0]=Be*Y+Ee*ue+Te*Ce+Pe*_e,s[1]=Be*re+Ee*me+Te*Me+Pe*pe,s[2]=Be*ae+Ee*ve+Te*we+Pe*be,s[3]=Be*fe+Ee*ye+Te*xe+Pe*Fe,Be=H[4],Ee=H[5],Te=H[6],Pe=H[7],s[4]=Be*Y+Ee*ue+Te*Ce+Pe*_e,s[5]=Be*re+Ee*me+Te*Me+Pe*pe,s[6]=Be*ae+Ee*ve+Te*we+Pe*be,s[7]=Be*fe+Ee*ye+Te*xe+Pe*Fe,Be=H[8],Ee=H[9],Te=H[10],Pe=H[11],s[8]=Be*Y+Ee*ue+Te*Ce+Pe*_e,s[9]=Be*re+Ee*me+Te*Me+Pe*pe,s[10]=Be*ae+Ee*ve+Te*we+Pe*be,s[11]=Be*fe+Ee*ye+Te*xe+Pe*Fe,Be=H[12],Ee=H[13],Te=H[14],Pe=H[15],s[12]=Be*Y+Ee*ue+Te*Ce+Pe*_e,s[13]=Be*re+Ee*me+Te*Me+Pe*pe,s[14]=Be*ae+Ee*ve+Te*we+Pe*be,s[15]=Be*fe+Ee*ye+Te*xe+Pe*Fe,s}function R(s,g,H){var Y=H[0],re=H[1],ae=H[2],fe=void 0,ue=void 0,me=void 0,ve=void 0,ye=void 0,Ce=void 0,Me=void 0,we=void 0,xe=void 0,_e=void 0,pe=void 0,be=void 0;return g===s?(s[12]=g[0]*Y+g[4]*re+g[8]*ae+g[12],s[13]=g[1]*Y+g[5]*re+g[9]*ae+g[13],s[14]=g[2]*Y+g[6]*re+g[10]*ae+g[14],s[15]=g[3]*Y+g[7]*re+g[11]*ae+g[15]):(fe=g[0],ue=g[1],me=g[2],ve=g[3],ye=g[4],Ce=g[5],Me=g[6],we=g[7],xe=g[8],_e=g[9],pe=g[10],be=g[11],s[0]=fe,s[1]=ue,s[2]=me,s[3]=ve,s[4]=ye,s[5]=Ce,s[6]=Me,s[7]=we,s[8]=xe,s[9]=_e,s[10]=pe,s[11]=be,s[12]=fe*Y+ye*re+xe*ae+g[12],s[13]=ue*Y+Ce*re+_e*ae+g[13],s[14]=me*Y+Me*re+pe*ae+g[14],s[15]=ve*Y+we*re+be*ae+g[15]),s}function I(s,g,H){var Y=H[0],re=H[1],ae=H[2];return s[0]=g[0]*Y,s[1]=g[1]*Y,s[2]=g[2]*Y,s[3]=g[3]*Y,s[4]=g[4]*re,s[5]=g[5]*re,s[6]=g[6]*re,s[7]=g[7]*re,s[8]=g[8]*ae,s[9]=g[9]*ae,s[10]=g[10]*ae,s[11]=g[11]*ae,s[12]=g[12],s[13]=g[13],s[14]=g[14],s[15]=g[15],s}function l(s,g,H,Y){var re=Y[0],ae=Y[1],fe=Y[2],ue=Math.sqrt(re*re+ae*ae+fe*fe),me=void 0,ve=void 0,ye=void 0,Ce=void 0,Me=void 0,we=void 0,xe=void 0,_e=void 0,pe=void 0,be=void 0,Fe=void 0,Be=void 0,Ee=void 0,Te=void 0,Pe=void 0,ke=void 0,qe=void 0,Le=void 0,je=void 0,ze=void 0,Oe=void 0,Ne=void 0,Re=void 0,Ie=void 0;return Math.abs(ue)<f.EPSILON?null:(ue=1/ue,re*=ue,ae*=ue,fe*=ue,me=Math.sin(H),ve=Math.cos(H),ye=1-ve,Ce=g[0],Me=g[1],we=g[2],xe=g[3],_e=g[4],pe=g[5],be=g[6],Fe=g[7],Be=g[8],Ee=g[9],Te=g[10],Pe=g[11],ke=re*re*ye+ve,qe=ae*re*ye+fe*me,Le=fe*re*ye-ae*me,je=re*ae*ye-fe*me,ze=ae*ae*ye+ve,Oe=fe*ae*ye+re*me,Ne=re*fe*ye+ae*me,Re=ae*fe*ye-re*me,Ie=fe*fe*ye+ve,s[0]=Ce*ke+_e*qe+Be*Le,s[1]=Me*ke+pe*qe+Ee*Le,s[2]=we*ke+be*qe+Te*Le,s[3]=xe*ke+Fe*qe+Pe*Le,s[4]=Ce*je+_e*ze+Be*Oe,s[5]=Me*je+pe*ze+Ee*Oe,s[6]=we*je+be*ze+Te*Oe,s[7]=xe*je+Fe*ze+Pe*Oe,s[8]=Ce*Ne+_e*Re+Be*Ie,s[9]=Me*Ne+pe*Re+Ee*Ie,s[10]=we*Ne+be*Re+Te*Ie,s[11]=xe*Ne+Fe*Re+Pe*Ie,g!==s&&(s[12]=g[12],s[13]=g[13],s[14]=g[14],s[15]=g[15]),s)}function b(s,g,H){var Y=Math.sin(H),re=Math.cos(H),ae=g[4],fe=g[5],ue=g[6],me=g[7],ve=g[8],ye=g[9],Ce=g[10],Me=g[11];return g!==s&&(s[0]=g[0],s[1]=g[1],s[2]=g[2],s[3]=g[3],s[12]=g[12],s[13]=g[13],s[14]=g[14],s[15]=g[15]),s[4]=ae*re+ve*Y,s[5]=fe*re+ye*Y,s[6]=ue*re+Ce*Y,s[7]=me*re+Me*Y,s[8]=ve*re-ae*Y,s[9]=ye*re-fe*Y,s[10]=Ce*re-ue*Y,s[11]=Me*re-me*Y,s}function Z(s,g,H){var Y=Math.sin(H),re=Math.cos(H),ae=g[0],fe=g[1],ue=g[2],me=g[3],ve=g[8],ye=g[9],Ce=g[10],Me=g[11];return g!==s&&(s[4]=g[4],s[5]=g[5],s[6]=g[6],s[7]=g[7],s[12]=g[12],s[13]=g[13],s[14]=g[14],s[15]=g[15]),s[0]=ae*re-ve*Y,s[1]=fe*re-ye*Y,s[2]=ue*re-Ce*Y,s[3]=me*re-Me*Y,s[8]=ae*Y+ve*re,s[9]=fe*Y+ye*re,s[10]=ue*Y+Ce*re,s[11]=me*Y+Me*re,s}function G(s,g,H){var Y=Math.sin(H),re=Math.cos(H),ae=g[0],fe=g[1],ue=g[2],me=g[3],ve=g[4],ye=g[5],Ce=g[6],Me=g[7];return g!==s&&(s[8]=g[8],s[9]=g[9],s[10]=g[10],s[11]=g[11],s[12]=g[12],s[13]=g[13],s[14]=g[14],s[15]=g[15]),s[0]=ae*re+ve*Y,s[1]=fe*re+ye*Y,s[2]=ue*re+Ce*Y,s[3]=me*re+Me*Y,s[4]=ve*re-ae*Y,s[5]=ye*re-fe*Y,s[6]=Ce*re-ue*Y,s[7]=Me*re-me*Y,s}function J(s,g){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=g[0],s[13]=g[1],s[14]=g[2],s[15]=1,s}function ee(s,g){return s[0]=g[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=g[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=g[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function se(s,g,H){var Y=H[0],re=H[1],ae=H[2],fe=Math.sqrt(Y*Y+re*re+ae*ae),ue=void 0,me=void 0,ve=void 0;return Math.abs(fe)<f.EPSILON?null:(fe=1/fe,Y*=fe,re*=fe,ae*=fe,ue=Math.sin(g),me=Math.cos(g),ve=1-me,s[0]=Y*Y*ve+me,s[1]=re*Y*ve+ae*ue,s[2]=ae*Y*ve-re*ue,s[3]=0,s[4]=Y*re*ve-ae*ue,s[5]=re*re*ve+me,s[6]=ae*re*ve+Y*ue,s[7]=0,s[8]=Y*ae*ve+re*ue,s[9]=re*ae*ve-Y*ue,s[10]=ae*ae*ve+me,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s)}function Ae(s,g){var H=Math.sin(g),Y=Math.cos(g);return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=Y,s[6]=H,s[7]=0,s[8]=0,s[9]=-H,s[10]=Y,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function De(s,g){var H=Math.sin(g),Y=Math.cos(g);return s[0]=Y,s[1]=0,s[2]=-H,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=H,s[9]=0,s[10]=Y,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Se(s,g){var H=Math.sin(g),Y=Math.cos(g);return s[0]=Y,s[1]=H,s[2]=0,s[3]=0,s[4]=-H,s[5]=Y,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function N(s,g,H){var Y=g[0],re=g[1],ae=g[2],fe=g[3],ue=Y+Y,me=re+re,ve=ae+ae,ye=Y*ue,Ce=Y*me,Me=Y*ve,we=re*me,xe=re*ve,_e=ae*ve,pe=fe*ue,be=fe*me,Fe=fe*ve;return s[0]=1-(we+_e),s[1]=Ce+Fe,s[2]=Me-be,s[3]=0,s[4]=Ce-Fe,s[5]=1-(ye+_e),s[6]=xe+pe,s[7]=0,s[8]=Me+be,s[9]=xe-pe,s[10]=1-(ye+we),s[11]=0,s[12]=H[0],s[13]=H[1],s[14]=H[2],s[15]=1,s}function w(s,g){return s[0]=g[12],s[1]=g[13],s[2]=g[14],s}function j(s,g){var H=g[0],Y=g[1],re=g[2],ae=g[4],fe=g[5],ue=g[6],me=g[8],ve=g[9],ye=g[10];return s[0]=Math.sqrt(H*H+Y*Y+re*re),s[1]=Math.sqrt(ae*ae+fe*fe+ue*ue),s[2]=Math.sqrt(me*me+ve*ve+ye*ye),s}function te(s,g){var H=g[0]+g[5]+g[10],Y=0;return H>0?(Y=Math.sqrt(H+1)*2,s[3]=.25*Y,s[0]=(g[6]-g[9])/Y,s[1]=(g[8]-g[2])/Y,s[2]=(g[1]-g[4])/Y):g[0]>g[5]&g[0]>g[10]?(Y=Math.sqrt(1+g[0]-g[5]-g[10])*2,s[3]=(g[6]-g[9])/Y,s[0]=.25*Y,s[1]=(g[1]+g[4])/Y,s[2]=(g[8]+g[2])/Y):g[5]>g[10]?(Y=Math.sqrt(1+g[5]-g[0]-g[10])*2,s[3]=(g[8]-g[2])/Y,s[0]=(g[1]+g[4])/Y,s[1]=.25*Y,s[2]=(g[6]+g[9])/Y):(Y=Math.sqrt(1+g[10]-g[0]-g[5])*2,s[3]=(g[1]-g[4])/Y,s[0]=(g[8]+g[2])/Y,s[1]=(g[6]+g[9])/Y,s[2]=.25*Y),s}function ie(s,g,H,Y){var re=g[0],ae=g[1],fe=g[2],ue=g[3],me=re+re,ve=ae+ae,ye=fe+fe,Ce=re*me,Me=re*ve,we=re*ye,xe=ae*ve,_e=ae*ye,pe=fe*ye,be=ue*me,Fe=ue*ve,Be=ue*ye,Ee=Y[0],Te=Y[1],Pe=Y[2];return s[0]=(1-(xe+pe))*Ee,s[1]=(Me+Be)*Ee,s[2]=(we-Fe)*Ee,s[3]=0,s[4]=(Me-Be)*Te,s[5]=(1-(Ce+pe))*Te,s[6]=(_e+be)*Te,s[7]=0,s[8]=(we+Fe)*Pe,s[9]=(_e-be)*Pe,s[10]=(1-(Ce+xe))*Pe,s[11]=0,s[12]=H[0],s[13]=H[1],s[14]=H[2],s[15]=1,s}function ce(s,g,H,Y,re){var ae=g[0],fe=g[1],ue=g[2],me=g[3],ve=ae+ae,ye=fe+fe,Ce=ue+ue,Me=ae*ve,we=ae*ye,xe=ae*Ce,_e=fe*ye,pe=fe*Ce,be=ue*Ce,Fe=me*ve,Be=me*ye,Ee=me*Ce,Te=Y[0],Pe=Y[1],ke=Y[2],qe=re[0],Le=re[1],je=re[2];return s[0]=(1-(_e+be))*Te,s[1]=(we+Ee)*Te,s[2]=(xe-Be)*Te,s[3]=0,s[4]=(we-Ee)*Pe,s[5]=(1-(Me+be))*Pe,s[6]=(pe+Fe)*Pe,s[7]=0,s[8]=(xe+Be)*ke,s[9]=(pe-Fe)*ke,s[10]=(1-(Me+_e))*ke,s[11]=0,s[12]=H[0]+qe-(s[0]*qe+s[4]*Le+s[8]*je),s[13]=H[1]+Le-(s[1]*qe+s[5]*Le+s[9]*je),s[14]=H[2]+je-(s[2]*qe+s[6]*Le+s[10]*je),s[15]=1,s}function ge(s,g){var H=g[0],Y=g[1],re=g[2],ae=g[3],fe=H+H,ue=Y+Y,me=re+re,ve=H*fe,ye=Y*fe,Ce=Y*ue,Me=re*fe,we=re*ue,xe=re*me,_e=ae*fe,pe=ae*ue,be=ae*me;return s[0]=1-Ce-xe,s[1]=ye+be,s[2]=Me-pe,s[3]=0,s[4]=ye-be,s[5]=1-ve-xe,s[6]=we+_e,s[7]=0,s[8]=Me+pe,s[9]=we-_e,s[10]=1-ve-Ce,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function D(s,g,H,Y,re,ae,fe){var ue=1/(H-g),me=1/(re-Y),ve=1/(ae-fe);return s[0]=ae*2*ue,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=ae*2*me,s[6]=0,s[7]=0,s[8]=(H+g)*ue,s[9]=(re+Y)*me,s[10]=(fe+ae)*ve,s[11]=-1,s[12]=0,s[13]=0,s[14]=fe*ae*2*ve,s[15]=0,s}function d(s,g,H,Y,re){var ae=1/Math.tan(g/2),fe=1/(Y-re);return s[0]=ae/H,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=ae,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=(re+Y)*fe,s[11]=-1,s[12]=0,s[13]=0,s[14]=2*re*Y*fe,s[15]=0,s}function E(s,g,H,Y){var re=Math.tan(g.upDegrees*Math.PI/180),ae=Math.tan(g.downDegrees*Math.PI/180),fe=Math.tan(g.leftDegrees*Math.PI/180),ue=Math.tan(g.rightDegrees*Math.PI/180),me=2/(fe+ue),ve=2/(re+ae);return s[0]=me,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=ve,s[6]=0,s[7]=0,s[8]=-((fe-ue)*me*.5),s[9]=(re-ae)*ve*.5,s[10]=Y/(H-Y),s[11]=-1,s[12]=0,s[13]=0,s[14]=Y*H/(H-Y),s[15]=0,s}function Q(s,g,H,Y,re,ae,fe){var ue=1/(g-H),me=1/(Y-re),ve=1/(ae-fe);return s[0]=-2*ue,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*me,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*ve,s[11]=0,s[12]=(g+H)*ue,s[13]=(re+Y)*me,s[14]=(fe+ae)*ve,s[15]=1,s}function z(s,g,H,Y){var re=void 0,ae=void 0,fe=void 0,ue=void 0,me=void 0,ve=void 0,ye=void 0,Ce=void 0,Me=void 0,we=void 0,xe=g[0],_e=g[1],pe=g[2],be=Y[0],Fe=Y[1],Be=Y[2],Ee=H[0],Te=H[1],Pe=H[2];return Math.abs(xe-Ee)<f.EPSILON&&Math.abs(_e-Te)<f.EPSILON&&Math.abs(pe-Pe)<f.EPSILON?mat4.identity(s):(ye=xe-Ee,Ce=_e-Te,Me=pe-Pe,we=1/Math.sqrt(ye*ye+Ce*Ce+Me*Me),ye*=we,Ce*=we,Me*=we,re=Fe*Me-Be*Ce,ae=Be*ye-be*Me,fe=be*Ce-Fe*ye,we=Math.sqrt(re*re+ae*ae+fe*fe),we?(we=1/we,re*=we,ae*=we,fe*=we):(re=0,ae=0,fe=0),ue=Ce*fe-Me*ae,me=Me*re-ye*fe,ve=ye*ae-Ce*re,we=Math.sqrt(ue*ue+me*me+ve*ve),we?(we=1/we,ue*=we,me*=we,ve*=we):(ue=0,me=0,ve=0),s[0]=re,s[1]=ue,s[2]=ye,s[3]=0,s[4]=ae,s[5]=me,s[6]=Ce,s[7]=0,s[8]=fe,s[9]=ve,s[10]=Me,s[11]=0,s[12]=-(re*xe+ae*_e+fe*pe),s[13]=-(ue*xe+me*_e+ve*pe),s[14]=-(ye*xe+Ce*_e+Me*pe),s[15]=1,s)}function X(s,g,H,Y){var re=g[0],ae=g[1],fe=g[2],ue=Y[0],me=Y[1],ve=Y[2],ye=re-H[0],Ce=ae-H[1],Me=fe-H[2],we=ye*ye+Ce*Ce+Me*Me;we>0&&(we=1/Math.sqrt(we),ye*=we,Ce*=we,Me*=we);var xe=me*Me-ve*Ce,_e=ve*ye-ue*Me,pe=ue*Ce-me*ye;return s[0]=xe,s[1]=_e,s[2]=pe,s[3]=0,s[4]=Ce*pe-Me*_e,s[5]=Me*xe-ye*pe,s[6]=ye*_e-Ce*xe,s[7]=0,s[8]=ye,s[9]=Ce,s[10]=Me,s[11]=0,s[12]=re,s[13]=ae,s[14]=fe,s[15]=1,s}function $(s){return"mat4("+s[0]+", "+s[1]+", "+s[2]+", "+s[3]+", "+s[4]+", "+s[5]+", "+s[6]+", "+s[7]+", "+s[8]+", "+s[9]+", "+s[10]+", "+s[11]+", "+s[12]+", "+s[13]+", "+s[14]+", "+s[15]+")"}function he(s){return Math.sqrt(Math.pow(s[0],2)+Math.pow(s[1],2)+Math.pow(s[2],2)+Math.pow(s[3],2)+Math.pow(s[4],2)+Math.pow(s[5],2)+Math.pow(s[6],2)+Math.pow(s[7],2)+Math.pow(s[8],2)+Math.pow(s[9],2)+Math.pow(s[10],2)+Math.pow(s[11],2)+Math.pow(s[12],2)+Math.pow(s[13],2)+Math.pow(s[14],2)+Math.pow(s[15],2))}function de(s,g,H){return s[0]=g[0]+H[0],s[1]=g[1]+H[1],s[2]=g[2]+H[2],s[3]=g[3]+H[3],s[4]=g[4]+H[4],s[5]=g[5]+H[5],s[6]=g[6]+H[6],s[7]=g[7]+H[7],s[8]=g[8]+H[8],s[9]=g[9]+H[9],s[10]=g[10]+H[10],s[11]=g[11]+H[11],s[12]=g[12]+H[12],s[13]=g[13]+H[13],s[14]=g[14]+H[14],s[15]=g[15]+H[15],s}function q(s,g,H){return s[0]=g[0]-H[0],s[1]=g[1]-H[1],s[2]=g[2]-H[2],s[3]=g[3]-H[3],s[4]=g[4]-H[4],s[5]=g[5]-H[5],s[6]=g[6]-H[6],s[7]=g[7]-H[7],s[8]=g[8]-H[8],s[9]=g[9]-H[9],s[10]=g[10]-H[10],s[11]=g[11]-H[11],s[12]=g[12]-H[12],s[13]=g[13]-H[13],s[14]=g[14]-H[14],s[15]=g[15]-H[15],s}function K(s,g,H){return s[0]=g[0]*H,s[1]=g[1]*H,s[2]=g[2]*H,s[3]=g[3]*H,s[4]=g[4]*H,s[5]=g[5]*H,s[6]=g[6]*H,s[7]=g[7]*H,s[8]=g[8]*H,s[9]=g[9]*H,s[10]=g[10]*H,s[11]=g[11]*H,s[12]=g[12]*H,s[13]=g[13]*H,s[14]=g[14]*H,s[15]=g[15]*H,s}function ne(s,g,H,Y){return s[0]=g[0]+H[0]*Y,s[1]=g[1]+H[1]*Y,s[2]=g[2]+H[2]*Y,s[3]=g[3]+H[3]*Y,s[4]=g[4]+H[4]*Y,s[5]=g[5]+H[5]*Y,s[6]=g[6]+H[6]*Y,s[7]=g[7]+H[7]*Y,s[8]=g[8]+H[8]*Y,s[9]=g[9]+H[9]*Y,s[10]=g[10]+H[10]*Y,s[11]=g[11]+H[11]*Y,s[12]=g[12]+H[12]*Y,s[13]=g[13]+H[13]*Y,s[14]=g[14]+H[14]*Y,s[15]=g[15]+H[15]*Y,s}function oe(s,g){return s[0]===g[0]&&s[1]===g[1]&&s[2]===g[2]&&s[3]===g[3]&&s[4]===g[4]&&s[5]===g[5]&&s[6]===g[6]&&s[7]===g[7]&&s[8]===g[8]&&s[9]===g[9]&&s[10]===g[10]&&s[11]===g[11]&&s[12]===g[12]&&s[13]===g[13]&&s[14]===g[14]&&s[15]===g[15]}function le(s,g){var H=s[0],Y=s[1],re=s[2],ae=s[3],fe=s[4],ue=s[5],me=s[6],ve=s[7],ye=s[8],Ce=s[9],Me=s[10],we=s[11],xe=s[12],_e=s[13],pe=s[14],be=s[15],Fe=g[0],Be=g[1],Ee=g[2],Te=g[3],Pe=g[4],ke=g[5],qe=g[6],Le=g[7],je=g[8],ze=g[9],Oe=g[10],Ne=g[11],Re=g[12],Ie=g[13],Ve=g[14],Ge=g[15];return Math.abs(H-Fe)<=f.EPSILON*Math.max(1,Math.abs(H),Math.abs(Fe))&&Math.abs(Y-Be)<=f.EPSILON*Math.max(1,Math.abs(Y),Math.abs(Be))&&Math.abs(re-Ee)<=f.EPSILON*Math.max(1,Math.abs(re),Math.abs(Ee))&&Math.abs(ae-Te)<=f.EPSILON*Math.max(1,Math.abs(ae),Math.abs(Te))&&Math.abs(fe-Pe)<=f.EPSILON*Math.max(1,Math.abs(fe),Math.abs(Pe))&&Math.abs(ue-ke)<=f.EPSILON*Math.max(1,Math.abs(ue),Math.abs(ke))&&Math.abs(me-qe)<=f.EPSILON*Math.max(1,Math.abs(me),Math.abs(qe))&&Math.abs(ve-Le)<=f.EPSILON*Math.max(1,Math.abs(ve),Math.abs(Le))&&Math.abs(ye-je)<=f.EPSILON*Math.max(1,Math.abs(ye),Math.abs(je))&&Math.abs(Ce-ze)<=f.EPSILON*Math.max(1,Math.abs(Ce),Math.abs(ze))&&Math.abs(Me-Oe)<=f.EPSILON*Math.max(1,Math.abs(Me),Math.abs(Oe))&&Math.abs(we-Ne)<=f.EPSILON*Math.max(1,Math.abs(we),Math.abs(Ne))&&Math.abs(xe-Re)<=f.EPSILON*Math.max(1,Math.abs(xe),Math.abs(Re))&&Math.abs(_e-Ie)<=f.EPSILON*Math.max(1,Math.abs(_e),Math.abs(Ie))&&Math.abs(pe-Ve)<=f.EPSILON*Math.max(1,Math.abs(pe),Math.abs(Ve))&&Math.abs(be-Ge)<=f.EPSILON*Math.max(1,Math.abs(be),Math.abs(Ge))}e.mul=O,e.sub=q},function(a,e,c){Object.defineProperty(e,"__esModule",{value:!0}),e.setAxes=e.sqlerp=e.rotationTo=e.equals=e.exactEquals=e.normalize=e.sqrLen=e.squaredLength=e.len=e.length=e.lerp=e.dot=e.scale=e.mul=e.add=e.set=e.copy=e.fromValues=e.clone=void 0,e.create=_,e.identity=L,e.setAxisAngle=F,e.getAxisAngle=x,e.multiply=O,e.rotateX=R,e.rotateY=I,e.rotateZ=l,e.calculateW=b,e.slerp=Z,e.invert=G,e.conjugate=J,e.fromMat3=ee,e.fromEuler=se,e.str=Ae;var o=c(0),f=S(o),h=c(1),u=S(h),M=c(2),m=S(M),v=c(3),y=S(v);function S(w){if(w&&w.__esModule)return w;var j={};if(w!=null)for(var te in w)Object.prototype.hasOwnProperty.call(w,te)&&(j[te]=w[te]);return j.default=w,j}function _(){var w=new f.ARRAY_TYPE(4);return w[0]=0,w[1]=0,w[2]=0,w[3]=1,w}function L(w){return w[0]=0,w[1]=0,w[2]=0,w[3]=1,w}function F(w,j,te){te=te*.5;var ie=Math.sin(te);return w[0]=ie*j[0],w[1]=ie*j[1],w[2]=ie*j[2],w[3]=Math.cos(te),w}function x(w,j){var te=Math.acos(j[3])*2,ie=Math.sin(te/2);return ie!=0?(w[0]=j[0]/ie,w[1]=j[1]/ie,w[2]=j[2]/ie):(w[0]=1,w[1]=0,w[2]=0),te}function O(w,j,te){var ie=j[0],ce=j[1],ge=j[2],D=j[3],d=te[0],E=te[1],Q=te[2],z=te[3];return w[0]=ie*z+D*d+ce*Q-ge*E,w[1]=ce*z+D*E+ge*d-ie*Q,w[2]=ge*z+D*Q+ie*E-ce*d,w[3]=D*z-ie*d-ce*E-ge*Q,w}function R(w,j,te){te*=.5;var ie=j[0],ce=j[1],ge=j[2],D=j[3],d=Math.sin(te),E=Math.cos(te);return w[0]=ie*E+D*d,w[1]=ce*E+ge*d,w[2]=ge*E-ce*d,w[3]=D*E-ie*d,w}function I(w,j,te){te*=.5;var ie=j[0],ce=j[1],ge=j[2],D=j[3],d=Math.sin(te),E=Math.cos(te);return w[0]=ie*E-ge*d,w[1]=ce*E+D*d,w[2]=ge*E+ie*d,w[3]=D*E-ce*d,w}function l(w,j,te){te*=.5;var ie=j[0],ce=j[1],ge=j[2],D=j[3],d=Math.sin(te),E=Math.cos(te);return w[0]=ie*E+ce*d,w[1]=ce*E-ie*d,w[2]=ge*E+D*d,w[3]=D*E-ge*d,w}function b(w,j){var te=j[0],ie=j[1],ce=j[2];return w[0]=te,w[1]=ie,w[2]=ce,w[3]=Math.sqrt(Math.abs(1-te*te-ie*ie-ce*ce)),w}function Z(w,j,te,ie){var ce=j[0],ge=j[1],D=j[2],d=j[3],E=te[0],Q=te[1],z=te[2],X=te[3],$=void 0,he=void 0,de=void 0,q=void 0,K=void 0;return he=ce*E+ge*Q+D*z+d*X,he<0&&(he=-he,E=-E,Q=-Q,z=-z,X=-X),1-he>1e-6?($=Math.acos(he),de=Math.sin($),q=Math.sin((1-ie)*$)/de,K=Math.sin(ie*$)/de):(q=1-ie,K=ie),w[0]=q*ce+K*E,w[1]=q*ge+K*Q,w[2]=q*D+K*z,w[3]=q*d+K*X,w}function G(w,j){var te=j[0],ie=j[1],ce=j[2],ge=j[3],D=te*te+ie*ie+ce*ce+ge*ge,d=D?1/D:0;return w[0]=-te*d,w[1]=-ie*d,w[2]=-ce*d,w[3]=ge*d,w}function J(w,j){return w[0]=-j[0],w[1]=-j[1],w[2]=-j[2],w[3]=j[3],w}function ee(w,j){var te=j[0]+j[4]+j[8],ie=void 0;if(te>0)ie=Math.sqrt(te+1),w[3]=.5*ie,ie=.5/ie,w[0]=(j[5]-j[7])*ie,w[1]=(j[6]-j[2])*ie,w[2]=(j[1]-j[3])*ie;else{var ce=0;j[4]>j[0]&&(ce=1),j[8]>j[ce*3+ce]&&(ce=2);var ge=(ce+1)%3,D=(ce+2)%3;ie=Math.sqrt(j[ce*3+ce]-j[ge*3+ge]-j[D*3+D]+1),w[ce]=.5*ie,ie=.5/ie,w[3]=(j[ge*3+D]-j[D*3+ge])*ie,w[ge]=(j[ge*3+ce]+j[ce*3+ge])*ie,w[D]=(j[D*3+ce]+j[ce*3+D])*ie}return w}function se(w,j,te,ie){var ce=.5*Math.PI/180;j*=ce,te*=ce,ie*=ce;var ge=Math.sin(j),D=Math.cos(j),d=Math.sin(te),E=Math.cos(te),Q=Math.sin(ie),z=Math.cos(ie);return w[0]=ge*E*z-D*d*Q,w[1]=D*d*z+ge*E*Q,w[2]=D*E*Q-ge*d*z,w[3]=D*E*z+ge*d*Q,w}function Ae(w){return"quat("+w[0]+", "+w[1]+", "+w[2]+", "+w[3]+")"}e.clone=y.clone,e.fromValues=y.fromValues,e.copy=y.copy,e.set=y.set,e.add=y.add,e.mul=O,e.scale=y.scale,e.dot=y.dot,e.lerp=y.lerp;var De=e.length=y.length;e.len=De;var Se=e.squaredLength=y.squaredLength;e.sqrLen=Se;var N=e.normalize=y.normalize;e.exactEquals=y.exactEquals,e.equals=y.equals,e.rotationTo=function(){var w=m.create(),j=m.fromValues(1,0,0),te=m.fromValues(0,1,0);return function(ie,ce,ge){var D=m.dot(ce,ge);return D<-.999999?(m.cross(w,j,ce),m.len(w)<1e-6&&m.cross(w,te,ce),m.normalize(w,w),F(ie,w,Math.PI),ie):D>.999999?(ie[0]=0,ie[1]=0,ie[2]=0,ie[3]=1,ie):(m.cross(w,ce,ge),ie[0]=w[0],ie[1]=w[1],ie[2]=w[2],ie[3]=1+D,N(ie,ie))}}(),e.sqlerp=function(){var w=_(),j=_();return function(te,ie,ce,ge,D,d){return Z(w,ie,D,d),Z(j,ce,ge,d),Z(te,w,j,2*d*(1-d)),te}}(),e.setAxes=function(){var w=u.create();return function(j,te,ie,ce){return w[0]=ie[0],w[3]=ie[1],w[6]=ie[2],w[1]=ce[0],w[4]=ce[1],w[7]=ce[2],w[2]=-te[0],w[5]=-te[1],w[8]=-te[2],N(j,ee(j,w))}}()},function(a,e,c){Object.defineProperty(e,"__esModule",{value:!0}),e.forEach=e.sqrLen=e.sqrDist=e.dist=e.div=e.mul=e.sub=e.len=void 0,e.create=u,e.clone=M,e.fromValues=m,e.copy=v,e.set=y,e.add=S,e.subtract=_,e.multiply=L,e.divide=F,e.ceil=x,e.floor=O,e.min=R,e.max=I,e.round=l,e.scale=b,e.scaleAndAdd=Z,e.distance=G,e.squaredDistance=J,e.length=ee,e.squaredLength=se,e.negate=Ae,e.inverse=De,e.normalize=Se,e.dot=N,e.cross=w,e.lerp=j,e.random=te,e.transformMat2=ie,e.transformMat2d=ce,e.transformMat3=ge,e.transformMat4=D,e.str=d,e.exactEquals=E,e.equals=Q;var o=c(0),f=h(o);function h(z){if(z&&z.__esModule)return z;var X={};if(z!=null)for(var $ in z)Object.prototype.hasOwnProperty.call(z,$)&&(X[$]=z[$]);return X.default=z,X}function u(){var z=new f.ARRAY_TYPE(2);return z[0]=0,z[1]=0,z}function M(z){var X=new f.ARRAY_TYPE(2);return X[0]=z[0],X[1]=z[1],X}function m(z,X){var $=new f.ARRAY_TYPE(2);return $[0]=z,$[1]=X,$}function v(z,X){return z[0]=X[0],z[1]=X[1],z}function y(z,X,$){return z[0]=X,z[1]=$,z}function S(z,X,$){return z[0]=X[0]+$[0],z[1]=X[1]+$[1],z}function _(z,X,$){return z[0]=X[0]-$[0],z[1]=X[1]-$[1],z}function L(z,X,$){return z[0]=X[0]*$[0],z[1]=X[1]*$[1],z}function F(z,X,$){return z[0]=X[0]/$[0],z[1]=X[1]/$[1],z}function x(z,X){return z[0]=Math.ceil(X[0]),z[1]=Math.ceil(X[1]),z}function O(z,X){return z[0]=Math.floor(X[0]),z[1]=Math.floor(X[1]),z}function R(z,X,$){return z[0]=Math.min(X[0],$[0]),z[1]=Math.min(X[1],$[1]),z}function I(z,X,$){return z[0]=Math.max(X[0],$[0]),z[1]=Math.max(X[1],$[1]),z}function l(z,X){return z[0]=Math.round(X[0]),z[1]=Math.round(X[1]),z}function b(z,X,$){return z[0]=X[0]*$,z[1]=X[1]*$,z}function Z(z,X,$,he){return z[0]=X[0]+$[0]*he,z[1]=X[1]+$[1]*he,z}function G(z,X){var $=X[0]-z[0],he=X[1]-z[1];return Math.sqrt($*$+he*he)}function J(z,X){var $=X[0]-z[0],he=X[1]-z[1];return $*$+he*he}function ee(z){var X=z[0],$=z[1];return Math.sqrt(X*X+$*$)}function se(z){var X=z[0],$=z[1];return X*X+$*$}function Ae(z,X){return z[0]=-X[0],z[1]=-X[1],z}function De(z,X){return z[0]=1/X[0],z[1]=1/X[1],z}function Se(z,X){var $=X[0],he=X[1],de=$*$+he*he;return de>0&&(de=1/Math.sqrt(de),z[0]=X[0]*de,z[1]=X[1]*de),z}function N(z,X){return z[0]*X[0]+z[1]*X[1]}function w(z,X,$){var he=X[0]*$[1]-X[1]*$[0];return z[0]=z[1]=0,z[2]=he,z}function j(z,X,$,he){var de=X[0],q=X[1];return z[0]=de+he*($[0]-de),z[1]=q+he*($[1]-q),z}function te(z,X){X=X||1;var $=f.RANDOM()*2*Math.PI;return z[0]=Math.cos($)*X,z[1]=Math.sin($)*X,z}function ie(z,X,$){var he=X[0],de=X[1];return z[0]=$[0]*he+$[2]*de,z[1]=$[1]*he+$[3]*de,z}function ce(z,X,$){var he=X[0],de=X[1];return z[0]=$[0]*he+$[2]*de+$[4],z[1]=$[1]*he+$[3]*de+$[5],z}function ge(z,X,$){var he=X[0],de=X[1];return z[0]=$[0]*he+$[3]*de+$[6],z[1]=$[1]*he+$[4]*de+$[7],z}function D(z,X,$){var he=X[0],de=X[1];return z[0]=$[0]*he+$[4]*de+$[12],z[1]=$[1]*he+$[5]*de+$[13],z}function d(z){return"vec2("+z[0]+", "+z[1]+")"}function E(z,X){return z[0]===X[0]&&z[1]===X[1]}function Q(z,X){var $=z[0],he=z[1],de=X[0],q=X[1];return Math.abs($-de)<=f.EPSILON*Math.max(1,Math.abs($),Math.abs(de))&&Math.abs(he-q)<=f.EPSILON*Math.max(1,Math.abs(he),Math.abs(q))}e.len=ee,e.sub=_,e.mul=L,e.div=F,e.dist=G,e.sqrDist=J,e.sqrLen=se,e.forEach=function(){var z=u();return function(X,$,he,de,q,K){var ne=void 0,oe=void 0;for($||($=2),he||(he=0),de?oe=Math.min(de*$+he,X.length):oe=X.length,ne=he;ne<oe;ne+=$)z[0]=X[ne],z[1]=X[ne+1],q(z,z,K),X[ne]=z[0],X[ne+1]=z[1];return X}}()}])})},{}],9:[function(n,r,i){/**
 * AUTHOR OF INITIAL JS LIBRARY
 * k-d Tree JavaScript - V 1.0
 *
 * https://github.com/ubilabs/kd-tree-javascript
 *
 * @author Mircea Pricop <pricop@ubilabs.net>, 2012
 * @author Martin Kleppe <kleppe@ubilabs.net>, 2012
 * @author Ubilabs http://ubilabs.net, 2012
 * @license MIT License <http://www.opensource.org/licenses/mit-license.php>
 */function a(o,f,h){this.obj=o,this.left=null,this.right=null,this.parent=h,this.dimension=f}function e(o,f,h){var u=this;function M(m,v,y){var S=v%h.length,_,L;return m.length===0?null:m.length===1?new a(m[0],S,y):(m.sort(function(F,x){return F[h[S]]-x[h[S]]}),_=Math.floor(m.length/2),L=new a(m[_],S,y),L.left=M(m.slice(0,_),v+1,L),L.right=M(m.slice(_+1),v+1,L),L)}this.root=M(o,0,null),this.insert=function(m){function v(L,F){if(L===null)return F;var x=h[L.dimension];return m[x]<L.obj[x]?v(L.left,L):v(L.right,L)}var y=v(this.root,null),S,_;if(y===null){this.root=new a(m,0,null);return}S=new a(m,(y.dimension+1)%h.length,y),_=h[y.dimension],m[_]<y.obj[_]?y.left=S:y.right=S},this.remove=function(m){var v;function y(_){if(_===null)return null;if(_.obj===m)return _;var L=h[_.dimension];return m[L]<_.obj[L]?y(_.left):y(_.right)}function S(_){var L,F,x;function O(I,l){var b,Z,G,J,ee;return I===null?null:(b=h[l],I.dimension===l?I.right!==null?O(I.right,l):I:(Z=I.obj[b],G=O(I.left,l),J=O(I.right,l),ee=I,G!==null&&G.obj[b]>Z&&(ee=G),J!==null&&J.obj[b]>ee.obj[b]&&(ee=J),ee))}function R(I,l){var b,Z,G,J,ee;return I===null?null:(b=h[l],I.dimension===l?I.left!==null?R(I.left,l):I:(Z=I.obj[b],G=R(I.left,l),J=R(I.right,l),ee=I,G!==null&&G.obj[b]<Z&&(ee=G),J!==null&&J.obj[b]<ee.obj[b]&&(ee=J),ee))}if(_.left===null&&_.right===null){if(_.parent===null){u.root=null;return}x=h[_.parent.dimension],_.obj[x]<_.parent.obj[x]?_.parent.left=null:_.parent.right=null;return}_.left!==null?L=O(_.left,_.dimension):L=R(_.right,_.dimension),F=L.obj,S(L),_.obj=F}v=y(u.root),v!==null&&S(v)},this.nearest=function(m,v,y){var S,_,L;L=new c(function(x){return-x[1]});function F(x){if(!u.root)return[];var O,R=h[x.dimension],I=f(m,x.obj),l={},b,Z,G;function J(ee,se){L.push([ee,se]),L.size()>v&&L.pop()}for(G=0;G<h.length;G+=1)G===x.dimension?l[h[G]]=m[h[G]]:l[h[G]]=x.obj[h[G]];if(b=f(l,x.obj),x.right===null&&x.left===null){(L.size()<v||I<L.peek()[1])&&J(x,I);return}x.right===null?O=x.left:x.left===null?O=x.right:m[R]<x.obj[R]?O=x.left:O=x.right,F(O),(L.size()<v||I<L.peek()[1])&&J(x,I),(L.size()<v||Math.abs(b)<L.peek()[1])&&(O===x.left?Z=x.right:Z=x.left,Z!==null&&F(Z))}if(y)for(S=0;S<v;S+=1)L.push([null,y]);for(F(u.root),_=[],S=0;S<v&&S<L.content.length;S+=1)L.content[S][0]&&_.push([L.content[S][0].obj,L.content[S][1]]);return _},this.balanceFactor=function(){function m(y){return y===null?0:Math.max(m(y.left),m(y.right))+1}function v(y){return y===null?0:v(y.left)+v(y.right)+1}return m(u.root)/(Math.log(v(u.root))/Math.log(2))}}function c(o){this.content=[],this.scoreFunction=o}c.prototype={push:function(o){this.content.push(o),this.bubbleUp(this.content.length-1)},pop:function(){var o=this.content[0],f=this.content.pop();return this.content.length>0&&(this.content[0]=f,this.sinkDown(0)),o},peek:function(){return this.content[0]},remove:function(o){for(var f=this.content.length,h=0;h<f;h++)if(this.content[h]==o){var u=this.content.pop();h!=f-1&&(this.content[h]=u,this.scoreFunction(u)<this.scoreFunction(o)?this.bubbleUp(h):this.sinkDown(h));return}throw new Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(o){for(var f=this.content[o];o>0;){var h=Math.floor((o+1)/2)-1,u=this.content[h];if(this.scoreFunction(f)<this.scoreFunction(u))this.content[h]=f,this.content[o]=u,o=h;else break}},sinkDown:function(o){for(var f=this.content.length,h=this.content[o],u=this.scoreFunction(h);;){var M=(o+1)*2,m=M-1,v=null;if(m<f){var y=this.content[m],S=this.scoreFunction(y);S<u&&(v=m)}if(M<f){var _=this.content[M],L=this.scoreFunction(_);L<(v==null?u:S)&&(v=M)}if(v!=null)this.content[o]=this.content[v],this.content[v]=h,o=v;else break}}},r.exports={createKdTree:function(o,f,h){return new e(o,f,h)}}},{}],10:[function(n,r,i){r.exports={name:"serve-sofa-hrir",exports:"serveSofaHrir",version:"0.4.2",description:"Utility to fetch and shape sofa formated HRIR from server",main:"./dist/",standalone:"serveSofaHrir",scripts:{lint:"eslint ./src/ ./test/ && jscs --verbose ./src/ ./test/","lint-examples":"eslint -c examples/.eslintrc ./examples/*.html",compile:"rm -rf ./dist && babel ./src/ --out-dir ./dist/",browserify:"browserify ./src/index.js -t [ babelify ] --standalone serveSofaHrir > serveSofaHrir.js",bundle:"npm run lint && npm run test && npm run doc && npm run compile && npm run browserify",doc:"esdoc -c esdoc.json",test:"browserify test/*/*.js -t [ babelify ] --exclude 'test/*/*_listen.js*' --exclude 'test/*/*_issues.js' | tape-run","test-browser":"browserify test/*/*.js -t [ babelify ] --exclude 'test/*/*_listen.js*' --exclude 'test/*/*_issues.js' | testling -u","test-listen":"browserify test/*/*_listen.js -t [ babelify ] | tape-run","test-issues":"browserify test/*/*_issues.js -t [ babelify ] | tape-run",watch:"watch 'npm run browserify && echo $( date ): browserified' ./src/"},authors:["Jean-Philippe.Lambert@ircam.fr","Arnau Juli <arnau.julia@gmail.com>","Samuel.Goldszmidt@ircam.fr","David.Poirier-Quinot@ircam.fr"],license:"BSD-3-Clause",dependencies:{"fractional-delay":"git://github.com/Ircam-RnD/fractional-delay#gh-pages","gl-matrix":"^2.4.0","kd.tree":"akshaylive/node-kdt#39bc780704a324393bca68a17cf7bc71be8544c6"},repository:{type:"git",url:"https://github.com/Ircam-RnD/serveSofaHrir"},engines:{node:"0.12 || 4",npm:">=1.0.0 <3.0.0"},devDependencies:{"babel-cli":"^6.5.1","babel-eslint":"^4.1.8","babel-preset-es2015":"^6.5.0",babelify:"^7.2.0","blue-tape":"^0.1.11",browserify:"^12.0.2",esdoc:"^0.4.6",eslint:"^1.10.3","eslint-config-airbnb":"^1.0.2","eslint-plugin-html":"^1.4.0",jscs:"2.11.0","jscs-jsdoc":"^1.3.1",tape:"^4.4.0","tape-run":"^2.1.2",testling:"^1.7.1",watch:"^0.17.1"}}},{}],11:[function(n,r,i){Object.defineProperty(i,"__esModule",{value:!0}),i.resampleFloat32Array=o;var a=n("fractional-delay"),e=c(a);function c(f){return f&&f.__esModule?f:{default:f}}function o(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},h=new Promise(function(u,M){var m=f.inputSamples,v=f.inputSampleRate,y=typeof f.inputDelay<"u"?f.inputDelay:0,S=typeof f.outputSampleRate<"u"?f.outputSampleRate:v;if(v===S&&y===0)u(new Float32Array(m));else try{var _=Math.ceil(m.length*S/v),L=new window.OfflineAudioContext(1,_,S),F=L.createBuffer(1,m.length,v),x=1,O=new e.default(v,x);O.setDelay(y/v),F.getChannelData(0).set(O.process(m));var R=L.createBufferSource();R.buffer=F,R.connect(L.destination),R.start(),L.oncomplete=function(I){var l=I.renderedBuffer.getChannelData(0);u(l)},L.startRendering()}catch(I){M(new Error("Unable to re-sample Float32Array. "+I.message))}});return h}/**
 * @fileOverview Audio utilities
 * @author Jean-Philippe.Lambert@ircam.fr
 * @copyright 2016 IRCAM, Paris, France
 * @license BSD-3-Clause
 */i.default={resampleFloat32Array:o}},{"fractional-delay":7}],12:[function(n,r,i){Object.defineProperty(i,"__esModule",{value:!0}),i.tree=void 0,i.distanceSquared=o,i.distance=f;var a=n("kd.tree"),e=c(a);function c(h){return h&&h.__esModule?h:{default:h}}i.tree=e.default;/**
 * @fileOverview Helpers for k-d tree.
 * @author Jean-Philippe.Lambert@ircam.fr
 * @copyright 2015-2016 IRCAM, Paris, France
 * @license BSD-3-Clause
 */function o(h,u){var M=u.x-h.x,m=u.y-h.y,v=u.z-h.z;return M*M+m*m+v*v}function f(h,u){return Math.sqrt(this.distanceSquared(h,u))}i.default={distance:f,distanceSquared:o,tree:e.default}},{"kd.tree":9}],13:[function(n,r,i){Object.defineProperty(i,"__esModule",{value:!0}),i.sofaCartesianToGl=o,i.glToSofaCartesian=f,i.sofaCartesianToSofaSpherical=h,i.sofaSphericalToSofaCartesian=u,i.sofaSphericalToGl=M,i.glToSofaSpherical=m,i.sofaToSofaCartesian=v,i.spat4CartesianToGl=y,i.glToSpat4Cartesian=S,i.spat4CartesianToSpat4Spherical=_,i.spat4SphericalToSpat4Cartesian=L,i.spat4SphericalToGl=F,i.glToSpat4Spherical=x,i.systemType=O,i.systemToGl=R,i.glToSystem=I;var a=n("./degree"),e=c(a);function c(l){return l&&l.__esModule?l:{default:l}}function o(l,b){var Z=b[0],G=b[1],J=b[2];return l[0]=0-G,l[1]=J,l[2]=0-Z,l}/**
 * @fileOverview Coordinate systems conversions. openGL, SOFA, and Spat4 (Ircam).
 *
 * @author Jean-Philippe.Lambert@ircam.fr
 * @copyright 2015-2016 IRCAM, Paris, France
 * @license BSD-3-Clause
 */function f(l,b){var Z=b[0],G=b[1],J=b[2];return l[0]=0-J,l[1]=0-Z,l[2]=G,l}function h(l,b){var Z=b[0],G=b[1],J=b[2],ee=Z*Z+G*G;return l[0]=(e.default.atan2(G,Z)+360)%360,l[1]=e.default.atan2(J,Math.sqrt(ee)),l[2]=Math.sqrt(ee+J*J),l}function u(l,b){var Z=b[0],G=b[1],J=b[2],ee=e.default.cos(G);return l[0]=J*ee*e.default.cos(Z),l[1]=J*ee*e.default.sin(Z),l[2]=J*e.default.sin(G),l}function M(l,b){var Z=b[0],G=b[1],J=b[2],ee=e.default.cos(G);return l[0]=0-J*ee*e.default.sin(Z),l[1]=J*e.default.sin(G),l[2]=0-J*ee*e.default.cos(Z),l}function m(l,b){var Z=0-b[2],G=0-b[0],J=b[1],ee=Z*Z+G*G;return l[0]=(e.default.atan2(G,Z)+360)%360,l[1]=e.default.atan2(J,Math.sqrt(ee)),l[2]=Math.sqrt(ee+J*J),l}function v(l,b,Z){switch(Z){case"sofaCartesian":l[0]=b[0],l[1]=b[1],l[2]=b[2];break;case"sofaSpherical":u(l,b);break;default:throw new Error("Bad coordinate system")}return l}function y(l,b){var Z=b[0],G=b[1],J=b[2];return l[0]=Z,l[1]=J,l[2]=0-G,l}function S(l,b){var Z=b[0],G=b[1],J=b[2];return l[0]=Z,l[1]=0-J,l[2]=G,l}function _(l,b){var Z=b[0],G=b[1],J=b[2],ee=Z*Z+G*G;return l[0]=e.default.atan2(Z,G),l[1]=e.default.atan2(J,Math.sqrt(ee)),l[2]=Math.sqrt(ee+J*J),l}function L(l,b){var Z=b[0],G=b[1],J=b[2],ee=e.default.cos(G);return l[0]=J*ee*e.default.sin(Z),l[1]=J*ee*e.default.cos(Z),l[2]=J*e.default.sin(G),l}function F(l,b){var Z=b[0],G=b[1],J=b[2],ee=e.default.cos(G);return l[0]=J*ee*e.default.sin(Z),l[1]=J*e.default.sin(G),l[2]=0-J*ee*e.default.cos(Z),l}function x(l,b){var Z=b[0],G=0-b[2],J=b[1],ee=Z*Z+G*G;return l[0]=e.default.atan2(Z,G),l[1]=e.default.atan2(J,Math.sqrt(ee)),l[2]=Math.sqrt(ee+J*J),l}function O(l){var b=void 0;if(l==="sofaCartesian"||l==="spat4Cartesian"||l==="gl")b="cartesian";else if(l==="sofaSpherical"||l==="spat4Spherical")b="spherical";else throw new Error("Unknown coordinate system type "+l);return b}function R(l,b,Z){switch(Z){case"gl":l[0]=b[0],l[1]=b[1],l[2]=b[2];break;case"sofaCartesian":o(l,b);break;case"sofaSpherical":M(l,b);break;case"spat4Cartesian":y(l,b);break;case"spat4Spherical":F(l,b);break;default:throw new Error("Bad coordinate system")}return l}function I(l,b,Z){switch(Z){case"gl":l[0]=b[0],l[1]=b[1],l[2]=b[2];break;case"sofaCartesian":f(l,b);break;case"sofaSpherical":m(l,b);break;case"spat4Cartesian":S(l,b);break;case"spat4Spherical":x(l,b);break;default:throw new Error("Bad coordinate system")}return l}i.default={glToSofaCartesian:f,glToSofaSpherical:m,glToSpat4Cartesian:S,glToSpat4Spherical:x,glToSystem:I,sofaCartesianToGl:o,sofaCartesianToSofaSpherical:h,sofaSphericalToGl:M,sofaSphericalToSofaCartesian:u,sofaToSofaCartesian:v,spat4CartesianToGl:y,spat4CartesianToSpat4Spherical:_,spat4SphericalToGl:F,spat4SphericalToSpat4Cartesian:L,systemToGl:R,systemType:O}},{"./degree":14}],14:[function(n,r,i){Object.defineProperty(i,"__esModule",{value:!0}),i.toRadian=c,i.fromRadian=o,i.cos=f,i.sin=h,i.atan2=u;/**
 * @fileOverview Convert to and from degree
 * @author Jean-Philippe.Lambert@ircam.fr
 * @copyright 2015-2016 IRCAM, Paris, France
 * @license BSD-3-Clause
 */var a=i.toRadianFactor=Math.PI/180,e=i.fromRadianFactor=1/a;function c(M){return M*a}function o(M){return M*e}function f(M){return Math.cos(M*a)}function h(M){return Math.sin(M*a)}function u(M,m){return Math.atan2(M,m)*e}i.default={atan2:u,cos:f,fromRadian:o,fromRadianFactor:e,sin:h,toRadian:c,toRadianFactor:a}},{}],15:[function(n,r,i){Object.defineProperty(i,"__esModule",{value:!0}),i.ServerDataBase=i.HrtfSet=void 0;var a=n("./sofa/HrtfSet"),e=f(a),c=n("./sofa/ServerDataBase"),o=f(c);function f(h){return h&&h.__esModule?h:{default:h}}i.HrtfSet=e.default,i.ServerDataBase=o.default,i.default={HrtfSet:e.default,ServerDataBase:o.default}},{"./sofa/HrtfSet":17,"./sofa/ServerDataBase":18}],16:[function(n,r,i){Object.defineProperty(i,"__esModule",{value:!0}),i.version=i.name=i.license=i.description=void 0;var a=n("../package.json"),e=c(a);function c(M){return M&&M.__esModule?M:{default:M}}var o=e.default.description;/**
 * @fileOverview Information on the library, from the `package.json` file.
 *
 * @author Jean-Philippe.Lambert@ircam.fr
 * @copyright 2016 IRCAM, Paris, France
 * @license BSD-3-Clause
 */i.description=o;var f=e.default.license;i.license=f;var h=e.default.name;i.name=h;var u=e.default.version;i.version=u,i.default={description:o,license:f,name:h,version:u}},{"../package.json":10}],17:[function(n,r,i){Object.defineProperty(i,"__esModule",{value:!0}),i.HrtfSet=void 0;var a=function(){function R(I,l){for(var b=0;b<l.length;b++){var Z=l[b];Z.enumerable=Z.enumerable||!1,Z.configurable=!0,"value"in Z&&(Z.writable=!0),Object.defineProperty(I,Z.key,Z)}}return function(I,l,b){return l&&R(I.prototype,l),b&&R(I,b),I}}();/**
 * @fileOverview Container for HRTF set: load a set from an URL and get
 * filters from corresponding positions.
 *
 * @author Jean-Philippe.Lambert@ircam.fr
 * @copyright 2015-2016 IRCAM, Paris, France
 * @license BSD-3-Clause
 */var e=n("gl-matrix"),c=L(e),o=n("../info"),f=_(o),h=n("./parseDataSet"),u=n("./parseSofa"),M=n("../geometry/coordinates"),m=_(M),v=n("../geometry/KdTree"),y=_(v),S=n("../audio/utilities");function _(R){return R&&R.__esModule?R:{default:R}}function L(R){if(R&&R.__esModule)return R;var I={};if(R!=null)for(var l in R)Object.prototype.hasOwnProperty.call(R,l)&&(I[l]=R[l]);return I.default=R,I}function F(R){if(Array.isArray(R)){for(var I=0,l=Array(R.length);I<R.length;I++)l[I]=R[I];return l}else return Array.from(R)}function x(R,I){if(!(R instanceof I))throw new TypeError("Cannot call a class as a function")}var O=i.HrtfSet=function(){function R(){var I=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};x(this,R),this._audioContext=I.audioContext,this._ready=!1,this.coordinateSystem=I.coordinateSystem,this.filterCoordinateSystem=I.filterCoordinateSystem,this.filterPositions=I.filterPositions,this.filterAfterLoad=I.filterAfterLoad}return a(R,[{key:"applyFilterPositions",value:function(){var l=this,b=this._filterPositions.map(function(Z){return l._kdt.nearest({x:Z[0],y:Z[1],z:Z[2]},1).pop()[0]});b=[].concat(F(new Set(b))),this._kdt=y.default.tree.createKdTree(b,y.default.distanceSquared,["x","y","z"])}},{key:"load",value:function(l){var b=this,Z=l.split(".").pop(),G=Z==="sofa"?l+".json":l,J=void 0,ee=typeof this._filterPositions<"u"&&!this.filterAfterLoad&&Z==="sofa";return ee?J=Promise.all([this._loadMetaAndPositions(l),this._loadDataSet(l)]).then(function(se){var Ae=se[0],De=se[1];return b._loadSofaPartial(l,Ae,De).then(function(){return b._ready=!0,b})}).catch(function(){return b._loadSofaFull(G).then(function(){return b.applyFilterPositions(),b._ready=!0,b})}):J=this._loadSofaFull(G).then(function(){return typeof b._filterPositions<"u"&&b.filterAfterLoad&&b.applyFilterPositions(),b._ready=!0,b}),J}},{key:"export",value:function(){var l=this,b=void 0,Z=m.default.systemType(this.filterCoordinateSystem);switch(Z){case"cartesian":b=this._sofaSourcePosition.map(function(J){return m.default.glToSofaCartesian([],J)});break;case"spherical":b=this._sofaSourcePosition.map(function(J){return m.default.glToSofaSpherical([],J)});break;default:throw new Error("Bad source position type "+Z+" for export.")}var G=this._sofaSourcePosition.map(function(J){for(var ee=l._kdt.nearest({x:J[0],y:J[1],z:J[2]},1).pop()[0].fir,se=[],Ae=0;Ae<ee.numberOfChannels;++Ae)se.push([].concat(F(ee.getChannelData(Ae))));return se});return(0,u.stringifySofa)({name:this._sofaName,metaData:this._sofaMetaData,ListenerPosition:[0,0,0],ListenerPositionType:"cartesian",ListenerUp:[0,0,1],ListenerUpType:"cartesian",ListenerView:[1,0,0],ListenerViewType:"cartesian",SourcePositionType:Z,SourcePosition:b,DataSamplingRate:this._audioContext.sampleRate,DataDelay:this._sofaDelay,DataIR:G,RoomVolume:this._sofaRoomVolume})}},{key:"nearest",value:function(l){var b=m.default.systemToGl([],l,this.coordinateSystem),Z=this._kdt.nearest({x:b[0],y:b[1],z:b[2]},1).pop(),G=Z[0];return m.default.glToSystem(b,[G.x,G.y,G.z],this.coordinateSystem),{distance:Z[1],fir:G.fir,index:G.index,position:b}}},{key:"nearestFir",value:function(l){return this.nearest(l).fir}},{key:"_createKdTree",value:function(l){var b=this,Z=l.map(function(G){var J=G[2],ee=b._audioContext.createBuffer(J.length,J[0].length,b._audioContext.sampleRate);return J.forEach(function(se,Ae){ee.getChannelData(Ae).set(se)}),{index:G[0],x:G[1][0],y:G[1][1],z:G[1][2],fir:ee}});return this._sofaSourcePosition=Z.map(function(G){return[G.x,G.y,G.z]}),this._kdt=y.default.tree.createKdTree(Z,y.default.distanceSquared,["x","y","z"]),this}},{key:"_generateIndicesPositionsFirs",value:function(l,b,Z,G){var J=this,ee=Z.map(function(se,Ae){var De=se.length;if(De!==2)throw new Error("Bad number of channels"+(" for IR index "+l[Ae])+(" ("+De+" instead of 2)"));if(G[0].length!==2)throw new Error("Bad delay format"+(" for IR index "+l[Ae])+(" (first element in Data.Delay is "+G[0])+" instead of [[delayL, delayR]] )");var Se=typeof G[Ae]<"u"?G[Ae]:G[0],N=se.map(function(w,j){if(Se[j]<0)throw new Error("Negative delay detected (not handled at the moment):"+(" delay index "+l[Ae])+(" channel "+j));return(0,S.resampleFloat32Array)({inputSamples:w,inputDelay:Se[j],inputSampleRate:J._sofaSampleRate,outputSampleRate:J._audioContext.sampleRate})});return Promise.all(N).then(function(w){return[l[Ae],b[Ae],w]}).catch(function(w){throw new Error("Unable to re-sample impulse response "+Ae+". "+w.message)})});return Promise.all(ee)}},{key:"_loadDataSet",value:function(l){var b=new Promise(function(Z,G){var J=l+".dds",ee=new window.XMLHttpRequest;ee.open("GET",J),ee.onerror=function(){G(new Error("Unable to GET "+J+", status "+ee.status+" "+(""+ee.responseText)))},ee.onload=function(){if(ee.status<200||ee.status>=300){ee.onerror();return}try{var se=(0,h.parseDataSet)(ee.response);Z(se)}catch(Ae){G(new Error("Unable to parse "+J+". "+Ae.message))}},ee.send()});return b}},{key:"_loadMetaAndPositions",value:function(l){var b=this,Z=new Promise(function(G,J){var ee=l+".json?ListenerPosition,ListenerUp,ListenerView,SourcePosition,Data.Delay,Data.SamplingRate,EmitterPosition,ReceiverPosition,RoomVolume",se=new window.XMLHttpRequest;se.open("GET",ee),se.onerror=function(){J(new Error("Unable to GET "+ee+", status "+se.status+" "+(""+se.responseText)))},se.onload=function(){if(se.status<200||se.status>=300){se.onerror();return}try{var Ae=(0,u.parseSofa)(se.response);b._setMetaData(Ae,l);var De=b._sourcePositionsToGl(Ae),Se=De.map(function(j,te){return{x:j[0],y:j[1],z:j[2],index:te}}),N=y.default.tree.createKdTree(Se,y.default.distanceSquared,["x","y","z"]),w=b._filterPositions.map(function(j){return N.nearest({x:j[0],y:j[1],z:j[2]},1).pop()[0].index});w=[].concat(F(new Set(w))),b._sofaUrl=l,G(w)}catch(j){J(new Error("Unable to parse "+ee+". "+j.message))}},se.send()});return Z}},{key:"_loadSofaFull",value:function(l){var b=this,Z=new Promise(function(G,J){var ee=new window.XMLHttpRequest;ee.open("GET",l),ee.onerror=function(){J(new Error("Unable to GET "+l+", status "+ee.status+" "+(""+ee.responseText)))},ee.onload=function(){if(ee.status<200||ee.status>=300){ee.onerror();return}try{var se=(0,u.parseSofa)(ee.response);b._setMetaData(se,l);var Ae=b._sourcePositionsToGl(se);b._generateIndicesPositionsFirs(Ae.map(function(De,Se){return Se}),Ae,se["Data.IR"].data,se["Data.Delay"].data).then(function(De){b._createKdTree(De),b._sofaUrl=l,G(b)})}catch(De){J(new Error("Unable to parse "+l+". "+De.message))}},ee.send()});return Z}},{key:"_loadSofaPartial",value:function(l,b,Z){var G=this,J=b.map(function(ee){var se=new Promise(function(Ae,De){var Se=l+".json?"+("SourcePosition["+ee+"][0:1:"+(Z.SourcePosition.C-1)+"],")+("Data.IR["+ee+"][0:1:"+(Z["Data.IR"].R-1)+"]")+("[0:1:"+(Z["Data.IR"].N-1)+"]"),N=new window.XMLHttpRequest;N.open("GET",Se),N.onerror=function(){De(new Error("Unable to GET "+Se+", status "+N.status+" "+(""+N.responseText)))},N.onload=function(){(N.status<200||N.status>=300)&&N.onerror();try{var w=(0,u.parseSofa)(N.response),j=G._sourcePositionsToGl(w);G._generateIndicesPositionsFirs([ee],j,w["Data.IR"].data,w["Data.Delay"].data).then(function(te){Ae(te[0])})}catch(te){De(new Error("Unable to parse "+Se+". "+te.message))}},N.send()});return se});return Promise.all(J).then(function(ee){return G._createKdTree(ee),G})}},{key:"_setMetaData",value:function(l,b){if(typeof l.metaData.DataType<"u"&&l.metaData.DataType!=="FIR")throw new Error("According to meta-data, SOFA data type is not FIR");var Z=new Date().toISOString();this._sofaName=typeof l.name<"u"?""+l.name:"HRTF.sofa",this._sofaMetaData=typeof l.metaData<"u"?l.metaData:{},typeof b<"u"&&(this._sofaMetaData.OriginalUrl=b),this._sofaMetaData.Converter="Ircam "+f.default.name+" "+f.default.version+" javascript API ",this._sofaMetaData.DateConverted=Z,this._sofaSampleRate=typeof l["Data.SamplingRate"]<"u"?l["Data.SamplingRate"].data[0]:48e3,this._sofaSampleRate!==this._audioContext.sampleRate&&(this._sofaMetaData.OriginalSampleRate=this._sofaSampleRate),this._sofaDelay=typeof l["Data.Delay"]<"u"?l["Data.Delay"].data:[0,0],this._sofaRoomVolume=typeof l.RoomVolume<"u"?l.RoomVolume.data[0]:void 0;var G=m.default.sofaToSofaCartesian([],l.ListenerPosition.data[0],(0,u.conformSofaCoordinateSystem)(l.ListenerPosition.Type||"cartesian")),J=m.default.sofaToSofaCartesian([],l.ListenerView.data[0],(0,u.conformSofaCoordinateSystem)(l.ListenerView.Type||"cartesian")),ee=m.default.sofaToSofaCartesian([],l.ListenerUp.data[0],(0,u.conformSofaCoordinateSystem)(l.ListenerUp.Type||"cartesian"));this._sofaToGl=c.mat4.lookAt([],G,J,ee)}},{key:"_sourcePositionsToGl",value:function(l){var b=this,Z=l.SourcePosition.data,G=typeof l.SourcePosition.Type<"u"?l.SourcePosition.Type:"spherical";switch(G){case"cartesian":Z.forEach(function(J){c.vec3.transformMat4(J,J,b._sofaToGl)});break;case"spherical":Z.forEach(function(J){m.default.sofaSphericalToSofaCartesian(J,J),c.vec3.transformMat4(J,J,b._sofaToGl)});break;default:throw new Error("Bad source position type")}return Z}},{key:"coordinateSystem",set:function(l){this._coordinateSystem=typeof l<"u"?l:"gl"},get:function(){return this._coordinateSystem}},{key:"filterCoordinateSystem",set:function(l){this._filterCoordinateSystem=typeof l<"u"?l:this.coordinateSystem},get:function(){return this._filterCoordinateSystem}},{key:"filterPositions",set:function(l){if(typeof l>"u")this._filterPositions=void 0;else switch(this.filterCoordinateSystem){case"gl":this._filterPositions=l.map(function(b){return b.slice(0)});break;case"sofaCartesian":this._filterPositions=l.map(function(b){return m.default.sofaCartesianToGl([],b)});break;case"sofaSpherical":this._filterPositions=l.map(function(b){return m.default.sofaSphericalToGl([],b)});break;default:throw new Error("Bad filter coordinate system")}},get:function(){var l=void 0;if(typeof this._filterPositions<"u")switch(this.filterCoordinateSystem){case"gl":l=this._filterPositions.map(function(b){return b.slice(0)});break;case"sofaCartesian":l=this._filterPositions.map(function(b){return m.default.glToSofaCartesian([],b)});break;case"sofaSpherical":l=this._filterPositions.map(function(b){return m.default.glToSofaSpherical([],b)});break;default:throw new Error("Bad filter coordinate system")}return l}},{key:"filterAfterLoad",set:function(l){this._filterAfterLoad=typeof l<"u"?l:!1},get:function(){return this._filterAfterLoad}},{key:"isReady",get:function(){return this._ready}},{key:"sofaName",get:function(){return this._sofaName}},{key:"sofaUrl",get:function(){return this._sofaUrl}},{key:"sofaSampleRate",get:function(){return this._sofaSampleRate}},{key:"sofaMetaData",get:function(){return this._sofaMetaData}}]),R}();i.default=O},{"../audio/utilities":11,"../geometry/KdTree":12,"../geometry/coordinates":13,"../info":16,"./parseDataSet":19,"./parseSofa":20,"gl-matrix":8}],18:[function(n,r,i){Object.defineProperty(i,"__esModule",{value:!0}),i.ServerDataBase=void 0;var a=function(){function M(m,v){for(var y=0;y<v.length;y++){var S=v[y];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(m,S.key,S)}}return function(m,v,y){return v&&M(m.prototype,v),y&&M(m,y),m}}();/**
 * @fileOverview Access a remote catalogue from a SOFA server, and get URLs
 * with filtering.
 *
 * @author Jean-Philippe.Lambert@ircam.fr
 * @copyright 2015-2016 IRCAM, Paris, France
 * @license BSD-3-Clause
 */var e=n("./parseXml"),c=f(e),o=n("./parseDataSet");function f(M){return M&&M.__esModule?M:{default:M}}function h(M,m){if(!(M instanceof m))throw new TypeError("Cannot call a class as a function")}var u=i.ServerDataBase=function(){function M(){var m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(h(this,M),this._server=m.serverUrl,typeof this._server>"u"){var v=window.location.protocol==="https:"?"https:":"http:";this._server=v+"//bili2.ircam.fr"}this._catalogue={},this._urls=[]}return a(M,[{key:"loadCatalogue",value:function(){var v=this,y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._server+"/catalog.xml",S=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this._catalogue,_=new Promise(function(L,F){var x=new window.XMLHttpRequest;x.open("GET",y),x.onerror=function(){F(new Error("Unable to GET "+y+", status "+x.status+" "+(""+x.responseText)))},x.onload=function(){if(x.status<200||x.status>=300){x.onerror();return}var O=(0,c.default)(x.response),R=O.querySelector("dataset"),I=O.querySelectorAll("dataset > catalogRef");if(I.length===0){S.urls=[];for(var l=O.querySelectorAll("dataset > dataset"),b=0;b<l.length;++b){var Z=v._server+R.getAttribute("name")+"/"+l[b].getAttribute("name");v._urls.push(Z),S.urls.push(Z)}L(y)}else{for(var G=[],J=0;J<I.length;++J){var ee=I[J].getAttribute("name"),se=v._server+R.getAttribute("name")+"/"+I[J].getAttribute("xlink:href");S[ee]={},G.push(v.loadCatalogue(se,S[ee]))}Promise.all(G).then(function(){v._urls.sort(),L(y)}).catch(function(Ae){F(Ae)})}},x.send()});return _}},{key:"getUrls",value:function(){var v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},y=[v.convention,v.dataBase,v.equalisation,v.sampleRate,v.sosOrder],S=typeof v.freePattern=="number"?v.freePattern.toString():v.freePattern,_=y.reduce(function(O,R){return O+"/"+(typeof R<"u"?"[^/]*(?:"+R+")[^/]*":"[^/]*")},""),L=new RegExp(_,"i"),F=this._urls.filter(function(O){return L.test(O)});if(typeof S<"u"){var x=S.split(/\s+/);x.forEach(function(O){L=new RegExp(O,"i"),F=F.filter(function(R){return L.test(R)})})}return F}},{key:"getDataSetDefinitions",value:function(v){var y=new Promise(function(S,_){var L=v+".dds",F=new window.XMLHttpRequest;F.open("GET",L),F.onerror=function(){_(new Error("Unable to GET "+L+", status "+F.status+" "+(""+F.responseText)))},F.onload=function(){if(F.status<200||F.status>=300){F.onerror();return}S((0,o.parseDataSet)(F.response))},F.send()});return y}},{key:"getSourcePositions",value:function(v){var y=new Promise(function(S,_){var L=v+".json?SourcePosition",F=new window.XMLHttpRequest;F.open("GET",L),F.onerror=function(){_(new Error("Unable to GET "+L+", status "+F.status+" "+(""+F.responseText)))},F.onload=function(){if(F.status<200||F.status>=300){F.onerror();return}try{var x=JSON.parse(F.response);if(x.leaves[0].name!=="SourcePosition")throw new Error("SourcePosition not found");S(x.leaves[0].data)}catch(O){_(new Error("Unable to parse response from "+L+". "+O.message))}},F.send()});return y}}]),M}();i.default=u},{"./parseDataSet":19,"./parseXml":21}],19:[function(n,r,i){Object.defineProperty(i,"__esModule",{value:!0}),i._parseDimension=m,i._parseDefinition=v,i.parseDataSet=y;/**
 * @fileOverview Parser for DDS files
 * @author Jean-Philippe.Lambert@ircam.fr
 * @copyright 2015-2016 IRCAM, Paris, France
 * @license BSD-3-Clause
 */var a="\\[\\s*(\\w+)\\s*=\\s*(\\d+)\\s*\\]",e=new RegExp(a,"g"),c=new RegExp(a),o="\\s*(\\w+)\\s*([\\w.]+)\\s*((?:\\[[^\\]]+\\]\\s*)+);\\s*",f=new RegExp(o,"g"),h=new RegExp(o),u="\\s*Dataset\\s*\\{\\s*((?:[^;]+;\\s*)*)\\s*\\}\\s*[\\w.]+\\s*;\\s*",M=new RegExp(u);function m(S){var _=[],L=S.match(e);return L!==null&&L.forEach(function(F){var x=c.exec(F);x!==null&&x.length>2&&_.push([x[1],Number(x[2])])}),_}function v(S){var _=[],L=S.match(f);return L!==null&&L.forEach(function(F){var x=h.exec(F);if(x!==null&&x.length>3){var O=[];O[0]=x[2],O[1]={},O[1].type=x[1],m(x[3]).forEach(function(R){O[1][R[0]]=R[1]}),_.push(O)}}),_}function y(S){var _={},L=M.exec(S);return L!==null&&L.length>1&&v(L[1]).forEach(function(F){_[F[0]]=F[1]}),_}i.default=y},{}],20:[function(n,r,i){Object.defineProperty(i,"__esModule",{value:!0}),i.parseSofa=a,i.stringifySofa=e,i.conformSofaCoordinateSystem=c;/**
 * @fileOverview Parser functions for SOFA files
 * @author Jean-Philippe.Lambert@ircam.fr
 * @copyright 2015 IRCAM, Paris, France
 * @license BSD-3-Clause
 */function a(o){try{var f=JSON.parse(o),h={};if(h.name=f.name,typeof f.attributes<"u"){h.metaData={};var u=f.attributes.find(function(m){return m.name==="NC_GLOBAL"});typeof u<"u"&&u.attributes.forEach(function(m){h.metaData[m.name]=m.value[0]})}if(typeof f.leaves<"u"){var M=f.leaves;M.forEach(function(m){h[m.name]={},m.attributes.forEach(function(v){h[m.name][v.name]=v.value[0]}),h[m.name].shape=m.shape,h[m.name].data=m.data})}return h}catch(m){throw new Error("Unable to parse SOFA string. "+m.message)}}function e(o){var f={};if(typeof o.name<"u"&&(f.name=o.name),typeof o.metaData<"u"){f.attributes=[];var h={name:"NC_GLOBAL",attributes:[]};for(var u in o.metaData)o.metaData.hasOwnProperty(u)&&h.attributes.push({name:u,value:[o.metaData[u]]});f.attributes.push(h)}var M="Float64",m=void 0;if(f.leaves=[],[["ListenerPosition","ListenerPositionType"],["ListenerUp","ListenerUpType"],["ListenerView","ListenerViewType"]].forEach(function(v){var y=v[0],S=o[y],_=o[v[1]];if(typeof S<"u"){switch(_){case"cartesian":m=[{name:"Type",value:["cartesian"]},{name:"Units",value:["metre, metre, metre"]}];break;case"spherical":m=[{name:"Type",value:["spherical"]},{name:"Units",value:["degree, degree, metre"]}];break;default:throw new Error("Unknown coordinate system type "+(_+" for "+S))}f.leaves.push({name:y,type:M,attributes:m,shape:[1,3],data:[S]})}}),typeof o.SourcePosition<"u"){switch(o.SourcePositionType){case"cartesian":m=[{name:"Type",value:["cartesian"]},{name:"Units",value:["metre, metre, metre"]}];break;case"spherical":m=[{name:"Type",value:["spherical"]},{name:"Units",value:["degree, degree, metre"]}];break;default:throw new Error("Unknown coordinate system type "+(""+o.SourcePositionType))}f.leaves.push({name:"SourcePosition",type:M,attributes:m,shape:[o.SourcePosition.length,o.SourcePosition[0].length],data:o.SourcePosition})}if(typeof o.DataSamplingRate<"u")f.leaves.push({name:"Data.SamplingRate",type:M,attributes:[{name:"Unit",value:"hertz"}],shape:[1],data:[o.DataSamplingRate]});else throw new Error("No data sampling-rate");if(typeof o.DataDelay<"u"&&f.leaves.push({name:"Data.Delay",type:M,attributes:[],shape:[1,o.DataDelay.length],data:o.DataDelay}),typeof o.DataIR<"u")f.leaves.push({name:"Data.IR",type:M,attributes:[],shape:[o.DataIR.length,o.DataIR[0].length,o.DataIR[0][0].length],data:o.DataIR});else throw new Error("No data IR");return typeof o.RoomVolume<"u"&&f.leaves.push({name:"RoomVolume",type:M,attributes:[{name:"Units",value:["cubic metre"]}],shape:[1],data:[o.RoomVolume]}),f.nodes=[],JSON.stringify(f)}function c(o){var f=void 0;switch(o){case"cartesian":f="sofaCartesian";break;case"spherical":f="sofaSpherical";break;default:throw new Error("Bad SOFA type "+o)}return f}i.default={parseSofa:a,conformSofaCoordinateSystem:c}},{}],21:[function(n,r,i){Object.defineProperty(i,"__esModule",{value:!0});/**
 * @fileOverview Simple XML parser, as a DOM parser.
 * @author Jean-Philippe.Lambert@ircam.fr
 * @copyright 2015-2016 IRCAM, Paris, France
 * @license BSD-3-Clause
 */var a=i.parseXml=void 0;if(typeof window.DOMParser<"u")i.parseXml=a=function(c){return new window.DOMParser().parseFromString(c,"text/xml")};else if(typeof window.ActiveXObject<"u"&&new window.ActiveXObject("Microsoft.XMLDOM"))i.parseXml=a=function(c){var o=new window.ActiveXObject("Microsoft.XMLDOM");return o.async="false",o.loadXML(c),o};else throw new Error("No XML parser found");i.default=a},{}]},{},[15])(15)})})(serveSofaHrir);var serveSofaHrirExports=serveSofaHrir.exports;class HRIRloader_ircam{constructor(t,n,r){this.context=t,this.order=n,this.nCh=getAmbisonicChannelCount(n),this.onLoad=r,this.hrtfSet=new serveSofaHrirExports.HrtfSet({audioContext:this.context,coordinateSystem:"sofaSpherical"}),this.wishedSpeakerPos=getTdesign(2*this.order),this.hrirBuffer=[],this.decodingMatrix=[],this.hoaBuffer=null}load(t){this.hrtfSet.load(t).then(()=>{const n=[];this.hrirBuffer=[];for(let i=0;i<this.wishedSpeakerPos.length;i++)n.push(this.hrtfSet.nearest(this.wishedSpeakerPos[i]).position),this.hrirBuffer.push(this.hrtfSet.nearest(this.wishedSpeakerPos[i]).fir);let r=0;for(let i=0;i<this.wishedSpeakerPos.length;i++)this.wishedSpeakerPos[i][0]<0&&(this.wishedSpeakerPos[i][0]+=360),r+=Math.sqrt(Math.pow(this.wishedSpeakerPos[i][0]-n[i][0],2)+Math.pow(this.wishedSpeakerPos[i][1]-n[i][1],2));console.log("summed / average angular dist between asked and present pos:",Math.round(r*100)/100,"deg /",Math.round(r/this.wishedSpeakerPos.length*100)/100,"deg"),this.decodingMatrix=getAmbisonicDecMtx(n,this.order),this.hoaBuffer=this.getHoaFilterFromHrirFilter(),this.onLoad(this.hoaBuffer)})}getHoaFilterFromHrirFilter(){const t=this.hrirBuffer[0].length,n=this.hrirBuffer[0].sampleRate,r=this.context.createBuffer(this.nCh,t,n);for(let i=0;i<this.nCh;i++){const a=new Float32Array(t);for(let e=0;e<this.hrirBuffer.length;e++)for(let c=0;c<t;c++)a[c]+=this.decodingMatrix[e][i]*this.hrirBuffer[e].getChannelData(0)[c];r.getChannelData(i).set(a)}return r}}class wxyz2acn{constructor(t){this.ctx=t,this.in=this.ctx.createChannelSplitter(4),this.out=this.ctx.createChannelMerger(4),this.gains=new Array(4);for(let n=0;n<4;n++)this.gains[n]=this.ctx.createGain(),n===0?this.gains[n].gain.value=Math.SQRT2:this.gains[n].gain.value=Math.sqrt(3),this.gains[n].connect(this.out,0,n);this.in.connect(this.gains[0],0,0),this.in.connect(this.gains[3],1,0),this.in.connect(this.gains[1],2,0),this.in.connect(this.gains[2],3,0)}}class acn2wxyz{constructor(t){this.ctx=t,this.in=this.ctx.createChannelSplitter(4),this.out=this.ctx.createChannelMerger(4),this.gains=new Array(4);for(let n=0;n<4;n++)this.gains[n]=this.ctx.createGain(),n===0?this.gains[n].gain.value=Math.SQRT1_2:this.gains[n].gain.value=1/Math.sqrt(3),this.gains[n].connect(this.out,0,n);this.in.connect(this.gains[0],0,0),this.in.connect(this.gains[2],1,0),this.in.connect(this.gains[3],2,0),this.in.connect(this.gains[1],3,0)}}class sn3d2n3d{constructor(t,n){this.ctx=t,this.order=n,this.nCh=getAmbisonicChannelCount(n),this.in=this.ctx.createChannelSplitter(this.nCh),this.out=this.ctx.createChannelMerger(this.nCh),this.gains=new Array(this.nCh);for(let r=0;r<this.nCh;r++){const i=Math.floor(Math.sqrt(r));this.gains[r]=this.ctx.createGain(),this.gains[r].gain.value=Math.sqrt(2*i+1),this.in.connect(this.gains[r],r,0),this.gains[r].connect(this.out,0,r)}}}class n3d2sn3d{constructor(t,n){this.ctx=t,this.order=n,this.nCh=getAmbisonicChannelCount(n),this.in=this.ctx.createChannelSplitter(this.nCh),this.out=this.ctx.createChannelMerger(this.nCh),this.gains=new Array(this.nCh);for(let r=0;r<this.nCh;r++){const i=Math.floor(Math.sqrt(r));this.gains[r]=this.ctx.createGain(),this.gains[r].gain.value=1/Math.sqrt(2*i+1),this.in.connect(this.gains[r],r,0),this.gains[r].connect(this.out,0,r)}}}class fuma2acn{constructor(t,n){let r=n;r>3&&(console.log("FuMa specifiction is supported up to 3rd order"),r=3);const i=[Math.sqrt(2),Math.sqrt(3),Math.sqrt(3),Math.sqrt(3),Math.sqrt(15)/2,Math.sqrt(15)/2,Math.sqrt(5),Math.sqrt(15)/2,Math.sqrt(15)/2,Math.sqrt(35/8),Math.sqrt(35)/3,Math.sqrt(224/45),Math.sqrt(7),Math.sqrt(224/45),Math.sqrt(35)/3,Math.sqrt(35/8)];if(this.ctx=t,this.order=r,this.nCh=getAmbisonicChannelCount(r),this.in=this.ctx.createChannelSplitter(this.nCh),this.out=this.ctx.createChannelMerger(this.nCh),this.gains=[],this.remapArray=[],this.remapArray.push(0,2,3,1),r>1){let a=0,e;for(let c=0;c<this.nCh;c++)if(e=[],c>=(a+1)*(a+1)){a+=1;for(let o=(a+1)*(a+1);o<(a+2)*(a+2);o++)(o+a%2)%2===0?e.push(o):e.unshift(o);this.remapArray=this.remapArray.concat(e)}}for(let a=0;a<this.nCh;a++)this.gains[a]=this.ctx.createGain(),this.gains[a].gain.value=i[a],this.in.connect(this.gains[a],this.remapArray[a],0),this.gains[a].connect(this.out,0,a)}}const _converters=Object.freeze(Object.defineProperty({__proto__:null,acn2wxyz,fuma2acn,n3d2sn3d,sn3d2n3d,wxyz2acn},Symbol.toStringTag,{value:"Module"})),converters=_converters,utils=_utils;exports.HOAloader=HOAloader,exports.HRIRloader2D_local=HRIRloader2D_local,exports.HRIRloader_ircam=HRIRloader_ircam,exports.HRIRloader_local=HRIRloader_local,exports.binDecoder=binDecoder,exports.binDecoder2D=binDecoder2D,exports.computeEncodingCoefficients=computeEncodingCoefficients,exports.computeEncodingCoefficients2D=computeEncodingCoefficients2D,exports.converters=converters,exports.convolver=convolver,exports.decoder=decoder,exports.degreesToRadians=degreesToRadians,exports.encodeAndSumBuffers=encodeAndSumBuffers,exports.encodeBuffer=encodeBuffer,exports.encodeBuffer2D=encodeBuffer2D,exports.encodeBuffer2DFromDirection=encodeBuffer2DFromDirection,exports.encodeBufferFromDirection=encodeBufferFromDirection,exports.getAmbisonicChannelCount=getAmbisonicChannelCount,exports.getAmbisonicChannelCount2D=getAmbisonicChannelCount2D,exports.intensityAnalyser=intensityAnalyser,exports.intensityAnalyser2D=intensityAnalyser2D,exports.monoEncoder=monoEncoder,exports.monoEncoder2D=monoEncoder2D,exports.orderLimiter=orderLimiter,exports.orderLimiter2D=orderLimiter2D,exports.orderWeight=orderWeight,exports.powermapAnalyser=powermapAnalyser,exports.radiansToDegrees=radiansToDegrees,exports.rmsAnalyser=rmsAnalyser,exports.sceneMirror=sceneMirror,exports.sceneMirror2D=sceneMirror2D,exports.sceneRotator=sceneRotator,exports.sceneRotator2D=sceneRotator2D,exports.utils=utils,exports.virtualMic=virtualMic,Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=ambisonics.umd.min.js.map
